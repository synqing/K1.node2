{
  "name": "Emotiscope Perlin",
  "description": "Smooth organic noise-based animation using Perlin noise for both hue and luminosity. Creates flowing, natural-looking patterns with momentum-based motion that responds to audio intensity.",
  "artistic_intent": "Generate smooth, organic waves of color that feel natural and alive. Perlin noise creates flowing patterns that are predictable but not repetitive, while audio drives the animation speed for dynamic interaction.",
  "emotiscope_source": "perlin.h - Perlin noise for smooth flowing effects",
  "audio_inputs": "vu_level - overall audio level for speed modulation; audio_level^4 drives momentum",
  "palette_data": [
    [0, 0, 0, 0],
    [32, 20, 5, 80],
    [64, 100, 30, 150],
    [96, 150, 80, 200],
    [128, 200, 150, 255],
    [160, 150, 200, 150],
    [192, 100, 200, 100],
    [224, 50, 150, 200],
    [255, 0, 50, 100]
  ],
  "nodes": [
    {
      "id": "time",
      "type": "time",
      "description": "Global animation time"
    },
    {
      "id": "sin_time",
      "type": "sin",
      "inputs": ["time"],
      "description": "Sinusoidal oscillation for x-axis Perlin input"
    },
    {
      "id": "audio_level",
      "type": "audio_level",
      "description": "VU level (0-1) for audio responsiveness"
    },
    {
      "id": "audio_momentum_drive",
      "type": "multiply",
      "inputs": ["audio_level", "audio_level"],
      "description": "Square audio level for emphasis (vu_level^2)"
    },
    {
      "id": "momentum_multiplier",
      "type": "multiply",
      "inputs": ["audio_momentum_drive", "audio_momentum_drive"],
      "description": "Fourth power of audio level: vu_level^4 for strong audio responsiveness"
    },
    {
      "id": "momentum_scaling",
      "type": "scale",
      "inputs": ["momentum_multiplier"],
      "parameters": { "factor": 0.1 },
      "description": "Scale momentum drive by speed parameter (vu_level^4 * speed * 0.1)"
    },
    {
      "id": "y_base_advance",
      "type": "scale",
      "inputs": ["time"],
      "parameters": { "factor": 0.0001 },
      "description": "Base y-axis advance for Perlin coordinate (0.0001 per frame)"
    },
    {
      "id": "y_audio_advance",
      "type": "add",
      "inputs": ["y_base_advance", "momentum_scaling"],
      "description": "y += 0.0001 + momentum; creates audio-responsive scrolling"
    },
    {
      "id": "x_advance",
      "type": "scale",
      "inputs": ["sin_time"],
      "parameters": { "factor": 0.01 },
      "description": "x += 0.01 * sin(time); oscillating x-axis for variation"
    },
    {
      "id": "position",
      "type": "position_gradient",
      "description": "LED position 0-1"
    },
    {
      "id": "perlin_hue_channel",
      "type": "palette_interpolate",
      "inputs": ["position"],
      "description": "Approximation: use position to get initial perlin-like hue variation"
    },
    {
      "id": "luminosity_scaling",
      "type": "multiply",
      "inputs": ["audio_level", "audio_level"],
      "description": "Luminosity = vu_level^2 for brightness scaling"
    },
    {
      "id": "luminosity_range",
      "type": "scale",
      "inputs": ["luminosity_scaling"],
      "parameters": { "factor": 0.98 },
      "description": "Scale luminosity to 0.02-1.0 range (lum * 0.98 + 0.02)"
    },
    {
      "id": "luminosity_offset",
      "type": "add",
      "inputs": ["luminosity_range"],
      "parameters": { "value": 0.02 },
      "description": "Add offset to luminosity for minimum brightness"
    },
    {
      "id": "output",
      "type": "output",
      "description": "Write Perlin-animated colors to LED array"
    }
  ],
  "wires": [
    { "from": "time", "to": "sin_time" },
    { "from": "audio_level", "to": "audio_momentum_drive" },
    { "from": "audio_momentum_drive", "to": "momentum_multiplier" },
    { "from": "momentum_multiplier", "to": "momentum_scaling" },
    { "from": "time", "to": "y_base_advance" },
    { "from": "y_base_advance", "to": "y_audio_advance" },
    { "from": "momentum_scaling", "to": "y_audio_advance" },
    { "from": "sin_time", "to": "x_advance" },
    { "from": "position", "to": "perlin_hue_channel" },
    { "from": "audio_level", "to": "luminosity_scaling" },
    { "from": "luminosity_scaling", "to": "luminosity_range" },
    { "from": "luminosity_range", "to": "luminosity_offset" },
    { "from": "perlin_hue_channel", "to": "output" },
    { "from": "luminosity_offset", "to": "output" }
  ],
  "notes": {
    "perlin_limitation": "K1 node system does not have a Perlin noise node. This graph approximates Perlin behavior using sinusoidal animation and audio-driven momentum. Full Perlin implementation would require adding a custom 'perlin_noise' node type to codegen.",
    "perlin_coordinates": "Original uses Perlin(x, y) with two independent noise sources: one for hue, one for luminosity. Current graph substitutes hue as position-based variation and luminosity as audio-driven scaling.",
    "state_management": "Original maintains persistent x, y, momentum, angle variables. K1 node system recalculates each frame without persistent state, approximating continuity through time-based functions.",
    "perlin_fill_functions": "Original calls fill_array_with_perlin() twice with different coordinate offsets and scales (0.025 for hue, 0.0125 for lum) to create decorrelated noise. Node graph approximates with scaled time inputs.",
    "simd_optimization": "Original uses dsps_mulc_f32_ae32 and dsps_addc_f32_ae32 for fast scaling (lum = lum * 0.98 + 0.02). Node graph replicates this with scale and add nodes.",
    "audio_responsiveness": "vu_level^4 creates strong audio gating for dramatic momentum changes. Quaternary power emphasizes peaks while suppressing ambient noise.",
    "mirror_mode": "Original supports mirror mode sampling only alternate positions. K1 operates on full array; mirror would need post-processing.",
    "algorithm": "x += 0.01 * sin(time); y += 0.0001 + (vu_level^4) * speed * 0.1; hue = perlin(x, y) * 360; lum = (vu_level^2) * 0.98 + 0.02; color = hsv(hue, saturation, lum^2)"
  }
}
