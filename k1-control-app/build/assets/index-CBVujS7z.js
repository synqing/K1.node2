import{r as c,j as e,S as yt,P as ts,d as ss,T as rs,e as as,C as ns,f as is,h as Ce,i as Fe,k as os,l as cs,m as ls,n as ds,I as us,o as nt,V as ms,p as hs,q as gs,s as xs,t as ps,u as fs,v as we,w as vs,x as bs,y as jt,z as ys,W as Ae,B as ke,L as ye,D as wt,E as Te,F as js,G as ws,H as ks,J as Ns,Z as kt,K as Nt,M as Es,N as Et,O as Cs,Q as Ts,U as Ss,X as _s,Y as Ds,_ as Ms,$ as Rs,a0 as Ct,R as As,a1 as Is,a2 as Ps,a3 as Tt,a4 as Os,a5 as Ls,a6 as Fs,a7 as $s,a8 as zs,a9 as Us,aa as Bs,ab as Hs,ac as Vs,ad as Ze,ae as St,af as Ks,ag as Ws,ah as qs,ai as Gs,aj as Ys,ak as Js,al as et,am as tt,an as _t,ao as Qs,ap as Xs,aq as Zs,ar as er,as as tr,at as sr,au as rr,av as ar,aw as nr,ax as Dt,ay as Mt,az as ir,aA as Rt,aB as or,aC as cr,aD as lr,aE as dr,aF as ur,aG as mr,aH as hr}from"./react-vendor-eecBA3R4.js";import{t as gr,p as xr,q as At,v as X,R as ce,L as Ue,C as re,X as ae,Y as ne,T as ie,w as Se,x as fe,A as st,y as It,z as de,B as it,D as $e,E as pr,F as fr,G as vr}from"./vendor-D4stIOPd.js";import"./radix-vendor-BQCqNqg0.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();function O(...s){return gr(xr(s))}const br=At("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9 rounded-md"}},defaultVariants:{variant:"default",size:"default"}}),z=c.forwardRef(({className:s,variant:t,size:r,asChild:a=!1,...n},o)=>{const i=a?yt:"button";return e.jsx(i,{ref:o,"data-slot":"button",className:O(br({variant:t,size:r,className:s})),...n})});function je({delayDuration:s=0,...t}){return e.jsx(ts,{"data-slot":"tooltip-provider",delayDuration:s,...t})}function Ie({...s}){return e.jsx(je,{children:e.jsx(ss,{"data-slot":"tooltip",...s})})}function Pe({...s}){return e.jsx(rs,{"data-slot":"tooltip-trigger",...s})}function Oe({className:s,sideOffset:t=0,children:r,...a}){return e.jsx(as,{children:e.jsxs(ns,{"data-slot":"tooltip-content",sideOffset:t,className:O("bg-primary text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",s),...a,children:[r,e.jsx(is,{className:"bg-primary fill-primary z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]"})]})})}function yr({activeView:s,onViewChange:t,isConnected:r,connectionIP:a}){return e.jsxs("header",{className:"h-[var(--toolbar-h)] bg-[var(--k1-bg-elev)] border-b border-[var(--k1-border)] flex items-center px-6 gap-8",style:{borderBottomWidth:"1px",borderBottomStyle:"solid"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-[var(--k1-accent)] to-[var(--k1-accent-2)] rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-[var(--k1-bg)] font-bold text-sm",children:"K1"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[var(--k1-text)] leading-tight",children:"K1.reinvented"}),e.jsx("span",{className:"text-[var(--k1-text-dim)] text-[10px] leading-tight",children:"Control Interface"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-[var(--k1-panel)] rounded-lg",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${r?"bg-[var(--k1-success)]":"bg-[var(--k1-text-dim)]"}`}),e.jsx("span",{className:"text-[var(--k1-text-dim)] font-[family-name:var(--k1-code-family)]",children:r?a:"Disconnected"}),r&&e.jsx(je,{children:e.jsxs(Ie,{children:[e.jsx(Pe,{children:e.jsx(Ce,{className:"w-3 h-3 text-[var(--k1-success)]"})}),e.jsx(Oe,{children:e.jsx("p",{children:"Connection active â€¢ 45ms latency"})})]})})]}),e.jsxs("nav",{className:"flex gap-1 flex-1 justify-center",children:[e.jsx("button",{onClick:()=>t("control"),className:`px-4 py-2 rounded-lg transition-colors ${s==="control"?"bg-[var(--k1-panel)] text-[var(--k1-text)]":"text-[var(--k1-text-dim)] hover:text-[var(--k1-text)] hover:bg-[var(--k1-panel)]/50"}`,children:"Control Panel"}),e.jsx("button",{onClick:()=>t("profiling"),className:`px-4 py-2 rounded-lg transition-colors ${s==="profiling"?"bg-[var(--k1-panel)] text-[var(--k1-text)]":"text-[var(--k1-text-dim)] hover:text-[var(--k1-text)] hover:bg-[var(--k1-panel)]/50"}`,children:"Profiling"}),e.jsx("button",{onClick:()=>t("terminal"),className:`px-4 py-2 rounded-lg transition-colors ${s==="terminal"?"bg-[var(--k1-panel)] text-[var(--k1-text)]":"text-[var(--k1-text-dim)] hover:text-[var(--k1-text)] hover:bg-[var(--k1-panel)]/50"}`,children:"Terminal"}),e.jsx("button",{onClick:()=>t("tile-explorer"),className:`px-4 py-2 rounded-lg transition-colors ${s==="tile-explorer"?"bg-[var(--k1-panel)] text-[var(--k1-text)]":"text-[var(--k1-text-dim)] hover:text-[var(--k1-text)] hover:bg-[var(--k1-panel)]/50"}`,children:"Tile Explorer"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{children:e.jsxs(Ie,{children:[e.jsx(Pe,{asChild:!0,children:e.jsx(z,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(Fe,{className:"h-4 w-4"})})}),e.jsx(Oe,{children:e.jsx("p",{children:"Settings"})})]})}),e.jsx(je,{children:e.jsxs(Ie,{children:[e.jsx(Pe,{asChild:!0,children:e.jsx(z,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(os,{className:"h-4 w-4"})})}),e.jsx(Oe,{children:e.jsx("p",{children:"Help & Documentation"})})]})})]})]})}function Ne({className:s,type:t,...r}){return e.jsx("input",{type:t,"data-slot":"input",className:O("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-input-background transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",s),...r})}function V({className:s,...t}){return e.jsx(cs,{"data-slot":"label",className:O("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",s),...t})}function ue({...s}){return e.jsx(ls,{"data-slot":"select",...s})}function me({...s}){return e.jsx(ms,{"data-slot":"select-value",...s})}function he({className:s,size:t="default",children:r,...a}){return e.jsxs(ds,{"data-slot":"select-trigger","data-size":t,className:O("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-full items-center justify-between gap-2 rounded-md border bg-input-background px-3 py-2 text-sm whitespace-nowrap transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...a,children:[r,e.jsx(us,{asChild:!0,children:e.jsx(nt,{className:"size-4 opacity-50"})})]})}function ge({className:s,children:t,position:r="popper",...a}){return e.jsx(hs,{children:e.jsxs(gs,{"data-slot":"select-content",className:O("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:r,...a,children:[e.jsx(jr,{}),e.jsx(xs,{className:O("p-1",r==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:t}),e.jsx(wr,{})]})})}function U({className:s,children:t,...r}){return e.jsxs(ps,{"data-slot":"select-item",className:O("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",s),...r,children:[e.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:e.jsx(fs,{children:e.jsx(we,{className:"size-4"})})}),e.jsx(vs,{children:t})]})}function jr({className:s,...t}){return e.jsx(bs,{"data-slot":"select-scroll-up-button",className:O("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(jt,{className:"size-4"})})}function wr({className:s,...t}){return e.jsx(ys,{"data-slot":"select-scroll-down-button",className:O("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(nt,{className:"size-4"})})}function F({className:s,...t}){return e.jsx("div",{"data-slot":"card",className:O("bg-card text-card-foreground rounded-lg border",s),...t})}function Pt({className:s,...t}){return e.jsx("div",{"data-slot":"card-header",className:O("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 pt-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",s),...t})}function Ot({className:s,...t}){return e.jsx("h4",{"data-slot":"card-title",className:O("leading-none",s),...t})}function Lt({className:s,...t}){return e.jsx("div",{"data-slot":"card-content",className:O("px-6 [&:last-child]:pb-6",s),...t})}var H=(s=>(s.CONNECTION_FAILED="CONNECTION_FAILED",s.CONNECTION_TIMEOUT="CONNECTION_TIMEOUT",s.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",s.WEBSOCKET_ERROR="WEBSOCKET_ERROR",s.API_REQUEST_FAILED="API_REQUEST_FAILED",s.INVALID_RESPONSE="INVALID_RESPONSE",s.RATE_LIMITED="RATE_LIMITED",s.INVALID_PARAMETER="INVALID_PARAMETER",s.MISSING_REQUIRED_FIELD="MISSING_REQUIRED_FIELD",s.PERMISSION_DENIED="PERMISSION_DENIED",s.NETWORK_ERROR="NETWORK_ERROR",s.DISCOVERY_FAILED="DISCOVERY_FAILED",s.UNKNOWN_ERROR="UNKNOWN_ERROR",s))(H||{});class J extends Error{constructor(t,r,a,n=!0,o){super(r),this.code=t,this.userMessage=a,this.recoverable=n,this.context=o,this.name="K1Error"}static fromUnknown(t,r){if(t instanceof J)return t;if(t instanceof Error){if(t.message.includes("fetch")||t.message.includes("NetworkError"))return new J("NETWORK_ERROR",t.message,"Network connection failed. Please check your internet connection.",!0,r);if(t.message.includes("timeout")||t.message.includes("AbortError"))return new J("CONNECTION_TIMEOUT",t.message,"Connection timed out. The device may be offline or unreachable.",!0,r);if(t.message.includes("404")||t.message.includes("Not Found"))return new J("DEVICE_NOT_FOUND",t.message,"Device not found. Please check the IP address and try again.",!0,r);if(t.message.includes("WebSocket"))return new J("WEBSOCKET_ERROR",t.message,"Real-time connection failed. Falling back to polling mode.",!0,r)}return new J("UNKNOWN_ERROR",String(t),"An unexpected error occurred. Please try again.",!0,r)}getRetryDelay(){switch(this.code){case"CONNECTION_TIMEOUT":return 2e3;case"NETWORK_ERROR":return 1e3;case"RATE_LIMITED":return 5e3;default:return 1e3}}shouldRetry(){return this.recoverable&&["CONNECTION_TIMEOUT","NETWORK_ERROR","WEBSOCKET_ERROR"].includes(this.code)}}function kr(s){if(s instanceof Error){const t=s.message.toLowerCase();return s.name==="AbortError"||t.includes("abort")||t.includes("cancelled")}return!1}async function Nr(s,t={}){const{maxAttempts:r=3,baseDelay:a=1e3,maxDelay:n=1e4,backoffFactor:o=2,retryCondition:i=l=>J.fromUnknown(l).shouldRetry()}=t;let u;for(let l=1;l<=r;l++)try{return await s()}catch(m){if(u=m,l===r||!i(m))throw m;const d=J.fromUnknown(m),v=Math.min(d.getRetryDelay()*Math.pow(o,l-1),n);console.warn(`[Retry] Attempt ${l}/${r} failed, retrying in ${v}ms:`,m),await new Promise(f=>setTimeout(f,v))}throw u}class Ee{_isConnected=!1;_endpoint="";_listeners=new Map;_errorHandler=()=>{};_wsEnabled=!0;_wsAvailable=!1;_activeTransport="rest";_ws=null;_lastWSError=null;_pollTimer=null;_reconnectAttempts=0;_reconnectTimer=null;_backoffBaseMs=500;_backoffMaxMs=3e4;_pollCooldownTimer=null;_lastParamUpdateAt=0;on(t,r){this._listeners.has(t)||this._listeners.set(t,new Set),this._listeners.get(t).add(r)}off(t,r){this._listeners.get(t)?.delete(r)}emit(t,r){const a=this._listeners.get(t);a&&a.forEach(n=>{try{n(r)}catch{}})}constructor(t){this._endpoint=t}setErrorHandler(t){this._errorHandler=t}async testConnection(){try{return(await fetch(`${this._endpoint}/api/patterns`,{method:"GET",signal:AbortSignal.timeout(3e3),headers:{Accept:"application/json"}})).ok}catch(t){return console.warn("[K1Client] Connection test failed:",t),!1}}async connect(t){return Nr(async()=>{try{this._endpoint=t;const r=await fetch(`${t}/api/patterns`,{method:"GET",signal:AbortSignal.timeout(5e3),headers:{Accept:"application/json"}});if(!r.ok)throw new J(H.CONNECTION_FAILED,`HTTP ${r.status}: ${r.statusText}`,`Failed to connect to device at ${t}. Please check the IP address and try again.`,!0,{endpoint:t,status:r.status});const a=await r.json();this._isConnected=!0;const n={device:"K1.reinvented",firmware:"1.0.0",uptime:Date.now(),ip:t.replace("http://","").split(":")[0],mac:"unknown",lastSeen:new Date,latency:50};return this.emit("open",{endpoint:t,deviceInfo:n}),n}catch(r){const a=J.fromUnknown(r,{endpoint:t});throw this._errorHandler(a),a}},{maxAttempts:3,baseDelay:1e3,retryCondition:r=>{const a=J.fromUnknown(r);return a.code===H.CONNECTION_TIMEOUT||a.code===H.NETWORK_ERROR}})}setWebSocketEnabled(t){if(this._wsEnabled=t,this.emit("transportChanged",{transport:t?"ws":"rest",available:this._wsAvailable}),t)this._isConnected&&this.connectWebSocket(()=>{},()=>{});else{if(this._ws){try{this._ws.close()}catch{}this._ws=null}this._wsAvailable=!1,this._activeTransport="rest",this._reconnectTimer&&(clearTimeout(this._reconnectTimer),this._reconnectTimer=null),this._pollCooldownTimer&&(clearTimeout(this._pollCooldownTimer),this._pollCooldownTimer=null),this._reconnectAttempts=0,this.startPolling()}}isWebSocketEnabled(){return this._wsEnabled}getTransportStatus(){return{wsAvailable:this._wsAvailable,wsEnabled:this._wsEnabled,restAvailable:!0,activeTransport:this._activeTransport,lastWSError:this._lastWSError}}getReconnectInfo(){const t=this._backoffBaseMs*Math.pow(2,this._reconnectAttempts),r=Math.min(t,this._backoffMaxMs),a=this._wsEnabled&&this._isConnected&&!this._wsAvailable&&this._activeTransport!=="ws";return{attempts:this._reconnectAttempts,nextDelayMs:r,maxDelayMs:this._backoffMaxMs,isActive:a}}getRateLimiterInfo(){const r=this._activeTransport==="ws"&&this._wsAvailable?60:120;return{lastUpdateAt:this._lastParamUpdateAt,minIntervalMs:r,activeTransport:this._activeTransport}}buildWsUrl(){const t=this._endpoint;return t?t.startsWith("http://")?t.replace("http://","ws://")+"/ws":t.startsWith("https://")?t.replace("https://","wss://")+"/ws":`ws://${t}/ws`:""}startPolling(){this._pollTimer||(this._pollTimer=setInterval(async()=>{try{const t=await this.getPerformanceMetrics(),r=await this.getAudioMetrics(),a={performance:{fps:Math.round(t.fps),frame_time_us:Math.round((t.frameTime||16)*1e3),cpu_percent:Math.round(t.cpuUsage||0),memory_percent:Math.round(t.memoryUsage||0),memory_free_kb:0,temperature:void 0},audio:{spectrum:(r.frequencyBands||[]).map(n=>Math.max(0,n)),chromagram:new Array(12).fill(0).map(()=>Math.random()),vu_level:Math.max(0,Math.min(1,(r.rms||0)/100)),vu_level_raw:Math.max(0,Math.min(1,(r.peak||0)/100)),tempo_confidence:Math.max(0,Math.min(1,(r.beatConfidence||0)/100)),novelty_curve:Math.random(),update_counter:Date.now(),timestamp_us:Date.now()*1e3}};this.emit("realtimeData",a),this.emit("performanceData",a.performance),this.emit("audioData",a.audio)}catch{}},50))}stopPolling(){this._pollTimer&&(clearInterval(this._pollTimer),this._pollTimer=null)}startPollingWithCooldown(t=800){this._pollCooldownTimer||(this._pollCooldownTimer=setTimeout(()=>{this._pollCooldownTimer=null,!this._wsAvailable&&this._activeTransport!=="ws"&&this.startPolling()},Math.max(0,t)))}scheduleReconnect(t,r){if(!this._wsEnabled||!this._isConnected||this._reconnectTimer)return;const a=Math.floor(Math.random()*250),n=this._backoffBaseMs*Math.pow(2,this._reconnectAttempts),o=Math.min(n+a,this._backoffMaxMs);this._reconnectAttempts=Math.min(this._reconnectAttempts+1,16),this._reconnectTimer=setTimeout(()=>{this._reconnectTimer=null,this.connectWebSocket(t,r)},o)}connectWebSocket(t,r){if(!this._wsEnabled){this._wsAvailable=!1,this._activeTransport="rest",this.startPolling(),r({wsAvailable:!1,activeTransport:this._activeTransport});return}const a=this.buildWsUrl();if(!a){this._wsAvailable=!1,this._activeTransport="rest",this.startPolling(),r({wsAvailable:!1,activeTransport:this._activeTransport});return}try{if(this._ws){try{this._ws.close()}catch{}this._ws=null}const n=new WebSocket(a);this._ws=n,this._activeTransport="ws",n.onopen=()=>{this._wsAvailable=!0,this._lastWSError=null,this._reconnectAttempts=0,this._reconnectTimer&&(clearTimeout(this._reconnectTimer),this._reconnectTimer=null),this._pollCooldownTimer&&(clearTimeout(this._pollCooldownTimer),this._pollCooldownTimer=null),this.stopPolling(),this.emit("transportChanged",{transport:"ws",available:!0}),r({wsAvailable:!0,activeTransport:"ws"})},n.onmessage=o=>{try{const u=JSON.parse(o.data);try{t(u)}catch(l){kr(l)}u.performance&&this.emit("performanceData",u.performance),u.audio&&this.emit("audioData",u.audio),u&&this.emit("realtimeData",u)}catch{}},n.onerror=o=>{this._lastWSError=new Error("WebSocket error")},n.onclose=()=>{this._wsAvailable=!1,this._activeTransport="rest",this.emit("transportChanged",{transport:"rest",available:!0}),r({wsAvailable:!1,activeTransport:"rest"}),this.startPollingWithCooldown(800),this.scheduleReconnect(t,r)}}catch(n){this._lastWSError=n,this._wsAvailable=!1,this._activeTransport="rest",this.emit("transportChanged",{transport:"rest",available:!0}),r({wsAvailable:!1,activeTransport:"rest",error:n?.message}),this.startPollingWithCooldown(1e3),this.scheduleReconnect(t,r)}}async disconnect(){if(this._isConnected=!1,this._ws){try{this._ws.close()}catch{}this._ws=null}this.stopPolling(),this.emit("close",{code:1e3,reason:"Normal closure"})}isConnected(){return this._isConnected}getEndpoint(){return this._endpoint}async getDeviceInfo(){if(!this._isConnected)throw new Error("Not connected");return{device:"K1.test",firmware:"1.0.0-test",uptime:12345,ip:this._endpoint.replace("http://","").split(":")[0],mac:"00:11:22:33:44:55",lastSeen:new Date,latency:50}}async getPatterns(){return{patterns:[{index:0,id:"rainbow",name:"Rainbow",description:"Classic rainbow pattern",is_audio_reactive:!1}],current_pattern:0}}async selectPattern(t){const r=await fetch(`${this._endpoint}/api/select`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({index:parseInt(t)})});if(!r.ok)throw new Error(`Failed to select pattern: ${r.statusText}`);const a=await r.json();return{success:!0,data:{pattern:{index:a.current_pattern,id:a.id,name:a.name,description:"",is_audio_reactive:!1}}}}async updateParameters(t){const r=Date.now(),n=this._activeTransport==="ws"&&this._wsAvailable?60:120,o=r-(this._lastParamUpdateAt||0);o<n&&await new Promise(d=>setTimeout(d,n-o)),this._lastParamUpdateAt=Date.now();const i=["brightness","softness","color","color_range","saturation","warmth","background","dithering","speed","custom_param_1","custom_param_2","custom_param_3"],u={};for(const[d,v]of Object.entries(t))v!=null&&(d==="palette_id"?u[d]=Number(v):i.includes(d)?u[d]=Number(v)/100:u[d]=Number(v));const l=await fetch(`${this._endpoint}/api/params`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)});if(!l.ok)throw new Error(`Failed to update parameters: ${l.statusText}`);return{success:!0,data:{params:await this.getParameters()}}}async getParameters(){const t=await fetch(`${this._endpoint}/api/params`);if(!t.ok)throw new Error(`Failed to get parameters: ${t.statusText}`);const r=await t.json(),a=n=>Math.round(Number(n??0)*100);return{brightness:a(r.brightness),speed:a(r.speed),saturation:a(r.saturation),warmth:a(r.warmth),softness:a(r.softness),color:a(r.color),color_range:a(r.color_range),background:a(r.background),dithering:a(r.dithering),palette_id:Number(r.palette_id??0),custom_param_1:a(r.custom_param_1),custom_param_2:a(r.custom_param_2),custom_param_3:a(r.custom_param_3)}}async setPalette(t){const r=await fetch(`${this._endpoint}/api/params`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({palette_id:t})});if(!r.ok)throw new Error(`Failed to set palette: ${r.statusText}`);return{success:!0,data:{palette_id:t}}}async backupConfig(){return{version:"1.0.0",timestamp:new Date().toISOString(),device_info:{device:"K1.test",firmware:"1.0.0-test",mac:"00:11:22:33:44:55"},configuration:{patterns:(await this.getPatterns()).patterns,current_pattern:0,parameters:await this.getParameters(),audio_config:{microphone_gain:1},palette_id:0}}}async restoreConfig(t){return{success:!0,message:"Configuration restored successfully",restored_items:["parameters","pattern","palette"]}}async getPerformanceMetrics(){return{fps:60+Math.random()*10-5,frameTime:16+Math.random()*4-2,cpuUsage:30+Math.random()*40,memoryUsage:45+Math.random()*30,droppedFrames:Math.floor(Math.random()*5),renderTime:12+Math.random()*6,timestamp:Date.now()}}async getAudioMetrics(){const t=Date.now(),r=.001,a=.3+.7*Math.sin(t*r*2);return{rms:20+60*a+10*Math.random(),peak:30+70*a+15*Math.random(),beatDetected:Math.random()>.7,beatConfidence:50+50*Math.random(),bpm:120+20*Math.sin(t*r*.1),spectralCentroid:1e3+2e3*a,spectralRolloff:3e3+5e3*a,zeroCrossingRate:.1+.4*a,frequencyBands:Array.from({length:10},(n,o)=>30*a*(1-o*.08)+10*Math.random()),mfcc:Array.from({length:13},(n,o)=>(o===0?10:0)+5*Math.sin(t*r*(o+1))),timestamp:t}}async getParameterHistory(t=3e5){const r=Date.now(),a=[];for(let n=0;n<50;n++){const o=r-t*(50-n)/50;a.push({timestamp:o,brightness:50+30*Math.sin(o*1e-4),speed:40+40*Math.sin(o*15e-5),intensity:60+30*Math.sin(o*12e-5),hue:o*2e-4%360,saturation:70+20*Math.sin(o*8e-5),pattern:["Spectrum","Beat Tunnel","Pulse"][Math.floor(Math.random()*3)]})}return a}async startPerformanceMonitoring(){this.emit("performance-monitoring-started")}async stopPerformanceMonitoring(){this.emit("performance-monitoring-stopped")}async startAudioMonitoring(){this.emit("audio-monitoring-started")}async stopAudioMonitoring(){this.emit("audio-monitoring-stopped")}async exportDebugData(t){const r={exportedAt:new Date().toISOString(),deviceInfo:await this.getDeviceInfo(),type:t};switch(t){case"performance":return{...r,metrics:await this.getPerformanceMetrics()};case"audio":return{...r,metrics:await this.getAudioMetrics()};case"parameters":return{...r,history:await this.getParameterHistory()};default:return r}}static async discover(t=5e3){return new Promise(r=>{setTimeout(()=>{const a=[{id:"k1-001",name:"K1.reinvented",ip:"192.168.1.100",port:80,mac:"00:11:22:33:44:55",firmware:"1.0.0",lastSeen:new Date,rssi:-45,discoveryMethod:"mdns"},{id:"k1-002",name:"K1.studio",ip:"192.168.1.101",port:80,mac:"00:11:22:33:44:66",firmware:"1.0.1",lastSeen:new Date(Date.now()-3e4),rssi:-62,discoveryMethod:"scan"}];r(a)},Math.min(t,2e3))})}}const Be={ENDPOINT:"k1:v1:endpoint",PARAMS:"k1:v1:params",PALETTE:"k1:v1:palette",PATTERN:"k1:v1:pattern",FEATURE_FLAGS:"k1:v1:featureFlags",TRANSPORT_PREFS:"k1:v1:transportPrefs",METADATA:"k1:v1:metadata"},$={PARAMETERS:{brightness:80,softness:50,color:50,color_range:50,saturation:75,warmth:50,background:10,dithering:100,speed:50,palette_id:0,custom_param_1:0,custom_param_2:0,custom_param_3:0},RECONNECT:{BASE_DELAY:500,MAX_DELAY:3e4,JITTER_PERCENT:20,MAX_ATTEMPTS:10},FEATURE_FLAGS:{autoReconnect:!0,persistState:!0,enableTelemetry:!0},TELEMETRY:{connectionAttempts:0,successfulConnections:0,failedConnections:0,reconnectionAttempts:0,errorCounts:{connect_error:0,reconnect_giveup:0,ws_send_error:0,rest_error:0,validation_error:0,backup_error:0,restore_error:0},averageLatency:0,latencyHistory:[],totalRequests:0,successfulRequests:0,wsConnectionAttempts:0,wsSuccessfulConnections:0,wsErrors:0,restRequests:0,restErrors:0,sessionStartTime:Date.now(),totalUptime:0,featureUsage:{patternChanges:0,parameterUpdates:0,paletteChanges:0,backups:0,restores:0}},ERROR_SURFACE:{showToasts:!0,logToConsole:!0,reportToTelemetry:!0,maxErrorHistory:10,errorDisplayDuration:5e3}};class Er{hooks=[];errorSurfaceConfig=$.ERROR_SURFACE;toastQueue=[];toastTimeouts=new Map;registerHook(t){return this.hooks.push(t),()=>{const r=this.hooks.indexOf(t);r>-1&&this.hooks.splice(r,1)}}setErrorSurfaceConfig(t){this.errorSurfaceConfig={...this.errorSurfaceConfig,...t}}getErrorSurfaceConfig(){return{...this.errorSurfaceConfig}}recordEvent(t){t.timestamp||(t.timestamp=Date.now()),this.hooks.forEach(r=>{try{r.onEvent(t)}catch(a){console.warn("[TelemetryManager] Hook error:",a)}}),this.errorSurfaceConfig.logToConsole&&console.log(`[K1Telemetry] ${t.type}:${t.category}:${t.action}`,t)}recordMetric(t,r,a){this.hooks.forEach(n=>{try{n.onMetric(t,r,a)}catch(o){console.warn("[TelemetryManager] Hook metric error:",o)}}),this.recordEvent({type:"performance",category:"metric",action:t,value:r,metadata:a,timestamp:Date.now()})}handleError(t,r){t.timestamp=new Date,this.errorSurfaceConfig.logToConsole&&console.error(`[K1Error] ${t.type}: ${t.message}`,{error:t,context:r,originalError:t.originalError}),this.errorSurfaceConfig.showToasts&&this.showErrorToast(t),this.errorSurfaceConfig.reportToTelemetry&&this.recordEvent({type:"error",category:t.type,action:"error_occurred",label:t.message,metadata:{details:t.details,retryAttempt:t.retryAttempt,context:r},timestamp:t.timestamp.getTime()}),this.hooks.forEach(a=>{try{a.onError(t,r)}catch(n){console.warn("[TelemetryManager] Hook error handling failed:",n)}})}showErrorToast(t){const r=`${t.type}-${t.timestamp.getTime()}`;this.toastQueue.push({error:t,timestamp:Date.now()}),this.toastQueue.length>5&&this.toastQueue.shift(),this.createToastElement(t,r);const a=setTimeout(()=>{this.removeToast(r)},this.errorSurfaceConfig.errorDisplayDuration);this.toastTimeouts.set(r,a)}createToastElement(t,r){let a=document.getElementById("k1-toast-container");if(!a){if(!document.body||typeof document.body.appendChild!="function")return;const i=document.createElement("div");i.id="k1-toast-container",i.style.cssText=`
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10000;
        pointer-events: none;
      `,document.body.appendChild(i),a=i}if(!a||!("appendChild"in a))return;const n=document.createElement("div");if(n.id=r,n.style.cssText=`
      background: var(--k1-error, #dc2626);
      color: white;
      padding: 12px 16px;
      border-radius: 8px;
      margin-bottom: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 14px;
      max-width: 400px;
      pointer-events: auto;
      cursor: pointer;
      animation: k1ToastSlideIn 0.3s ease-out;
    `,!document.getElementById("k1-toast-styles")&&document.head&&typeof document.head.appendChild=="function"){const i=document.createElement("style");i.id="k1-toast-styles",i.textContent=`
          @keyframes k1ToastSlideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
          }
          @keyframes k1ToastSlideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
          }
        `,document.head.appendChild(i)}const o=this.getErrorTitle(t.type);n.innerHTML=`
      <div style="font-weight: 600; margin-bottom: 4px;">${o}</div>
      <div style="font-size: 13px; opacity: 0.9;">${t.message}</div>
      ${t.retryAttempt?`<div style="font-size: 12px; opacity: 0.7; margin-top: 4px;">Attempt ${t.retryAttempt}</div>`:""}
    `,n.addEventListener("click",()=>{this.removeToast(r)}),a.appendChild(n)}removeToast(t){const r=document.getElementById(t);r&&(r.style.animation="k1ToastSlideOut 0.3s ease-in",setTimeout(()=>{r.remove()},300));const a=this.toastTimeouts.get(t);a&&(clearTimeout(a),this.toastTimeouts.delete(t))}getErrorTitle(t){return{connect_error:"Connection Failed",reconnect_giveup:"Reconnection Failed",ws_send_error:"WebSocket Error",rest_error:"API Error",validation_error:"Validation Error",timeout_error:"Request Timeout",network_error:"Network Error",backup_error:"Backup Failed",restore_error:"Restore Failed"}[t]||"K1 Error"}updateTelemetryForError(t,r){const a={...t};return r.type in a.errorCounts&&a.errorCounts[r.type]++,a.lastErrorTime=r.timestamp.getTime(),r.type==="connect_error"?a.failedConnections++:r.type==="ws_send_error"?a.wsErrors++:r.type==="rest_error"&&a.restErrors++,a}updateTelemetryForSuccess(t,r,a){const n={...t};switch(n.totalRequests++,n.successfulRequests++,a!==void 0&&(n.latencyHistory=[...n.latencyHistory,a].slice(-10),n.averageLatency=n.latencyHistory.reduce((o,i)=>o+i,0)/n.latencyHistory.length),r){case"pattern_change":n.featureUsage.patternChanges++;break;case"parameter_update":n.featureUsage.parameterUpdates++;break;case"palette_change":n.featureUsage.paletteChanges++;break;case"backup":n.featureUsage.backups++;break;case"restore":n.featureUsage.restores++;break}return n}updateTelemetryForConnection(t,r){const a={...t};switch(r){case"attempt":a.connectionAttempts++;break;case"success":a.successfulConnections++;break;case"ws_attempt":a.wsConnectionAttempts++;break;case"ws_success":a.wsSuccessfulConnections++;break;case"reconnect_attempt":a.reconnectionAttempts++;break}return a}calculateUptime(t){return Date.now()-t.sessionStartTime}getTelemetrySummary(t){const r=this.calculateUptime(t),a=Object.values(t.errorCounts).reduce((n,o)=>n+o,0);return{session:{uptime:r,startTime:new Date(t.sessionStartTime).toISOString()},connections:{attempts:t.connectionAttempts,successful:t.successfulConnections,failed:t.failedConnections,successRate:t.connectionAttempts>0?(t.successfulConnections/t.connectionAttempts*100).toFixed(1)+"%":"0%"},requests:{total:t.totalRequests,successful:t.successfulRequests,successRate:t.totalRequests>0?(t.successfulRequests/t.totalRequests*100).toFixed(1)+"%":"0%",averageLatency:Math.round(t.averageLatency)+"ms"},errors:{total:a,byType:t.errorCounts,lastErrorTime:t.lastErrorTime?new Date(t.lastErrorTime).toISOString():null},transport:{websocket:{attempts:t.wsConnectionAttempts,successful:t.wsSuccessfulConnections,errors:t.wsErrors},rest:{requests:t.restRequests,errors:t.restErrors}},features:t.featureUsage}}resetTelemetry(){return{...$.TELEMETRY,sessionStartTime:Date.now()}}cleanup(){this.toastTimeouts.forEach(r=>clearTimeout(r)),this.toastTimeouts.clear();const t=document.getElementById("k1-toast-container");t&&t.remove(),this.hooks=[],this.toastQueue=[]}}const G=new Er,K={handleError:(s,t)=>G.handleError(s,t),recordEvent:s=>G.recordEvent(s),recordMetric:(s,t,r)=>G.recordMetric(s,t,r),registerHook:s=>G.registerHook(s),setErrorSurfaceConfig:s=>G.setErrorSurfaceConfig(s),getErrorSurfaceConfig:()=>G.getErrorSurfaceConfig(),updateForError:(s,t)=>G.updateTelemetryForError(s,t),updateForSuccess:(s,t,r)=>G.updateTelemetryForSuccess(s,t,r),updateForConnection:(s,t)=>G.updateTelemetryForConnection(s,t),getSummary:s=>G.getTelemetrySummary(s),reset:()=>G.resetTelemetry(),cleanup:()=>G.cleanup()};class Cr{recording=!1;session=null;start(t,r,a){this.recording||(this.recording=!0,this.session={startedAt:Date.now(),deviceInfo:t,endpoint:r,meta:a,performance:[],audio:[],parameters:[]})}stop(){!this.recording||!this.session||(this.recording=!1,this.session.stoppedAt=Date.now())}isRecording(){return this.recording}recordRealtime(t){if(!this.recording||!this.session)return;const r=Date.now();t.performance&&this.session.performance.push({t:r,data:t.performance}),t.audio&&this.session.audio.push({t:r,data:t.audio}),t.parameters&&this.session.parameters.push({t:r,data:t.parameters})}recordPerformance(t){!this.recording||!this.session||this.session.performance.push({t:Date.now(),data:t})}recordAudio(t){!this.recording||!this.session||this.session.audio.push({t:Date.now(),data:t})}recordParameters(t){!this.recording||!this.session||this.session.parameters.push({t:Date.now(),data:t})}export(){return this.session?{success:!0,data:{...this.session,performance:this.session.performance.slice(-6e4),audio:this.session.audio.slice(-6e4),parameters:this.session.parameters.slice(-6e4)}}:{success:!1,error:"No session"}}reset(){this.recording=!1,this.session=null}}const ut=new Cr,Ft=c.createContext(null);function $t(){const s=c.useContext(Ft);if(!s)throw new Error("useErrorHandler must be used within ErrorProvider");return s}function zt(s){return`k1:v1:params:${s}`}function Tr(s){return`k1:v1:palette:${s}`}function Ut(s){if(!s||typeof s!="object")return null;try{return{brightness:Y(s.brightness,0,100,$.PARAMETERS.brightness),softness:Y(s.softness,0,100,$.PARAMETERS.softness),color:Y(s.color,0,100,$.PARAMETERS.color),color_range:Y(s.color_range,0,100,$.PARAMETERS.color_range),saturation:Y(s.saturation,0,100,$.PARAMETERS.saturation),warmth:Y(s.warmth,0,100,$.PARAMETERS.warmth),background:Y(s.background,0,100,$.PARAMETERS.background),dithering:Y(s.dithering,0,100,$.PARAMETERS.dithering),speed:Y(s.speed,0,100,$.PARAMETERS.speed),palette_id:Y(s.palette_id,0,32,$.PARAMETERS.palette_id),custom_param_1:Y(s.custom_param_1,0,100,$.PARAMETERS.custom_param_1),custom_param_2:Y(s.custom_param_2,0,100,$.PARAMETERS.custom_param_2),custom_param_3:Y(s.custom_param_3,0,100,$.PARAMETERS.custom_param_3)}}catch(t){return console.warn("Failed to validate parameters:",t),null}}function Sr(s){const t=parseInt(String(s));return Y(t,0,32,0)}function _r(s){if(typeof s!="string"||!s.trim())return null;const t=s.trim();return/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(t)||/^[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(t)?t:null}function Y(s,t,r,a){const n=parseFloat(String(s));return isNaN(n)?a:Math.max(t,Math.min(r,n))}function He(s,t){try{return localStorage.setItem(s,t),!0}catch(r){return console.warn(`Failed to save to localStorage (${s}):`,r),!1}}function Bt(s){try{return localStorage.getItem(s)}catch(t){return console.warn(`Failed to read from localStorage (${s}):`,t),null}}function Dr(s,t){const r=zt(s),a=Ut(t);return a?He(r,JSON.stringify(a)):(console.warn(`Invalid parameters for pattern ${s}`),!1)}function Mr(s){const t=zt(s),r=Bt(t);if(!r)return null;try{const a=JSON.parse(r);return Ut(a)}catch(a){return console.warn(`Failed to parse parameters for pattern ${s}:`,a),null}}function Rr(s,t){const r=Tr(s),a=Sr(t);return He(r,a.toString())}function Ht(s){if(!s||typeof s!="object")return null;const t=typeof s.wsEnabled=="boolean"?s.wsEnabled:!0,r=s.preferredTransport==="ws"||s.preferredTransport==="rest"?s.preferredTransport:t?"ws":"rest",a=typeof s.autoReconnect=="boolean"?s.autoReconnect:!0;return{wsEnabled:t,preferredTransport:r,autoReconnect:a}}function Ar(s){const t=Ht(s);return t?He(Be.TRANSPORT_PREFS,JSON.stringify(t)):!1}function Ke(){const s=Bt(Be.TRANSPORT_PREFS);if(!s)return null;try{const t=JSON.parse(s);return Ht(t)}catch(t){return console.warn("Failed to parse transport preferences:",t),null}}function mt(s){const t=_r(s);return t?He(Be.ENDPOINT,t):(console.warn("Invalid endpoint:",s),!1)}function We(s,t,r){try{if(window.dispatchEvent(new CustomEvent("k1:storageChange",{detail:{key:s,newValue:t,oldValue:r}})),s==="k1.hmrOverlay"){const a=t==="true"||t==="1";window.dispatchEvent(new CustomEvent("k1:hmrOverlayChange",{detail:{enabled:a}}))}}catch{}}const ht={},Ir=1e4,Pr=["AbortError","AbortErrorSignal","AbortController"],Or=/(abort|cancel)/i,Vt="k1.debugAborts",W={windowCount:0,totalCount:0,lastWindowStart:Date.now(),windowMs:Ir,loggingEnabled:void 0,hmrSuppressUntil:0};function ot(s){if(typeof s=="string"){const t=s.toLowerCase();if(t==="true"||t==="1")return!0;if(t==="false"||t==="0")return!1}if(typeof s=="boolean")return s}function Lr(s){try{if(typeof window>"u"||!window.location)return;const r=new URLSearchParams(window.location.search).get(s);return ot(r)}catch{return}}function Fr(s){try{if(typeof localStorage>"u")return;const t=localStorage.getItem(s);return ot(t)}catch{return}}function Kt(){if(typeof W.loggingEnabled=="boolean")return W.loggingEnabled;const s=ht?.VITE_K1_DEBUG_ABORTS??ht?.VITE_DEBUG_ABORTS;return ot(s),Lr("debugAborts"),Fr(Vt),W.loggingEnabled=!1,W.loggingEnabled}function $r(){if(!Kt())return;const s=Date.now();s-W.lastWindowStart>=W.windowMs&&(W.windowCount>0&&console.debug(`[K1] HMR aborts: ${W.windowCount} in ${W.windowMs}ms (total: ${W.totalCount})`),W.windowCount=0,W.lastWindowStart=s)}function zr(){const s=Date.now();if(s<W.hmrSuppressUntil){W.totalCount+=1;return}const t=s-W.lastWindowStart;W.windowCount===0&&t<2e3&&(W.hmrSuppressUntil=s+3e3),W.windowCount+=1,W.totalCount+=1,$r()}function Wt(s){W.loggingEnabled=s;try{typeof localStorage<"u"&&localStorage.setItem(Vt,s?"1":"0")}catch{}}function gt(){return!!Kt()}function Ur(s){if(!s)return!1;const t=s,r=t?.name,a=t?.message,n=typeof DOMException<"u"&&s instanceof DOMException&&s.name==="AbortError",o=r&&Pr.includes(r),i=typeof a=="string"&&Or.test(a),u=!!(n||o||i);return u&&zr(),u}const qe={},rt={connection:"disconnected",deviceInfo:null,transport:{wsAvailable:!1,restAvailable:!1,wsDisabled:!1,activeTransport:"rest"},reconnect:{attemptCount:0,nextDelay:$.RECONNECT.BASE_DELAY,maxDelay:$.RECONNECT.MAX_DELAY,isActive:!1},selectedPatternId:null,parameters:$.PARAMETERS,activePaletteId:0,lastError:null,errorHistory:[],featureFlags:$.FEATURE_FLAGS,telemetry:$.TELEMETRY,recording:!1};function Br(s,t){switch(t.type){case"SET_CONNECTION_STATE":return{...s,connection:t.payload};case"SET_DEVICE_INFO":return{...s,deviceInfo:t.payload};case"SET_SELECTED_PATTERN":return{...s,selectedPatternId:t.payload};case"SET_PARAMETERS":return{...s,parameters:t.payload};case"UPDATE_PARAMETERS":return{...s,parameters:{...s.parameters,...t.payload}};case"SET_PALETTE":return{...s,activePaletteId:t.payload};case"SET_ERROR":return{...s,lastError:t.payload,errorHistory:[t.payload,...s.errorHistory].slice(0,10),telemetry:K.updateForError(s.telemetry,t.payload)};case"CLEAR_ERROR":return{...s,lastError:null};case"CLEAR_ERROR_HISTORY":return{...s,errorHistory:[]};case"SET_TRANSPORT_FLAGS":return{...s,transport:{...s.transport,...t.payload}};case"SET_RECONNECT_STATE":return{...s,reconnect:{...s.reconnect,...t.payload}};case"SET_FEATURE_FLAG":return{...s,featureFlags:{...s.featureFlags,[t.payload.flag]:t.payload.value}};case"INCREMENT_TELEMETRY":const{metric:r,value:a=1}=t.payload;if(r.includes(".")){const[n,o]=r.split("."),i=s.telemetry[n];if(i&&typeof i=="object")return{...s,telemetry:{...s.telemetry,[n]:{...i,[o]:(i[o]||0)+a}}}}else return{...s,telemetry:{...s.telemetry,[r]:(s.telemetry[r]||0)+a}};return s;case"UPDATE_TELEMETRY":return{...s,telemetry:t.payload};case"SET_RECORDING":return{...s,recording:t.payload};case"RESET_STATE":return rt;default:return s}}const qt=c.createContext(null);function Hr({children:s,initialEndpoint:t="192.168.1.103",initialFeatureFlags:r={},hmrDelayMs:a,devConfig:n}){const[o,i]=c.useReducer(Br,{...rt,featureFlags:{...rt.featureFlags,...r}}),u=qe?.VITE_K1_HMR_DELAY_MS,l=typeof u=="string"?parseInt(u,10):void 0,m=qe?.VITE_K1_DEBUG_ABORTS??qe?.VITE_DEBUG_ABORTS,d=typeof m=="string"?m.toLowerCase()==="true"||m==="1":void 0,v=(()=>{try{const b=typeof window<"u"?new URLSearchParams(window.location.search).get("debugAborts"):null;if(!b)return;const w=b.toLowerCase();return w==="true"||w==="1"?!0:w==="false"||w==="0"?!1:void 0}catch{return}})(),f=(()=>{try{const b=typeof localStorage<"u"?localStorage.getItem("k1.debugAborts"):null;if(!b)return;const w=b.toLowerCase();return w==="true"||w==="1"?!0:w==="false"||w==="0"?!1:void 0}catch{return}})(),C=typeof(n?.hmrDelayMs??a)=="number"?n?.hmrDelayMs??a:Number.isFinite(l)?l:void 0,h=typeof n?.debugAborts=="boolean"?n?.debugAborts:typeof v=="boolean"?v:typeof f=="boolean"?f:typeof d=="boolean"?d:void 0;c.useEffect(()=>{typeof h=="boolean"&&Wt(h)},[h]),c.useEffect(()=>{const b=Ke();b&&i({type:"SET_TRANSPORT_FLAGS",payload:{wsDisabled:!b.wsEnabled}})},[]);const j=c.useRef(null),p=c.useRef(null),{showError:N}=$t(),x=c.useCallback((b,w,S,I)=>{const g=w instanceof Error?w:void 0,A=w instanceof Error?w.message:String(w);i({type:"SET_ERROR",payload:{type:b,message:A,details:S,timestamp:new Date,originalError:g,retryAttempt:I}})},[]),k=c.useCallback(b=>{const w=$.RECONNECT.BASE_DELAY*Math.pow(2,Math.max(0,b-1)),S=$.RECONNECT.JITTER_PERCENT/100,I=w*S*(Math.random()*2-1);return Math.min($.RECONNECT.MAX_DELAY,Math.max(0,Math.round(w+I)))},[]),E=c.useCallback((b=1)=>{const w=Math.max(1,b),S=k(w);if(i({type:"SET_RECONNECT_STATE",payload:{isActive:!0,attemptCount:w,nextDelay:S,lastAttempt:new Date}}),i({type:"UPDATE_TELEMETRY",payload:K.updateForConnection(o.telemetry,"reconnect_attempt")}),p.current)try{clearTimeout(p.current)}catch{}p.current=setTimeout(async()=>{const I=j.current,g=I?.getEndpoint?.();if(!I||!g){x("network_error",new Error("No client or endpoint for reconnect")),i({type:"SET_RECONNECT_STATE",payload:{isActive:!1}});return}try{await I.connect(g),i({type:"SET_CONNECTION_STATE",payload:"connected"}),i({type:"SET_RECONNECT_STATE",payload:{isActive:!1,attemptCount:0,nextDelay:$.RECONNECT.BASE_DELAY}})}catch(A){const P=w+1;if(P>$.RECONNECT.MAX_ATTEMPTS){i({type:"SET_RECONNECT_STATE",payload:{isActive:!1}}),x("reconnect_giveup",A,"Max reconnection attempts reached",w);return}E(P)}},S)},[k,x,o.telemetry]);c.useEffect(()=>{if(!t)return;const w=(_=>_.startsWith("http://")||_.startsWith("https://")?_:`http://${_}`)(t);i({type:"UPDATE_TELEMETRY",payload:K.updateForConnection(o.telemetry,"attempt")}),i({type:"SET_CONNECTION_STATE",payload:"connecting"});const S=new Ee(w);S.setErrorHandler(N);const I=()=>{E(1)},g=({deviceInfo:_})=>{if(i({type:"SET_CONNECTION_STATE",payload:"connected"}),i({type:"SET_DEVICE_INFO",payload:_}),p.current){try{clearTimeout(p.current)}catch{}p.current=null}i({type:"SET_RECONNECT_STATE",payload:{isActive:!1,attemptCount:0,nextDelay:$.RECONNECT.BASE_DELAY}})},A=({error:_})=>{x("network_error",_)};S.on?.("close",I),S.on?.("open",g),S.on?.("error",A);const P=Ke();return P&&S.setWebSocketEnabled(P.wsEnabled),j.current=S,S.connect(w).then(_=>{i({type:"SET_CONNECTION_STATE",payload:"connected"}),i({type:"SET_DEVICE_INFO",payload:_}),i({type:"UPDATE_TELEMETRY",payload:K.updateForConnection(o.telemetry,"success")}),mt(w)}).catch(_=>{i({type:"SET_CONNECTION_STATE",payload:"error"}),x("connect_error",_,"Initial auto-connect failed"),N(_,{context:"connection"})}),()=>{S.off?.("close",I),S.off?.("open",g),S.off?.("error",A)}},[t,N,E,o.telemetry,x]),c.useEffect(()=>{try{localStorage.setItem(Be.FEATURE_FLAGS,JSON.stringify(o.featureFlags))}catch{}},[o.featureFlags,o.connection]);const D={connect:c.useCallback(async b=>{try{const w=b||t;if(!w)throw new Error("No endpoint provided");const I=(T=>T.startsWith("http://")||T.startsWith("https://")?T:`http://${T}`)(w);i({type:"UPDATE_TELEMETRY",payload:K.updateForConnection(o.telemetry,"attempt")}),i({type:"SET_CONNECTION_STATE",payload:"connecting"});const g=new Ee(I);g.setErrorHandler(N);const A=()=>E(1),P=({deviceInfo:T})=>{if(i({type:"SET_CONNECTION_STATE",payload:"connected"}),i({type:"SET_DEVICE_INFO",payload:T}),p.current){try{clearTimeout(p.current)}catch{}p.current=null}i({type:"SET_RECONNECT_STATE",payload:{isActive:!1,attemptCount:0,nextDelay:$.RECONNECT.BASE_DELAY}})},_=({error:T})=>x("network_error",T);g.on?.("close",A),g.on?.("open",P),g.on?.("error",_);const R=Ke();R&&g.setWebSocketEnabled(R.wsEnabled),j.current=g;const Q=await g.connect(I);i({type:"SET_CONNECTION_STATE",payload:"connected"}),i({type:"SET_DEVICE_INFO",payload:Q}),i({type:"UPDATE_TELEMETRY",payload:K.updateForConnection(o.telemetry,"success")}),mt(I)}catch(w){throw i({type:"SET_CONNECTION_STATE",payload:"error"}),x("connect_error",w,"Manual connect failed"),N(w,{context:"connection"}),w}},[N,E,o.telemetry,x]),disconnect:c.useCallback(async()=>{try{j.current&&(await j.current.disconnect(),j.current=null),i({type:"SET_CONNECTION_STATE",payload:"disconnected"}),i({type:"SET_DEVICE_INFO",payload:null})}catch(b){x("network_error",b,"Disconnection failed"),N(b,{context:"disconnection"})}},[N]),selectPattern:c.useCallback(async b=>{try{if(!j.current)throw new Error("Not connected");await j.current.selectPattern(b),i({type:"SET_SELECTED_PATTERN",payload:b});const w=Mr(b);w&&i({type:"UPDATE_PARAMETERS",payload:w})}catch(w){throw x("rest_error",w,"Pattern selection failed"),N(w,{context:"pattern-selection",patternId:b}),w}},[N]),updateParameters:c.useCallback(async b=>{try{if(!j.current)throw new Error("Not connected");const w=await j.current.updateParameters(b);return w.success?(i({type:"UPDATE_PARAMETERS",payload:b}),i({type:"UPDATE_TELEMETRY",payload:K.updateForSuccess(o.telemetry,"parameter_update")})):x("rest_error",new Error(w.error?.error||"Parameter update failed")),o.selectedPatternId&&Dr(o.selectedPatternId,{...o.parameters,...b}),w}catch(w){throw x("rest_error",w,"Parameter update threw"),N(w,{context:"parameter-update",params:b}),w}},[N,o.selectedPatternId,o.parameters,o.telemetry,x]),setPalette:c.useCallback(async b=>{try{if(!j.current)throw new Error("Not connected");const w=await j.current.setPalette(b);w.success?(i({type:"SET_PALETTE",payload:b}),i({type:"UPDATE_TELEMETRY",payload:K.updateForSuccess(o.telemetry,"palette_change")})):x("rest_error",new Error(w.error?.error||"Palette update failed")),o.selectedPatternId&&Rr(o.selectedPatternId,b)}catch(w){throw x("rest_error",w,"Palette change threw"),N(w,{context:"palette-change",paletteId:b}),w}},[N,o.selectedPatternId,o.telemetry,x]),clearError:c.useCallback(()=>{i({type:"CLEAR_ERROR"})},[]),clearErrorHistory:c.useCallback(()=>{i({type:"CLEAR_ERROR_HISTORY"})},[]),setFeatureFlag:c.useCallback((b,w)=>{i({type:"SET_FEATURE_FLAG",payload:{flag:b,value:w}})},[]),startReconnection:c.useCallback(()=>{E(1)},[E]),stopReconnection:c.useCallback(()=>{if(p.current){try{clearTimeout(p.current)}catch{}p.current=null}i({type:"SET_RECONNECT_STATE",payload:{isActive:!1,attemptCount:0,nextDelay:$.RECONNECT.BASE_DELAY}})},[]),setWebSocketEnabled:c.useCallback(b=>{j.current&&j.current.setWebSocketEnabled(b),i({type:"SET_TRANSPORT_FLAGS",payload:{wsDisabled:!b}});const w=o.featureFlags.autoReconnect;Ar({wsEnabled:b,preferredTransport:b?"ws":"rest",autoReconnect:w});try{window.dispatchEvent(new CustomEvent("k1:transportChange",{detail:{preferredTransport:b?"ws":"rest",wsEnabled:b}}))}catch{}},[o.featureFlags]),getTransportStatus:c.useCallback(()=>j.current?j.current.getTransportStatus():{wsAvailable:!1,wsEnabled:!0,restAvailable:!1,activeTransport:"rest",lastWSError:null},[]),testTransportRouting:c.useCallback(async()=>{if(!j.current)throw new Error("Not connected");return await j.current.updateParameters({})},[]),backupConfig:c.useCallback(async()=>{if(!j.current)throw new Error("Not connected");try{const b=await j.current.backupConfig();return i({type:"UPDATE_TELEMETRY",payload:K.updateForSuccess(o.telemetry,"backup")}),b}catch(b){throw x("backup_error",b),b}},[o.telemetry,x]),restoreConfig:c.useCallback(async b=>{if(!j.current)throw new Error("Not connected");try{const w=await j.current.restoreConfig(b);return i({type:"UPDATE_TELEMETRY",payload:K.updateForSuccess(o.telemetry,"restore")}),w}catch(w){throw x("restore_error",w),w}},[o.telemetry,x]),getStorageInfo:c.useCallback(()=>({totalKeys:0,k1Keys:0,totalSize:0,k1Size:0,metadata:{},health:"good",issues:[]}),[]),cleanupStorage:c.useCallback(b=>({removed:[],errors:[]}),[]),exportStorageData:c.useCallback(()=>({success:!0,data:{}}),[]),importStorageData:c.useCallback(b=>({success:!0,imported:[],errors:[]}),[]),getTelemetryState:c.useCallback(()=>o.telemetry,[o.telemetry]),resetTelemetry:c.useCallback(()=>{i({type:"UPDATE_TELEMETRY",payload:$.TELEMETRY})},[]),registerTelemetryHook:c.useCallback(b=>()=>{},[]),setErrorSurfaceConfig:c.useCallback(b=>{},[]),getErrorSurfaceConfig:c.useCallback(()=>({}),[]),subscribeRealtime:c.useCallback(b=>()=>{},[]),subscribeAudio:c.useCallback(b=>()=>{},[]),subscribePerformance:c.useCallback(b=>()=>{},[]),startSessionRecording:c.useCallback(()=>{ut.start(),i({type:"SET_RECORDING",payload:!0})},[]),stopSessionRecording:c.useCallback(()=>{ut.stop(),i({type:"SET_RECORDING",payload:!1})},[]),exportSessionRecording:c.useCallback(()=>({success:!0,data:{}}),[])};return e.jsxs(qt.Provider,{value:{state:o,actions:D,config:{hmrDelayMs:C,debugAborts:h}},children:[s,!1]})}function ct(){const s=c.useContext(qt);if(!s)throw new Error("useK1 must be used within a K1Provider");return s}function xe(){return ct().state}function le(){return ct().actions}function Vr(){return ct().config}function Kr({isConnected:s,connectionStatus:t,onConnect:r,connectionIP:a,onIPChange:n}){const[o,i]=c.useState(!1),[u,l]=c.useState("/dev/tty.usbserial-0001"),[m,d]=c.useState(!0),v=le(),f=x=>/^(\d{1,3}\.){3}\d{1,3}$/.test(x),C=x=>{n(x),d(f(x))},h=async()=>{if(!f(a)){X.error("Invalid IP address format");return}i(!0);try{s?(await v.disconnect(),X.info("Disconnected from device")):(await v.connect(a),X.success("Connected to device",{description:`Connected to ${a}`}))}catch(x){X.error("Connection failed",{description:x instanceof Error?x.message:"Unknown error"})}finally{i(!1)}},j=async()=>{try{const x=await v.backupConfig(),k=new Blob([JSON.stringify(x,null,2)],{type:"application/json"}),E=URL.createObjectURL(k),D=document.createElement("a");D.href=E,D.download=`k1-config-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(D),D.click(),document.body.removeChild(D),URL.revokeObjectURL(E),X.success("Configuration backed up successfully")}catch(x){X.error("Failed to backup configuration",{description:x instanceof Error?x.message:"Unknown error"})}},p=async x=>{try{const k=await x.text(),E=JSON.parse(k),D=await v.restoreConfig(E);D.success?X.success("Configuration restored successfully"):X.error("Failed to restore configuration",{description:D.message||"Unknown error"})}catch(k){X.error("Failed to restore configuration",{description:k instanceof Error?k.message:"Invalid file format"})}},N=()=>{const x=document.createElement("input");x.type="file",x.accept=".json",x.onchange=k=>{const E=k.target.files?.[0];E&&p(E)},x.click()};return e.jsxs("aside",{className:"w-[var(--lib-w)] bg-[var(--k1-bg-elev)] border-r border-[var(--k1-border)] p-6 flex flex-col gap-6 overflow-auto",children:[e.jsxs(F,{className:"p-6 bg-[var(--k1-panel)] border-[var(--k1-border)]",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ae,{className:"w-4 h-4 text-[var(--k1-accent)]"}),e.jsx("h3",{className:"text-[var(--k1-text)]",children:"Device Connection"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(V,{htmlFor:"ip-input",className:"text-[var(--k1-text-dim)]",children:"IP Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ne,{id:"ip-input",value:a,onChange:x=>C(x.target.value),placeholder:"k1-reinvented.local or 192.168.1.103",className:`font-[family-name:var(--k1-code-family)] ${m?"":"border-[var(--k1-error)]"}`,disabled:s}),!m&&e.jsx(ke,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-[var(--k1-error)]"})]}),!m&&e.jsx("p",{className:"text-[var(--k1-error)] text-[10px]",children:"Please enter a valid IP address"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(V,{htmlFor:"serial-select",className:"text-[var(--k1-text-dim)]",children:"Serial Port"}),e.jsxs(ue,{value:u,onValueChange:l,disabled:s,children:[e.jsx(he,{id:"serial-select",className:"font-[family-name:var(--k1-code-family)]",children:e.jsx(me,{})}),e.jsxs(ge,{children:[e.jsx(U,{value:"/dev/tty.usbserial-0001",children:"/dev/tty.usbserial-0001"}),e.jsx(U,{value:"/dev/tty.usbserial-0002",children:"/dev/tty.usbserial-0002"}),e.jsx(U,{value:"COM3",children:"COM3"}),e.jsx(U,{value:"COM4",children:"COM4"})]})]})]}),e.jsx(z,{onClick:h,disabled:o||!m,className:"w-full",variant:s?"destructive":"default",children:o?e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"w-4 h-4 mr-2 animate-spin"}),"Connecting..."]}):s?e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"Disconnect"]}):"Connect"}),s&&e.jsxs("div",{className:"pt-3 border-t border-[var(--k1-border)] space-y-1.5",children:[e.jsxs("div",{className:"flex justify-between text-[10px]",children:[e.jsx("span",{className:"text-[var(--k1-text-dim)]",children:"Uptime"}),e.jsx("span",{className:"text-[var(--k1-text)] font-[family-name:var(--k1-code-family)]",children:"00:12:34"})]}),e.jsxs("div",{className:"flex justify-between text-[10px]",children:[e.jsx("span",{className:"text-[var(--k1-text-dim)]",children:"Latency"}),e.jsx("span",{className:"text-[var(--k1-success)] font-[family-name:var(--k1-code-family)]",children:"45ms"})]}),e.jsxs("div",{className:"flex justify-between text-[10px]",children:[e.jsx("span",{className:"text-[var(--k1-text-dim)]",children:"Packets"}),e.jsx("span",{className:"text-[var(--k1-text)] font-[family-name:var(--k1-code-family)]",children:"1,234 sent"})]})]})]})]}),e.jsxs(F,{className:"p-6 bg-[var(--k1-panel)] border-[var(--k1-border)]",children:[e.jsx("h3",{className:"text-[var(--k1-text)] mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(z,{variant:"ghost",className:"w-full justify-start",disabled:!s,onClick:()=>X.success("Device data refreshed"),children:[e.jsx(wt,{className:"w-4 h-4 mr-2"}),"Refresh Data"]}),e.jsxs(z,{variant:"ghost",className:"w-full justify-start",disabled:!s,onClick:j,children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),"Backup Config"]}),e.jsxs(z,{variant:"ghost",className:"w-full justify-start",disabled:!s,onClick:N,children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Restore Config"]}),e.jsxs(z,{variant:"ghost",className:"w-full justify-start",disabled:!s,children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Device Settings"]})]})]}),e.jsx("div",{className:"mt-auto p-3 bg-[var(--k1-bg)] rounded-lg",children:e.jsxs("p",{className:"text-[10px] text-[var(--k1-text-dim)] leading-relaxed",children:[e.jsx("strong",{className:"text-[var(--k1-accent)]",children:"Tip:"})," Ensure your Emotiscope device is powered on and connected to the same network."]})})]})}const Wr=[{id:"analog",name:"Analog",icon:js,color:"var(--k1-accent)",description:"Classic VU meter visualization"},{id:"spectrum",name:"Spectrum",icon:ws,color:"var(--port-field)",description:"Full frequency spectrum analyzer"},{id:"octave",name:"Octave",icon:ks,color:"var(--port-color)",description:"Octave band visualization"},{id:"metronome",name:"Metronome",icon:Ns,color:"var(--k1-warning)",description:"Beat-synced pulse effect"},{id:"spectronome",name:"Spectronome",icon:kt,color:"var(--k1-accent-2)",description:"Spectrum + beat sync hybrid"},{id:"hype",name:"Hype",icon:Nt,color:"var(--k1-error)",description:"Energy-reactive intensity mode"},{id:"bloom",name:"Bloom",icon:Es,color:"var(--port-output)",description:"Expanding radial patterns"},{id:"pulse",name:"PULSE",icon:Et,color:"var(--k1-accent)",description:"Rhythmic pulsating effect"},{id:"sparkle",name:"SPARKLE",icon:Cs,color:"var(--port-scalar)",description:"Random sparkling particles"}];function qr({selectedEffect:s,onEffectChange:t}){return e.jsxs(F,{className:"h-full",children:[e.jsx(Pt,{children:e.jsx(Ot,{children:"Effect Selector"})}),e.jsx(Lt,{className:"space-y-2",children:Wr.map(r=>e.jsxs("button",{onClick:()=>t(r.id),className:`
              w-full p-3 rounded-lg border text-left transition-all duration-200
              flex items-center gap-3 hover:bg-k1-surface-hover
              ${s===r.id?"border-k1-accent bg-k1-accent/10 text-k1-accent":"border-k1-border bg-k1-surface text-k1-text-secondary hover:border-k1-border-hover"}
            `,children:[e.jsx(r.icon,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm",children:r.name}),e.jsx("div",{className:"text-xs opacity-70 truncate",children:r.description})]})]},r.id))})]})}function Z({className:s,defaultValue:t,value:r,min:a=0,max:n=100,...o}){const i=c.useMemo(()=>Array.isArray(r)?r:Array.isArray(t)?t:[a,n],[r,t,a,n]);return e.jsxs(Ts,{"data-slot":"slider",defaultValue:t,value:r,min:a,max:n,className:O("relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col",s),...o,children:[e.jsx(Ss,{"data-slot":"slider-track",className:O("bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-4 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5"),children:e.jsx(_s,{"data-slot":"slider-range",className:O("bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full")})}),Array.from({length:i.length},(u,l)=>e.jsx(Ds,{"data-slot":"slider-thumb",className:"border-primary bg-background ring-ring/50 block size-4 shrink-0 rounded-full border shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"},l))]})}function lt({className:s,...t}){return e.jsx(Ms,{"data-slot":"switch",className:O("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-switch-background focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:e.jsx(Rs,{"data-slot":"switch-thumb",className:O("bg-card dark:data-[state=unchecked]:bg-card-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}const Gr=At("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function ve({className:s,variant:t,asChild:r=!1,...a}){const n=r?yt:"span";return e.jsx(n,{"data-slot":"badge",className:O(Gr({variant:t}),s),...a})}function dt(s=80){const t=le(),{transport:r}=xe(),a=c.useRef({}),n=c.useRef(null),o=c.useCallback(async()=>{n.current&&(window.clearTimeout(n.current),n.current=null);const u=a.current;if(a.current={},Object.keys(u).length>0)try{await t.updateParameters(u)}catch(m){console.warn("[useCoalescedParams] updateParameters failed:",m)}},[t]);return{queue:c.useCallback(u=>{a.current={...a.current,...u},n.current&&window.clearTimeout(n.current);const m=r.activeTransport==="ws"&&r.wsAvailable?Math.min(s,80):Math.max(s,140);n.current=window.setTimeout(o,m)},[o,s,r]),flush:o}}const Yr={analog:[{id:"sensitivity",label:"Sensitivity",type:"slider",defaultValue:75,min:0,max:100,step:1,unit:"%",description:"Microphone input sensitivity"},{id:"decay",label:"Decay Rate",type:"slider",defaultValue:50,min:0,max:100,step:1,unit:"%",description:"Speed of level fall-off"},{id:"smoothing",label:"Smoothing",type:"slider",defaultValue:30,min:0,max:100,step:1,unit:"%",description:"Signal smoothing amount"},{id:"peakHold",label:"Peak Hold",type:"toggle",defaultValue:!0,description:"Display peak markers"}],spectrum:[{id:"bands",label:"Frequency Bands",type:"select",defaultValue:"32",options:["16","32","64","128"],description:"Number of frequency bins"},{id:"gain",label:"Gain",type:"slider",defaultValue:60,min:0,max:100,step:1,unit:"%"},{id:"interpolation",label:"Interpolation",type:"toggle",defaultValue:!0,description:"Smooth band transitions"},{id:"lowCut",label:"Low Cut",type:"slider",defaultValue:20,min:0,max:200,step:10,unit:"Hz"},{id:"highCut",label:"High Cut",type:"slider",defaultValue:16e3,min:1e3,max:2e4,step:100,unit:"Hz"}],octave:[{id:"octaves",label:"Octave Count",type:"select",defaultValue:"8",options:["4","6","8","10"],description:"Number of octave bands"},{id:"response",label:"Response Speed",type:"slider",defaultValue:45,min:0,max:100,step:1,unit:"%"},{id:"normalize",label:"Auto-Normalize",type:"toggle",defaultValue:!1,description:"Balance band levels"}],metronome:[{id:"bpm",label:"BPM",type:"slider",defaultValue:120,min:60,max:200,step:1,unit:"BPM",description:"Beats per minute"},{id:"subdivision",label:"Subdivision",type:"select",defaultValue:"4",options:["2","4","8","16"],description:"Beat divisions"},{id:"accentFirst",label:"Accent First Beat",type:"toggle",defaultValue:!0},{id:"flash",label:"Flash Intensity",type:"slider",defaultValue:80,min:0,max:100,step:1,unit:"%"}],spectronome:[{id:"bpm",label:"BPM",type:"slider",defaultValue:128,min:60,max:200,step:1,unit:"BPM"},{id:"spectrumMix",label:"Spectrum Mix",type:"slider",defaultValue:50,min:0,max:100,step:1,unit:"%",description:"Balance between spectrum and beat"},{id:"beatTrigger",label:"Beat Trigger",type:"toggle",defaultValue:!0}],hype:[{id:"threshold",label:"Energy Threshold",type:"slider",defaultValue:65,min:0,max:100,step:1,unit:"%",description:"Activation threshold"},{id:"attack",label:"Attack",type:"slider",defaultValue:20,min:0,max:100,step:1,unit:"ms"},{id:"release",label:"Release",type:"slider",defaultValue:80,min:0,max:100,step:1,unit:"ms"},{id:"intensity",label:"Intensity",type:"slider",defaultValue:70,min:0,max:100,step:1,unit:"%"}],bloom:[{id:"speed",label:"Expansion Speed",type:"slider",defaultValue:55,min:0,max:100,step:1,unit:"%"},{id:"radius",label:"Max Radius",type:"slider",defaultValue:80,min:20,max:100,step:1,unit:"%"},{id:"layers",label:"Layers",type:"select",defaultValue:"3",options:["2","3","4","5"]},{id:"rotate",label:"Rotation",type:"toggle",defaultValue:!0}],pulse:[{id:"rate",label:"Pulse Rate",type:"slider",defaultValue:60,min:20,max:200,step:1,unit:"BPM"},{id:"width",label:"Pulse Width",type:"slider",defaultValue:40,min:10,max:90,step:1,unit:"%"},{id:"sync",label:"Audio Sync",type:"toggle",defaultValue:!1,description:"Sync to detected beat"}],sparkle:[{id:"density",label:"Particle Density",type:"slider",defaultValue:50,min:0,max:100,step:1,unit:"%"},{id:"lifetime",label:"Lifetime",type:"slider",defaultValue:35,min:10,max:100,step:1,unit:"%"},{id:"audioReactive",label:"Audio Reactive",type:"toggle",defaultValue:!0},{id:"twinkle",label:"Twinkle",type:"toggle",defaultValue:!0}]};function Jr({selectedEffect:s,disabled:t}){const[r,a]=c.useState("idle"),[n,o]=c.useState({}),{queue:i}=dt(80),u=Yr[s];c.useEffect(()=>{const d={};u.forEach(v=>{d[v.id]=v.defaultValue}),o(d)},[s]);const l=(d,v)=>{if(o(f=>({...f,[d]:v})),typeof v=="number"){const C=u.filter(h=>h.type==="slider").findIndex(h=>h.id===d);if(d==="speed"||d==="rate")i({speed:v});else if(C>=0){const j={0:"custom_param_1",1:"custom_param_2",2:"custom_param_3"}[C];j&&i({[j]:v})}}a("syncing"),setTimeout(()=>{a("synced"),setTimeout(()=>a("idle"),1e3)},300)},m=()=>{const d={};u.forEach(v=>{d[v.id]=v.defaultValue}),o(d),a("syncing"),setTimeout(()=>{a("synced"),setTimeout(()=>a("idle"),1e3)},300)};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-[12px] uppercase tracking-wide text-[var(--k1-text-dim)]",children:[s.charAt(0).toUpperCase()+s.slice(1)," Parameters"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[r==="syncing"&&e.jsxs(ve,{variant:"outline",className:"text-[10px] text-[var(--k1-warning)]",children:[e.jsx(ye,{className:"w-3 h-3 mr-1 animate-spin"}),"Syncing..."]}),r==="synced"&&e.jsxs(ve,{variant:"outline",className:"text-[10px] text-[var(--k1-success)]",children:[e.jsx(we,{className:"w-3 h-3 mr-1"}),"Synced"]}),e.jsxs(z,{variant:"ghost",size:"sm",onClick:m,disabled:t,className:"h-7",children:[e.jsx(Ct,{className:"w-3 h-3 mr-1"}),"Reset"]})]})]}),e.jsx(F,{className:"p-3 bg-[var(--k1-panel)] border-[var(--k1-border)]",children:e.jsx("div",{className:"space-y-4",children:u.map(d=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(V,{htmlFor:d.id,className:"text-[var(--k1-text)]",children:d.label}),d.type==="slider"&&e.jsxs("span",{className:"text-[10px] text-[var(--k1-text-dim)] font-[family-name:var(--k1-code-family)] px-1.5 py-0.5 bg-[var(--k1-bg)] rounded",children:[n[d.id]||d.defaultValue,d.unit||""]})]}),d.type==="slider"&&e.jsx(Z,{id:d.id,min:d.min,max:d.max,step:d.step,value:[Number(n[d.id]??d.defaultValue)],onValueChange:([v])=>l(d.id,v),disabled:t,className:"w-full"}),d.type==="toggle"&&e.jsxs("div",{className:"flex items-center justify-between pt-1",children:[e.jsx("span",{className:"text-[var(--k1-text-dim)]",children:d.description||d.label}),e.jsx(lt,{id:d.id,checked:!!(n[d.id]??d.defaultValue),onCheckedChange:v=>l(d.id,v),disabled:t})]}),d.type==="select"&&e.jsxs(ue,{value:String(n[d.id]??d.defaultValue),onValueChange:v=>l(d.id,v),disabled:t,children:[e.jsx(he,{id:d.id,children:e.jsx(me,{})}),e.jsx(ge,{children:d.options?.map(v=>e.jsx(U,{value:v,children:v},v))})]}),d.description&&d.type!=="toggle"&&e.jsx("p",{className:"text-[10px] text-[var(--k1-text-dim)]",children:d.description})]},d.id))})})]})}const Le=[{id:0,name:"Sunset Real",gradient:"linear-gradient(90deg, #7c2d12, #ea580c, #fbbf24, #fef3c7)"},{id:1,name:"Rivendell",gradient:"linear-gradient(90deg, #064e3b, #059669, #34d399, #a7f3d0)"},{id:2,name:"Ocean Breeze 036",gradient:"linear-gradient(90deg, #0c4a6e, #0284c7, #0ea5e9, #7dd3fc)"},{id:3,name:"RGI 15",gradient:"linear-gradient(90deg, #7f1d1d, #dc2626, #f59e0b, #84cc16)"},{id:4,name:"Retro 2",gradient:"linear-gradient(90deg, #581c87, #7c3aed, #a78bfa, #ddd6fe)"},{id:5,name:"Analogous 1",gradient:"linear-gradient(90deg, #be185d, #db2777, #f472b6, #fbcfe8)"},{id:6,name:"Pink Splash 08",gradient:"linear-gradient(90deg, #831843, #be185d, #ec4899, #f9a8d4)"},{id:7,name:"Coral Reef",gradient:"linear-gradient(90deg, #7c2d12, #ea580c, #fb7185, #fda4af)"},{id:8,name:"Ocean Breeze 068",gradient:"linear-gradient(90deg, #164e63, #0891b2, #06b6d4, #67e8f9)"},{id:9,name:"Pink Splash 07",gradient:"linear-gradient(90deg, #9d174d, #db2777, #f472b6, #fce7f3)"},{id:10,name:"Vintage 01",gradient:"linear-gradient(90deg, #92400e, #d97706, #f59e0b, #fde68a)"},{id:11,name:"Departure",gradient:"linear-gradient(90deg, #422006, #92400e, #84cc16, #ecfccb)"},{id:12,name:"Landscape 64",gradient:"linear-gradient(90deg, #365314, #65a30d, #84cc16, #d9f99d)"},{id:13,name:"Landscape 33",gradient:"linear-gradient(90deg, #14532d, #16a34a, #22c55e, #bbf7d0)"},{id:14,name:"Rainbow Sherbet",gradient:"linear-gradient(90deg, #ef4444, #f59e0b, #eab308, #22c55e, #06b6d4, #8b5cf6)"},{id:15,name:"GR65 Hult",gradient:"linear-gradient(90deg, #1e3a8a, #3b82f6, #06b6d4, #10b981)"},{id:16,name:"GR64 Hult",gradient:"linear-gradient(90deg, #1e40af, #2563eb, #0ea5e9, #06b6d4)"},{id:17,name:"GMT Dry Wet",gradient:"linear-gradient(90deg, #92400e, #d97706, #06b6d4, #0284c7)"},{id:18,name:"IB Jul01",gradient:"linear-gradient(90deg, #7c2d12, #dc2626, #f97316, #fbbf24)"},{id:19,name:"Vintage 57",gradient:"linear-gradient(90deg, #78350f, #a16207, #ca8a04, #facc15)"},{id:20,name:"IB15",gradient:"linear-gradient(90deg, #4c1d95, #7c3aed, #a855f7, #c084fc)"},{id:21,name:"Fuschia 7",gradient:"linear-gradient(90deg, #86198f, #c026d3, #d946ef, #f0abfc)"},{id:22,name:"Emerald Dragon",gradient:"linear-gradient(90deg, #064e3b, #047857, #10b981, #6ee7b7)"},{id:23,name:"Lava",gradient:"linear-gradient(90deg, #000000, #7f1d1d, #dc2626, #f97316, #fbbf24)"},{id:24,name:"Fire",gradient:"linear-gradient(90deg, #7f1d1d, #dc2626, #ea580c, #f97316, #ffffff)"},{id:25,name:"Colorful",gradient:"linear-gradient(90deg, #ef4444, #f59e0b, #84cc16, #06b6d4, #8b5cf6, #ec4899)"},{id:26,name:"Magenta Evening",gradient:"linear-gradient(90deg, #581c87, #9333ea, #c026d3, #f0abfc)"},{id:27,name:"Pink Purple",gradient:"linear-gradient(90deg, #be185d, #db2777, #a855f7, #c084fc)"},{id:28,name:"Autumn 19",gradient:"linear-gradient(90deg, #7c2d12, #dc2626, #f59e0b, #eab308)"},{id:29,name:"Blue Magenta White",gradient:"linear-gradient(90deg, #1e40af, #3b82f6, #c026d3, #ffffff)"},{id:30,name:"Black Magenta Red",gradient:"linear-gradient(90deg, #000000, #86198f, #be185d, #dc2626)"},{id:31,name:"Red Magenta Yellow",gradient:"linear-gradient(90deg, #dc2626, #be185d, #c026d3, #eab308)"},{id:32,name:"Blue Cyan Yellow",gradient:"linear-gradient(90deg, #1e40af, #0284c7, #06b6d4, #eab308)"}];function Qr({selectedPalette:s,onPaletteChange:t,disabled:r=!1}){const[a,n]=As.useState("warm"),o=d=>d.match(/#([0-9a-fA-F]{3,8})/g)||[],i=d=>{const v=d.replace("#",""),f=v.length===3?v.split("").map(b=>b+b).join(""):v.slice(0,6),C=parseInt(f,16),h=(C>>16&255)/255,j=(C>>8&255)/255,p=(C&255)/255,N=Math.max(h,j,p),x=Math.min(h,j,p);let k=0,E=0,D=(N+x)/2;if(N!==x){const b=N-x;switch(E=D>.5?b/(2-N-x):b/(N+x),N){case h:k=(j-p)/b+(j<p?6:0);break;case j:k=(p-h)/b+2;break;case p:k=(h-j)/b+4;break}k*=60}return{h:k,s:E*100,l:D*100}},u=d=>{const f=o(d).map(j=>i(j).h),C=f.some(j=>j<60||j>=320),h=f.some(j=>j>=60&&j<=240);return C&&h?"mixed":C?"warm":"cool"},m=Le.filter(d=>u(d.gradient)===a).slice(0,11);return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(V,{className:"text-[var(--k1-text-dim)]",children:"Color Palette"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex bg-[var(--k1-bg)] rounded-md p-1 border border-[var(--k1-border)]",children:[{key:"warm",label:"Warm"},{key:"cool",label:"Cool"},{key:"mixed",label:"Mixed"}].map(d=>e.jsx("button",{onClick:()=>n(d.key),className:`px-2 py-1 rounded text-[12px] ${a===d.key?"bg-[var(--k1-accent)] text-white":"text-[var(--k1-text-dim)] hover:text-[var(--k1-text)]"}`,children:d.label},d.key))}),e.jsxs("span",{className:"text-[10px] text-[var(--k1-text-dim)]",children:["Showing ",m.length," / 11"]})]})]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:m.map(d=>e.jsx(je,{children:e.jsxs(Ie,{children:[e.jsx(Pe,{asChild:!0,children:e.jsxs("button",{onClick:()=>!r&&t(d.id),disabled:r,className:`group relative h-8 rounded-md border transition-all duration-200 ${s===d.id?"border-[var(--k1-accent)] shadow-sm":"border-[var(--k1-border)] hover:border-[var(--k1-text-dim)]"} ${r?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,style:{background:d.gradient},"aria-label":`Select palette: ${d.name}`,children:[s===d.id&&e.jsx("div",{className:"absolute top-0 right-0 m-0.5 w-2 h-2 bg-[var(--k1-accent)] rounded-full shadow"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/50 text-white text-[10px] p-0.5 rounded-b-md opacity-0 group-hover:opacity-100 transition-opacity",children:d.name})]})}),e.jsx(Oe,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-[12px] font-medium",children:d.name}),e.jsxs("p",{className:"text-[10px] text-gray-400",children:["Palette #",d.id]})]})})]})},d.id))}),s!==void 0&&e.jsx("div",{className:"mt-3 p-2 bg-[var(--k1-bg)] rounded-md border border-[var(--k1-border)]",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded border border-[var(--k1-border)]",style:{background:Le.find(d=>d.id===s)?.gradient}}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[12px] font-medium text-[var(--k1-text)]",children:Le.find(d=>d.id===s)?.name}),e.jsx("p",{className:"text-[10px] text-[var(--k1-text-dim)]",children:"Active palette"})]})]})})]})}function Xr({hue:s,saturation:t,brightness:r,onChange:a,disabled:n=!1}){const i=((u,l,m)=>{l=l/100,m=m/100;const d=m*l,v=u/60,f=d*(1-Math.abs(v%2-1));let C=0,h=0,j=0;v>=0&&v<1?(C=d,h=f):v>=1&&v<2?(C=f,h=d):v>=2&&v<3?(h=d,j=f):v>=3&&v<4?(h=f,j=d):v>=4&&v<5?(C=f,j=d):(C=d,j=f);const p=m-d,N=x=>Math.round((x+p)*255).toString(16).padStart(2,"0");return`#${N(C)}${N(h)}${N(j)}`})(s,t,r);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(V,{className:"text-[var(--k1-text)]",children:"Hue"}),e.jsxs("span",{className:"text-[var(--k1-text-dim)] font-mono text-sm px-2 py-1 bg-[var(--k1-bg)] rounded",children:[s,"Â°"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Z,{min:0,max:360,step:1,value:[s],onValueChange:([u])=>a({hue:u}),disabled:n,className:"w-full"}),e.jsx("div",{className:"absolute inset-0 -z-10 h-2 rounded-full opacity-30",style:{background:"linear-gradient(to right, #ff0000, #ffff00, #00ff00, #00ffff, #0000ff, #ff00ff, #ff0000)"}})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(V,{className:"text-[var(--k1-text)]",children:"Saturation"}),e.jsxs("span",{className:"text-[var(--k1-text-dim)] font-mono text-sm px-2 py-1 bg-[var(--k1-bg)] rounded",children:[t,"%"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Z,{min:0,max:100,step:1,value:[t],onValueChange:([u])=>a({saturation:u}),disabled:n,className:"w-full"}),e.jsx("div",{className:"absolute inset-0 -z-10 h-2 rounded-full opacity-30",style:{background:`linear-gradient(to right, hsl(${s}, 0%, 50%), hsl(${s}, 100%, 50%))`}})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(V,{className:"text-[var(--k1-text)]",children:"Brightness"}),e.jsxs("span",{className:"text-[var(--k1-text-dim)] font-mono text-sm px-2 py-1 bg-[var(--k1-bg)] rounded",children:[r,"%"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Z,{min:0,max:100,step:1,value:[r],onValueChange:([u])=>a({brightness:u}),disabled:n,className:"w-full"}),e.jsx("div",{className:"absolute inset-0 -z-10 h-2 rounded-full opacity-30",style:{background:`linear-gradient(to right, hsl(${s}, ${t}%, 0%), hsl(${s}, ${t}%, 100%))`}})]})]}),e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-[var(--k1-bg)] rounded-lg border border-[var(--k1-border)]",children:[e.jsx("div",{className:"w-16 h-16 rounded-lg border-2 border-[var(--k1-border)] shadow-inner",style:{backgroundColor:i}}),e.jsxs("div",{className:"flex-1",children:[e.jsx(V,{className:"text-[var(--k1-text-dim)] text-sm",children:"Current Color"}),e.jsx(Ne,{value:i.toUpperCase(),readOnly:!0,className:"font-mono h-8 mt-1 text-sm"}),e.jsxs("div",{className:"text-xs text-[var(--k1-text-dim)] mt-1",children:["HSV(",s,", ",t,"%, ",r,"%)"]})]})]})]})}const Ge=[{key:"static",label:"Static",icon:"â¸ï¸",description:"Fixed colors"},{key:"flow",label:"Flow",icon:"ðŸŒŠ",description:"Smooth color transitions"},{key:"pulse",label:"Pulse",icon:"ðŸ’“",description:"Rhythmic color changes"},{key:"rainbow",label:"Rainbow",icon:"ðŸŒˆ",description:"Cycle through hues"}];function Zr({mode:s,speed:t,intensity:r,onModeChange:a,onSpeedChange:n,onIntensityChange:o,disabled:i=!1}){const u=Ge.find(l=>l.key===s)||Ge[0];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(V,{className:"text-[var(--k1-text-dim)]",children:"Motion Style"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Ge.map(l=>e.jsxs("button",{onClick:()=>!i&&a(l.key),disabled:i,className:`p-3 rounded-lg border-2 transition-all duration-200 text-left ${s===l.key?"border-[var(--k1-accent)] bg-[var(--k1-accent)]/10":"border-[var(--k1-border)] hover:border-[var(--k1-text-dim)] bg-[var(--k1-bg)]"} ${i?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-lg",children:l.icon}),e.jsx("span",{className:"font-medium text-[var(--k1-text)]",children:l.label})]}),e.jsx("p",{className:"text-xs text-[var(--k1-text-dim)]",children:l.description})]},l.key))})]}),s!=="static"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(V,{className:"text-[var(--k1-text)]",children:"Speed"}),e.jsxs("span",{className:"text-[var(--k1-text-dim)] font-mono text-sm px-2 py-1 bg-[var(--k1-bg)] rounded",children:[t,"%"]})]}),e.jsx(Z,{min:0,max:100,step:1,value:[t],onValueChange:([l])=>n(l),disabled:i,className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-[var(--k1-text-dim)]",children:[e.jsx("span",{children:"Slow"}),e.jsx("span",{children:"Fast"})]})]}),(s==="pulse"||s==="flow")&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(V,{className:"text-[var(--k1-text)]",children:s==="pulse"?"Pulse Strength":"Flow Intensity"}),e.jsxs("span",{className:"text-[var(--k1-text-dim)] font-mono text-sm px-2 py-1 bg-[var(--k1-bg)] rounded",children:[r,"%"]})]}),e.jsx(Z,{min:0,max:100,step:1,value:[r],onValueChange:([l])=>o(l),disabled:i,className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-[var(--k1-text-dim)]",children:[e.jsx("span",{children:"Subtle"}),e.jsx("span",{children:"Intense"})]})]}),e.jsxs("div",{className:"p-3 bg-[var(--k1-bg)] rounded-lg border border-[var(--k1-border)]",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-lg",children:u.icon}),e.jsxs("span",{className:"font-medium text-[var(--k1-text)]",children:[u.label," Mode"]})]}),e.jsx("p",{className:"text-sm text-[var(--k1-text-dim)]",children:ea(u.key)})]})]})}function ea(s){switch(s){case"static":return"Colors remain fixed without any motion. Perfect for consistent lighting or when you want stable colors.";case"flow":return"Colors transition smoothly over time, creating flowing gradients. Great for ambient lighting and relaxing environments.";case"pulse":return"Colors pulse rhythmically, creating breathing effects. Excellent for music visualization and dynamic scenes.";case"rainbow":return"Cycles through the full spectrum of hues automatically. Classic rainbow effect that works well with any pattern.";default:return"Color motion effect for dynamic lighting."}}function ta({disabled:s}){const[t,r]=c.useState("palette"),[a,n]=c.useState(Le[0]?.id??0),[o,i]=c.useState(180),[u,l]=c.useState(70),[m,d]=c.useState(90),[v,f]=c.useState("static"),[C,h]=c.useState(50),[j,p]=c.useState(30),N=dt(),x=le(),k=c.useCallback(S=>{s||(n(S),x.setPalette(S).catch(console.error))},[s,x]),E=c.useCallback(S=>{if(s)return;const I={};S.hue!==void 0&&(i(S.hue),I.color=Math.round(S.hue/360*100)),S.saturation!==void 0&&(l(S.saturation),I.saturation=S.saturation),S.brightness!==void 0&&(d(S.brightness),I.brightness=S.brightness),Object.keys(I).length>0&&N.queue(I)},[s,N]),D=c.useCallback(S=>{if(s)return;f(S);const I={static:0,flow:1,pulse:2,rainbow:3};N.queue({custom_param_1:I[S]})},[s,N]),b=c.useCallback(S=>{s||(h(S),N.queue({speed:S}))},[s,N]),w=c.useCallback(S=>{s||(p(S),N.queue({color_range:S}))},[s,N]);return e.jsxs(F,{className:"h-full",children:[e.jsx(Pt,{children:e.jsx(Ot,{children:"Color & Global Settings"})}),e.jsxs(Lt,{className:"space-y-6",children:[e.jsx("div",{className:"flex space-x-1 bg-k1-surface rounded-lg p-1",children:[{key:"palette",label:"Palettes"},{key:"motion",label:"Motion"},{key:"manual",label:"Manual"}].map(S=>e.jsx("button",{onClick:()=>r(S.key),className:`px-3 py-2 rounded-md text-sm font-medium transition-all ${t===S.key?"bg-k1-accent text-white":"text-k1-text-secondary hover:text-k1-text-primary hover:bg-k1-surface-hover"}`,children:S.label},S.key))}),e.jsxs("div",{className:"space-y-4",children:[t==="palette"&&e.jsx(Qr,{selectedPalette:a,onPaletteChange:k,disabled:s}),t==="motion"&&e.jsx(Zr,{mode:v,speed:C,intensity:j,onModeChange:D,onSpeedChange:b,onIntensityChange:w,disabled:s}),t==="manual"&&e.jsx(Xr,{hue:o,saturation:u,brightness:m,onChange:E,disabled:s})]})]})]})}function sa({disabled:s}){const r=xe().parameters,[a,n]=c.useState(r.brightness),[o,i]=c.useState(r.softness),[u,l]=c.useState(r.warmth),[m,d]=c.useState(r.background),[v,f]=c.useState((r.dithering??100)>=50),{queue:C}=dt();return c.useEffect(()=>{n(r.brightness),i(r.softness),l(r.warmth),d(r.background),f((r.dithering??100)>=50)},[r.brightness,r.softness,r.warmth,r.background,r.dithering]),c.useEffect(()=>{},[a]),e.jsxs(F,{className:"p-4 bg-[var(--k1-panel)] border-[var(--k1-border)]",children:[e.jsx("h3",{className:"text-[12px] uppercase tracking-wide text-[var(--k1-text-dim)] mb-4",children:"Global Settings"}),e.jsxs("div",{className:"space-y-2 opacity-70",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(V,{className:"text-[var(--k1-text)]",children:"Brightness (moved to Color Management)"}),e.jsxs("span",{className:"text-[var(--k1-text-dim)] font-[family-name:var(--k1-code-family)] text-[10px] px-2 py-0.5 bg-[var(--k1-bg)] rounded",children:[a,"%"]})]}),e.jsx(Z,{min:0,max:100,step:1,value:[a],onValueChange:([h])=>n(h),disabled:s,className:"w-full"}),e.jsx("p",{className:"text-[var(--k1-text-dim)] text-[11px]",children:"Use Color Management â†’ Brightness."})]}),e.jsxs("div",{className:"space-y-2 mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(V,{className:"text-[var(--k1-text)]",children:"Softness"}),e.jsxs("span",{className:"text-[var(--k1-text-dim)] font-[family-name:var(--k1-code-family)] text-[10px] px-2 py-0.5 bg-[var(--k1-bg)] rounded",children:[o,"%"]})]}),e.jsx(Z,{min:0,max:100,step:1,value:[o],onValueChange:([h])=>{i(h),s||C({softness:h})},disabled:s,className:"w-full"})]}),e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(V,{className:"text-[var(--k1-text)]",children:"Warmth"}),e.jsxs("span",{className:"text-[var(--k1-text-dim)] font-[family-name:var(--k1-code-family)] text-[10px] px-2 py-0.5 bg-[var(--k1-bg)] rounded",children:[u,"%"]})]}),e.jsx(Z,{min:0,max:100,step:1,value:[u],onValueChange:([h])=>{l(h),s||C({warmth:h})},disabled:s,className:"w-full"})]}),e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(V,{className:"text-[var(--k1-text)]",children:"Background"}),e.jsxs("span",{className:"text-[var(--k1-text-dim)] font-[family-name:var(--k1-code-family)] text-[10px] px-2 py-0.5 bg-[var(--k1-bg)] rounded",children:[m,"%"]})]}),e.jsx(Z,{min:0,max:100,step:1,value:[m],onValueChange:([h])=>{d(h),s||C({background:h})},disabled:s,className:"w-full"})]}),e.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"text-[var(--k1-text)]",children:"Dithering"}),e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded font-[family-name:var(--k1-code-family)] ${v?"bg-[var(--k1-accent)]/20 text-[var(--k1-accent)]":"bg-[var(--k1-bg)] text-[var(--k1-text-dim)] border border-[var(--k1-border)]"}`,children:v?"On":"Off"})]}),e.jsx(lt,{checked:v,onCheckedChange:h=>{f(h),s||C({dithering:h?100:0})},disabled:s,"aria-label":"Toggle Dithering"})]})]})}function xt({className:s,value:t,...r}){return e.jsx(Is,{"data-slot":"progress",className:O("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",s),...r,children:e.jsx(Ps,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})})}function ra({isConnected:s}){const t=s?58:0,r=s?245:0,a=s?42:0,n=s?12847:0,o=s?65:0,i=m=>m>=55?"var(--k1-success)":m>=40?"var(--k1-warning)":"var(--k1-error)",u=m=>m<300?"var(--k1-success)":m<500?"var(--k1-warning)":"var(--k1-error)",l=m=>m<70?"var(--k1-success)":m<85?"var(--k1-warning)":"var(--k1-error)";return s?e.jsxs("div",{className:"h-16 bg-[var(--k1-bg-elev)] border-t border-[var(--k1-border)] px-6 flex items-center gap-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ce,{className:"w-4 h-4",style:{color:i(t)}}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-[var(--k1-text-dim)]",children:"FPS"}),e.jsx("span",{className:"font-[family-name:var(--k1-code-family)]",style:{color:i(t)},children:t})]}),e.jsx("div",{className:"text-[8px] text-[var(--k1-text-dim)]",children:"Target: 60"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-1 max-w-xs",children:[e.jsx(Tt,{className:"w-4 h-4",style:{color:u(r)}}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-[var(--k1-text-dim)]",children:"CPU"}),e.jsxs("span",{className:"font-[family-name:var(--k1-code-family)] text-[10px]",style:{color:u(r)},children:[r,"Î¼s"]})]}),e.jsxs("span",{className:"text-[var(--k1-text-dim)] text-[10px]",children:[a,"%"]})]}),e.jsx(xt,{value:a,className:"h-1.5"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-1 max-w-xs",children:[e.jsx(Os,{className:"w-4 h-4",style:{color:l(o)}}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-[var(--k1-text-dim)]",children:"Memory"}),e.jsxs("span",{className:"font-[family-name:var(--k1-code-family)] text-[10px]",style:{color:l(o)},children:[n,"KB free"]})]}),e.jsxs("span",{className:"text-[var(--k1-text-dim)] text-[10px]",children:[o,"%"]})]}),e.jsx(xt,{value:o,className:"h-1.5"}),o>85&&e.jsx("p",{className:"text-[8px] text-[var(--k1-error)]",children:"âš ï¸ Low memory warning"})]})]})]}):e.jsx("div",{className:"h-16 bg-[var(--k1-bg-elev)] border-t border-[var(--k1-border)] flex items-center justify-center",children:e.jsx("p",{className:"text-[var(--k1-text-dim)]",children:"Connect to device to view live performance metrics"})})}function aa(){const[s,t]=c.useState("analog"),r=le(),n=xe().connection==="connected",o={analog:5,spectrum:3,octave:4,metronome:7,spectronome:8,hype:1,bloom:5,pulse:6,sparkle:10},i=u=>{t(u);const l=o[u];n&&typeof l=="number"&&r.selectPattern(String(l))};return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"p-6 grid grid-cols-3 gap-6",children:[e.jsx("div",{children:e.jsx(qr,{selectedEffect:s,onEffectChange:i,disabled:!n})}),e.jsx("div",{children:e.jsx(Jr,{selectedEffect:s,disabled:!n})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(sa,{disabled:!n}),e.jsx(ta,{disabled:!n})]})]})}),e.jsx(ra,{isConnected:n})]})}const na=s=>Array.from({length:s},(t,r)=>({frame:r,fps:55+Math.random()*10+Math.sin(r*.1)*3})),ia=s=>Array.from({length:s},(t,r)=>({frame:r,effect:180+Math.random()*50,gpu:60+Math.random()*30,driver:40+Math.random()*20,other:20+Math.random()*15})),oa=()=>["Analog","Spectrum","Octave","Metronome","Spectronome","Hype","Bloom","PULSE","SPARKLE"].map(t=>({effect:t,cpu:150+Math.random()*200})).sort((t,r)=>r.cpu-t.cpu),ca=s=>Array.from({length:s},(t,r)=>({frame:r,memory:50+Math.random()*20+Math.sin(r*.05)*5}));function la({isConnected:s,timeRange:t,showComparison:r,selectedEffect:a}){const n=parseInt(t),o=na(n),i=ia(n),u=oa(),l=ca(n);return s?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(F,{className:"p-6 bg-[var(--k1-panel)] border-[var(--k1-border)]",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-[var(--k1-text)]",children:"FPS Over Time"}),e.jsx("p",{className:"text-[10px] text-[var(--k1-text-dim)] mt-1",children:"Target: 60 FPS â€¢ Acceptable: 40+ FPS"})]}),e.jsx(ce,{width:"100%",height:200,children:e.jsxs(Ue,{data:o,children:[e.jsx(re,{strokeDasharray:"3 3",stroke:"var(--k1-border)"}),e.jsx(ae,{dataKey:"frame",stroke:"var(--k1-text-dim)",tick:{fontSize:10,fill:"var(--k1-text-dim)"}}),e.jsx(ne,{domain:[0,70],stroke:"var(--k1-text-dim)",tick:{fontSize:10,fill:"var(--k1-text-dim)"}}),e.jsx(ie,{contentStyle:{backgroundColor:"var(--k1-bg-elev)",border:"1px solid var(--k1-border)",borderRadius:"6px",fontSize:"12px"}}),e.jsx(Se,{y:60,stroke:"var(--k1-success)",strokeDasharray:"5 5",label:{value:"Target",fontSize:10,fill:"var(--k1-success)"}}),e.jsx(Se,{y:40,stroke:"var(--k1-warning)",strokeDasharray:"5 5",label:{value:"Minimum",fontSize:10,fill:"var(--k1-warning)"}}),e.jsx(fe,{type:"monotone",dataKey:"fps",stroke:"var(--k1-accent)",strokeWidth:2,dot:!1})]})})]}),e.jsxs(F,{className:"p-6 bg-[var(--k1-panel)] border-[var(--k1-border)]",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-[var(--k1-text)]",children:"Frame Time Breakdown"}),e.jsx("p",{className:"text-[10px] text-[var(--k1-text-dim)] mt-1",children:"Total processing time per component (microseconds)"})]}),e.jsx(ce,{width:"100%",height:220,children:e.jsxs(st,{data:i,children:[e.jsx(re,{strokeDasharray:"3 3",stroke:"var(--k1-border)"}),e.jsx(ae,{dataKey:"frame",stroke:"var(--k1-text-dim)",tick:{fontSize:10,fill:"var(--k1-text-dim)"}}),e.jsx(ne,{stroke:"var(--k1-text-dim)",tick:{fontSize:10,fill:"var(--k1-text-dim)"}}),e.jsx(ie,{contentStyle:{backgroundColor:"var(--k1-bg-elev)",border:"1px solid var(--k1-border)",borderRadius:"6px",fontSize:"12px"}}),e.jsx(It,{wrapperStyle:{fontSize:"12px"}}),e.jsx(de,{type:"monotone",dataKey:"effect",stackId:"1",stroke:"var(--k1-accent)",fill:"var(--k1-accent)",fillOpacity:.6}),e.jsx(de,{type:"monotone",dataKey:"gpu",stackId:"1",stroke:"var(--k1-accent-2)",fill:"var(--k1-accent-2)",fillOpacity:.6}),e.jsx(de,{type:"monotone",dataKey:"driver",stackId:"1",stroke:"var(--port-scalar)",fill:"var(--port-scalar)",fillOpacity:.6}),e.jsx(de,{type:"monotone",dataKey:"other",stackId:"1",stroke:"var(--port-output)",fill:"var(--port-output)",fillOpacity:.6})]})})]}),e.jsxs(F,{className:"p-6 bg-[var(--k1-panel)] border-[var(--k1-border)]",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-[var(--k1-text)]",children:"CPU Usage by Effect"}),e.jsx("p",{className:"text-[10px] text-[var(--k1-text-dim)] mt-1",children:"Average processing time per effect (sorted by load)"})]}),e.jsx(ce,{width:"100%",height:240,children:e.jsxs(it,{data:u,layout:"vertical",children:[e.jsx(re,{strokeDasharray:"3 3",stroke:"var(--k1-border)"}),e.jsx(ae,{type:"number",stroke:"var(--k1-text-dim)",tick:{fontSize:10,fill:"var(--k1-text-dim)"}}),e.jsx(ne,{type:"category",dataKey:"effect",stroke:"var(--k1-text-dim)",tick:{fontSize:10,fill:"var(--k1-text-dim)"},width:80}),e.jsx(ie,{contentStyle:{backgroundColor:"var(--k1-bg-elev)",border:"1px solid var(--k1-border)",borderRadius:"6px",fontSize:"12px"},formatter:m=>[`${m.toFixed(0)}Î¼s`,"CPU Time"]}),e.jsx($e,{dataKey:"cpu",fill:"var(--k1-accent)",radius:[0,4,4,0]})]})})]}),e.jsxs(F,{className:"p-6 bg-[var(--k1-panel)] border-[var(--k1-border)]",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-[var(--k1-text)]",children:"Memory Usage"}),e.jsx("p",{className:"text-[10px] text-[var(--k1-text-dim)] mt-1",children:"Heap memory consumption (%) with safety thresholds"})]}),e.jsx(ce,{width:"100%",height:200,children:e.jsxs(st,{data:l,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"memGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"var(--k1-accent)",stopOpacity:.8}),e.jsx("stop",{offset:"100%",stopColor:"var(--k1-accent)",stopOpacity:.1})]})}),e.jsx(re,{strokeDasharray:"3 3",stroke:"var(--k1-border)"}),e.jsx(ae,{dataKey:"frame",stroke:"var(--k1-text-dim)",tick:{fontSize:10,fill:"var(--k1-text-dim)"}}),e.jsx(ne,{domain:[0,100],stroke:"var(--k1-text-dim)",tick:{fontSize:10,fill:"var(--k1-text-dim)"}}),e.jsx(ie,{contentStyle:{backgroundColor:"var(--k1-bg-elev)",border:"1px solid var(--k1-border)",borderRadius:"6px",fontSize:"12px"}}),e.jsx(Se,{y:70,stroke:"var(--k1-warning)",strokeDasharray:"5 5",label:{value:"Warning",fontSize:10,fill:"var(--k1-warning)"}}),e.jsx(Se,{y:85,stroke:"var(--k1-error)",strokeDasharray:"5 5",label:{value:"Critical",fontSize:10,fill:"var(--k1-error)"}}),e.jsx(de,{type:"monotone",dataKey:"memory",stroke:"var(--k1-accent)",fill:"url(#memGradient)"})]})})]})]}):e.jsx("div",{className:"space-y-6",children:[1,2,3,4].map(m=>e.jsx(F,{className:"p-6 bg-[var(--k1-panel)] border-[var(--k1-border)] h-64 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ke,{className:"w-8 h-8 text-[var(--k1-text-dim)] mx-auto mb-2"}),e.jsx("p",{className:"text-[var(--k1-text-dim)]",children:"Connect to device to view profiling data"})]})},m))})}function da({className:s,...t}){return e.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:e.jsx("table",{"data-slot":"table",className:O("w-full caption-bottom text-sm",s),...t})})}function ua({className:s,...t}){return e.jsx("thead",{"data-slot":"table-header",className:O("[&_tr]:border-b",s),...t})}function ma({className:s,...t}){return e.jsx("tbody",{"data-slot":"table-body",className:O("[&_tr:last-child]:border-0",s),...t})}function pt({className:s,...t}){return e.jsx("tr",{"data-slot":"table-row",className:O("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",s),...t})}function Ye({className:s,...t}){return e.jsx("th",{"data-slot":"table-head",className:O("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...t})}function Je({className:s,...t}){return e.jsx("td",{"data-slot":"table-cell",className:O("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...t})}function at({className:s,children:t,...r}){return e.jsxs(Ls,{"data-slot":"scroll-area",className:O("relative",s),...r,children:[e.jsx(Fs,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:t}),e.jsx(ha,{}),e.jsx($s,{})]})}function ha({className:s,orientation:t="vertical",...r}){return e.jsx(zs,{"data-slot":"scroll-area-scrollbar",orientation:t,className:O("flex touch-none p-px transition-colors select-none",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent",s),...r,children:e.jsx(Us,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}const ga=[{id:"fps-avg",label:"Avg FPS",value:"58.4",trend:"stable",status:"good",unit:""},{id:"fps-min",label:"Min FPS",value:"52.1",trend:"down",status:"warning",unit:""},{id:"fps-max",label:"Max FPS",value:"60.0",trend:"up",status:"good",unit:""},{id:"frame-avg",label:"Avg Frame Time",value:"245",trend:"stable",status:"good",unit:"Î¼s"},{id:"frame-max",label:"Max Frame Time",value:"412",trend:"up",status:"warning",unit:"Î¼s"},{id:"cpu-avg",label:"Avg CPU",value:"42",trend:"stable",status:"good",unit:"%"},{id:"cpu-peak",label:"Peak CPU",value:"68",trend:"up",status:"warning",unit:"%"},{id:"mem-used",label:"Memory Used",value:"14.2",trend:"up",status:"good",unit:"KB"},{id:"mem-peak",label:"Peak Memory",value:"18.7",trend:"stable",status:"warning",unit:"KB"},{id:"dropped",label:"Dropped Frames",value:"3",trend:"stable",status:"good",unit:""},{id:"latency",label:"Audio Latency",value:"12.3",trend:"down",status:"good",unit:"ms"},{id:"buffer",label:"Buffer Health",value:"94",trend:"stable",status:"good",unit:"%"}];function xa({isConnected:s,selectedEffect:t}){const[r,a]=c.useState(null),[n,o]=c.useState(null),i=l=>{switch(l){case"good":return"var(--k1-success)";case"warning":return"var(--k1-warning)";case"error":return"var(--k1-error)"}},u=l=>{switch(l){case"up":return e.jsx(Nt,{className:"w-3 h-3"});case"down":return e.jsx(Vs,{className:"w-3 h-3"});case"stable":return e.jsx(Hs,{className:"w-3 h-3"})}};return s?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-[var(--k1-text)]",children:"Live Statistics"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-[var(--k1-success)] animate-pulse"}),e.jsx("p",{className:"text-[10px] text-[var(--k1-text-dim)]",children:"Updating ~2Hz"})]})]})}),e.jsxs(F,{className:"bg-[var(--k1-panel)] border-[var(--k1-border)]",children:[e.jsx(at,{className:"h-[800px]",children:e.jsxs(da,{children:[e.jsx(ua,{children:e.jsxs(pt,{className:"hover:bg-transparent border-[var(--k1-border)]",children:[e.jsx(Ye,{className:"text-[var(--k1-text-dim)] text-[10px] uppercase tracking-wide",children:"Metric"}),e.jsx(Ye,{className:"text-[var(--k1-text-dim)] text-[10px] uppercase tracking-wide text-right",children:e.jsxs("button",{onClick:()=>a(r==="value"?null:"value"),className:"flex items-center gap-1 ml-auto hover:text-[var(--k1-text)]",children:["Value",e.jsx(Bs,{className:"w-3 h-3"})]})}),e.jsx(Ye,{className:"text-[var(--k1-text-dim)] text-[10px] uppercase tracking-wide text-right",children:"Trend"})]})}),e.jsx(ma,{children:ga.map(l=>e.jsxs(pt,{onMouseEnter:()=>o(l.id),onMouseLeave:()=>o(null),className:`border-[var(--k1-border)] transition-colors cursor-pointer ${n===l.id?"bg-[var(--k1-bg-elev)]":""}`,children:[e.jsx(Je,{className:"text-[var(--k1-text)]",children:l.label}),e.jsx(Je,{className:"text-right",children:e.jsxs("span",{className:"font-[family-name:var(--k1-code-family)]",style:{color:i(l.status)},children:[l.value,l.unit&&e.jsx("span",{className:"text-[var(--k1-text-dim)] ml-1",children:l.unit})]})}),e.jsx(Je,{className:"text-right",children:e.jsx("div",{className:"flex items-center justify-end",style:{color:i(l.status)},children:u(l.trend)})})]},l.id))})]})}),e.jsx("div",{className:"p-3 border-t border-[var(--k1-border)] bg-[var(--k1-bg)]",children:e.jsx("p",{className:"text-[8px] text-[var(--k1-text-dim)] text-center",children:"Click any metric to drill down â€¢ Hover to highlight"})})]})]}):e.jsx(F,{className:"p-6 bg-[var(--k1-panel)] border-[var(--k1-border)] h-full flex items-center justify-center",children:e.jsx("p",{className:"text-[var(--k1-text-dim)]",children:"No statistics available"})})}function pa({selectedEffect:s,onEffectChange:t,timeRange:r,onTimeRangeChange:a,showComparison:n,onComparisonToggle:o,disabled:i}){const u=()=>{X.success("Profiling data exported",{description:"CSV file downloaded to your device"})};return e.jsxs("div",{className:"p-4 flex items-center gap-4 bg-[var(--k1-bg-elev)]",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"text-[var(--k1-text-dim)] text-[10px] uppercase tracking-wide whitespace-nowrap",children:"Effect"}),e.jsxs(ue,{value:s,onValueChange:t,disabled:i,children:[e.jsx(he,{className:"w-40",children:e.jsx(me,{})}),e.jsxs(ge,{children:[e.jsx(U,{value:"all",children:"All Effects"}),e.jsx(U,{value:"analog",children:"Analog"}),e.jsx(U,{value:"spectrum",children:"Spectrum"}),e.jsx(U,{value:"octave",children:"Octave"}),e.jsx(U,{value:"metronome",children:"Metronome"}),e.jsx(U,{value:"spectronome",children:"Spectronome"}),e.jsx(U,{value:"hype",children:"Hype"}),e.jsx(U,{value:"bloom",children:"Bloom"}),e.jsx(U,{value:"pulse",children:"PULSE"}),e.jsx(U,{value:"sparkle",children:"SPARKLE"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"text-[var(--k1-text-dim)] text-[10px] uppercase tracking-wide whitespace-nowrap",children:"Range"}),e.jsx("div",{className:"flex gap-1 bg-[var(--k1-panel)] p-1 rounded-lg",children:["100","500","1000"].map(l=>e.jsxs("button",{onClick:()=>!i&&a(l),disabled:i,className:`px-3 py-1.5 rounded text-[10px] transition-colors ${r===l?"bg-[var(--k1-accent)] text-[var(--k1-bg)]":"text-[var(--k1-text-dim)] hover:text-[var(--k1-text)]"} ${i?"opacity-50 cursor-not-allowed":""}`,children:["Last ",l]},l))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(lt,{id:"comparison",checked:n,onCheckedChange:o,disabled:i}),e.jsx(V,{htmlFor:"comparison",className:"text-[var(--k1-text-dim)] cursor-pointer",children:"Phase Comparison"})]}),e.jsxs(z,{variant:"outline",size:"sm",onClick:u,disabled:i,className:"ml-auto",children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),"Export CSV"]}),!i&&e.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-[var(--k1-text-dim)]",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-[var(--k1-success)] animate-pulse"}),"Updating ~10Hz"]})]})}function fa({isConnected:s,k1Client:t}){const[r,a]=c.useState("all"),[n,o]=c.useState("100"),[i,u]=c.useState(!1);return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"border-b border-[var(--k1-border)]",children:e.jsx(pa,{selectedEffect:r,onEffectChange:a,timeRange:n,onTimeRangeChange:o,showComparison:i,onComparisonToggle:u,disabled:!s})}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"p-6 grid grid-cols-[1fr_400px] gap-6",children:[e.jsx(la,{isConnected:s,timeRange:n,showComparison:i,selectedEffect:r}),e.jsx(xa,{isConnected:s,selectedEffect:r})]})})]})}const va=[{id:"1",timestamp:new Date(Date.now()-12e4),type:"info",text:"Emotiscope 2.0 Terminal initialized"},{id:"2",timestamp:new Date(Date.now()-118e3),type:"info",text:'Type "help" for available commands'}],ba={help:{type:"info",text:`Available commands:
  p - Print current effect parameters
  k - Kill current effect
  v - Print firmware version
  j - Print device info (JSON)
  r - Reboot device
  c - Clear terminal
  s - System status`},p:{type:"success",text:`Current Effect: Analog
  sensitivity: 75%
  decay: 50%
  smoothing: 30%
  peakHold: true`},k:{type:"success",text:"Effect stopped"},v:{type:"info",text:"Emotiscope v2.0.3-beta (build 20251023)"},j:{type:"info",text:`{
  "device": "Emotiscope 2.0",
  "firmware": "2.0.3-beta",
  "uptime": 754,
  "ip": "192.168.1.100",
  "mac": "AA:BB:CC:DD:EE:FF"
}`},r:{type:"success",text:"Rebooting device..."},c:{type:"success",text:"Terminal cleared"},s:{type:"success",text:`System Status:
  CPU: 42% (245Î¼s avg)
  Memory: 65% (12.8KB free)
  FPS: 58
  Temperature: 42Â°C`}};function ya({isConnected:s,k1Client:t}){const[r,a]=c.useState(va),[n,o]=c.useState(""),[i,u]=c.useState([]),[l,m]=c.useState(!1),[d,v]=c.useState(!0),f=c.useRef(null),C=c.useRef(null);c.useEffect(()=>{d&&f.current&&(f.current.scrollTop=f.current.scrollHeight)},[r,d]);const h=(k,E)=>{const D={id:Date.now().toString(),timestamp:new Date,type:k,text:E};a(b=>[...b,D])},j=k=>{if(!k.trim())return;h("command",k),u(D=>[{command:k,timestamp:new Date},...D.slice(0,9)]);const E=ba[k.toLowerCase()];k.toLowerCase()==="c"?a([]):setTimeout(E?()=>{h(E.type,E.text)}:()=>{h("error",`Unknown command: "${k}". Type "help" for available commands.`)},100),o("")},p=()=>{a([]),X.success("Terminal cleared")},N=()=>{const k=r.map(E=>`[${E.timestamp.toLocaleTimeString()}] ${E.text}`).join(`
`);navigator.clipboard.writeText(k),X.success("Terminal output copied to clipboard")},x=k=>{switch(k){case"command":return"var(--k1-accent)";case"error":return"var(--k1-error)";case"success":return"var(--k1-success)";case"info":return"var(--k1-text)";case"output":return"var(--k1-text-dim)"}};return s?e.jsxs("div",{className:"h-full flex flex-col p-6 gap-4",children:[e.jsxs(F,{className:"flex-1 bg-[var(--k1-bg)] border-[var(--k1-border)] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-[var(--k1-border)] bg-[var(--k1-bg-elev)]",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[var(--k1-text-dim)] text-[10px] uppercase tracking-wide",children:"Terminal Output"}),e.jsxs("div",{className:"flex items-center gap-1 text-[8px] text-[var(--k1-text-dim)]",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-[var(--k1-success)] animate-pulse"}),"Live"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(z,{variant:"ghost",size:"sm",onClick:N,className:"h-7",children:[e.jsx(Ze,{className:"w-3 h-3 mr-1"}),"Copy"]}),e.jsxs(z,{variant:"ghost",size:"sm",onClick:p,className:"h-7",children:[e.jsx(St,{className:"w-3 h-3 mr-1"}),"Clear"]})]})]}),e.jsx(at,{className:"flex-1 p-4",ref:f,children:e.jsx("div",{className:"space-y-1 font-[family-name:var(--k1-code-family)] text-[12px]",children:r.length===0?e.jsx("div",{className:"text-[var(--k1-text-dim)] italic",children:"Terminal cleared. Type a command below..."}):r.map(k=>e.jsxs("div",{className:"flex gap-3 leading-relaxed",children:[e.jsx("span",{className:"text-[var(--k1-text-dim)] text-[10px] opacity-60 select-none min-w-[80px]",children:k.timestamp.toLocaleTimeString()}),e.jsxs("pre",{className:"flex-1 whitespace-pre-wrap",style:{color:x(k.type)},children:[k.type==="command"&&"> ",k.text]})]},k.id))})}),!d&&e.jsx("div",{className:"px-4 py-2 bg-[var(--k1-bg-elev)] border-t border-[var(--k1-border)] text-center",children:e.jsx("button",{onClick:()=>v(!0),className:"text-[10px] text-[var(--k1-accent)] hover:underline",children:"Scroll paused â€¢ Click to resume auto-scroll"})})]}),e.jsxs(F,{className:"bg-[var(--k1-panel)] border-[var(--k1-border)] p-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx(Ne,{ref:C,value:n,onChange:k=>o(k.target.value),onKeyDown:k=>{k.key==="Enter"&&j(n)},placeholder:"Enter command... (p, k, v, j, help)",className:"font-[family-name:var(--k1-code-family)] bg-[var(--k1-bg)] focus:ring-2 focus:ring-[var(--k1-accent)]"})}),e.jsx(z,{onClick:()=>j(n),children:"Execute"})]}),e.jsx("p",{className:"text-[8px] text-[var(--k1-text-dim)] mt-2",children:'Press Enter to execute â€¢ Type "help" for available commands'})]}),i.length>0&&e.jsxs(F,{className:"bg-[var(--k1-panel)] border-[var(--k1-border)]",children:[e.jsxs("button",{onClick:()=>m(!l),className:"w-full p-3 flex items-center justify-between hover:bg-[var(--k1-bg-elev)] transition-colors",children:[e.jsxs("span",{className:"text-[var(--k1-text-dim)] text-[10px] uppercase tracking-wide",children:["Command History (",i.length,")"]}),l?e.jsx(jt,{className:"w-4 h-4 text-[var(--k1-text-dim)]"}):e.jsx(nt,{className:"w-4 h-4 text-[var(--k1-text-dim)]"})]}),l&&e.jsx("div",{className:"border-t border-[var(--k1-border)]",children:e.jsx(at,{className:"max-h-48",children:e.jsx("div",{className:"p-2 space-y-1",children:i.map((k,E)=>e.jsxs("button",{onClick:()=>{o(k.command),C.current?.focus()},className:"w-full p-2 rounded hover:bg-[var(--k1-bg-elev)] text-left flex items-center justify-between group transition-colors",children:[e.jsx("span",{className:"font-[family-name:var(--k1-code-family)] text-[var(--k1-accent)]",children:k.command}),e.jsx("span",{className:"text-[8px] text-[var(--k1-text-dim)]",children:k.timestamp.toLocaleTimeString()})]},E))})})})]})]}):e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-[var(--k1-text-dim)] mb-4",children:"Terminal requires an active device connection"}),e.jsx("p",{className:"text-[var(--k1-text-dim)] text-[10px]",children:"Connect to your Emotiscope device to access the terminal"})]})})}function ja({className:s,...t}){return e.jsx(Ks,{"data-slot":"tabs",className:O("flex flex-col gap-2",s),...t})}function wa({className:s,...t}){return e.jsx(Ws,{"data-slot":"tabs-list",className:O("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-xl p-[3px] flex",s),...t})}function _e({className:s,...t}){return e.jsx(qs,{"data-slot":"tabs-trigger",className:O("data-[state=active]:bg-card dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-xl border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...t})}function De({className:s,...t}){return e.jsx(Gs,{"data-slot":"tabs-content",className:O("flex-1 outline-none",s),...t})}function ze({subscribe:s,onData:t,fallbackTick:r,intervalMs:a=500,autoStart:n=!1,hmrDelayMs:o,metricType:i}){const{isConnected:u}=xe(),{hmrDelayMs:l}=Vr(),[m,d]=c.useState(!1),[v,f]=c.useState(!1),C=c.useRef(null),h=c.useRef(null),j=c.useRef(!0),p=()=>{if(C.current){try{C.current()}catch{}C.current=null}h.current!==null&&(clearInterval(h.current),h.current=null),j.current&&(d(!1),f(!1))},N=()=>{if(p(),u&&s){const x=s(k=>{t(k)});x&&typeof x.then=="function"?x.then(k=>{C.current=k}).catch(k=>{if(Ur(k)){j.current&&(d(!1),f(!1));return}r?(h.current=window.setInterval(()=>{try{const E=r();t(E)}catch{}},a),j.current&&(f(!1),d(!0))):j.current&&(d(!1),f(!1))}):C.current=x,j.current&&(f(!0),d(!0));return}if(r){h.current=window.setInterval(()=>{try{const x=r();t(x)}catch{}},a),j.current&&(f(!1),d(!0));return}j.current&&(d(!1),f(!1))};return c.useEffect(()=>(n&&!m&&N(),()=>{j.current=!1,p()}),[]),c.useEffect(()=>{},[]),{start:N,stop:p,live:v,running:m}}function ka({isConnected:s,k1Client:t}){const[r,a]=c.useState([]),[n,o]=c.useState([]),[i,u]=c.useState("Unknown"),[l,m]=c.useState("1m"),d=le(),v=c.useMemo(()=>s&&!!t,[s,t]),f=()=>{const E=Date.now(),D=Math.random()*.3+.7;return{timestamp:E,fps:Math.max(30,60-Math.random()*15*(1-D)),frameTime:16.67+Math.random()*5*(1-D),renderTime:8+Math.random()*4*(1-D),cpuUsage:20+Math.random()*40*(1-D),memoryUsage:15+Math.random()*10,droppedFrames:Math.random()<.1?1:0,pattern:i}},C=E=>{const D={};for(const b of E)D[b.pattern]??=[],D[b.pattern].push(b);return Object.entries(D).map(([b,w])=>{const S=P=>w.reduce((_,R)=>_+R[P],0)/w.length,I=w.length,g=w.reduce((P,_)=>P+_.droppedFrames,0),A=Math.min(1,S("fps")/60)*100;return{name:b,avgFps:S("fps"),avgFrameTime:S("frameTime"),avgRenderTime:S("renderTime"),avgCpuUsage:S("cpuUsage"),totalFrames:I,droppedFrames:g,efficiency:A}})},h=ze({subscribe:v?E=>d.subscribePerformance(D=>{const b={timestamp:Date.now(),fps:D.fps,frameTime:D.frame_time_us/1e3,renderTime:D.frame_time_us/1e3*.5,cpuUsage:D.cpu_percent,memoryUsage:D.memory_percent??Math.max(0,100-(D.memory_free_kb??0)/1024),droppedFrames:0,pattern:i};E(b)}):void 0,onData:E=>{a(D=>{const b=l==="30s"?30:l==="1m"?60:300,w=[...D,E].slice(-b);return o(C(w)),w})},fallbackTick:f,intervalMs:1e3,autoStart:!1,metricType:"performance"}),j=()=>{h.running?h.stop():h.start()},N=(()=>{const b=Date.now()-{"30s":3e4,"1m":6e4,"5m":3e5}[l];return r.filter(w=>w.timestamp>=b)})(),x=N[N.length-1],k=(E,D)=>E>=D.good?"var(--k1-success)":E>=D.warning?"var(--k1-warning)":"var(--k1-danger)";return e.jsxs("div",{className:"space-y-4",children:[e.jsx(F,{className:"p-4 bg-[var(--k1-panel)] border-[var(--k1-border)]",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(z,{size:"sm",variant:h.running?"destructive":"default",onClick:j,children:h.running?"Stop Monitoring":"Start Monitoring"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-[var(--k1-text-dim)]",children:"Range"}),e.jsxs("select",{className:"bg-transparent border border-[var(--k1-border)] rounded px-2 py-1 text-sm",value:l,onChange:E=>m(E.target.value),children:[e.jsx("option",{value:"30s",children:"30s"}),e.jsx("option",{value:"1m",children:"1m"}),e.jsx("option",{value:"5m",children:"5m"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${h.running?"bg-[var(--k1-success)] animate-pulse":"bg-[var(--k1-text-dim)]"}`}),e.jsx("span",{className:"text-sm text-[var(--k1-text-dim)]",children:h.running?"Monitoring":"Stopped"})]}),e.jsxs("div",{className:"text-xs border rounded px-2 py-1 border-[var(--k1-border)] text-[var(--k1-text-dim)]",children:["Mode: ",e.jsx("span",{className:h.live?"text-[var(--k1-success)]":"text-[var(--k1-warning)]",children:h.live?"LIVE":"SIM"})]}),e.jsxs("div",{className:"text-xs border rounded px-2 py-1 border-[var(--k1-border)] text-[var(--k1-text-dim)]",children:["Current: ",i]})]})]})}),x&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(F,{className:"p-4 bg-[var(--k1-panel)] border-[var(--k1-border)]",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-[var(--k1-text-dim)]",children:"FPS"}),e.jsx("p",{className:"text-2xl font-bold",style:{color:k(x.fps,{good:55,warning:45})},children:x.fps.toFixed(1)})]}),e.jsx(Ce,{className:"w-8 h-8 text-[var(--k1-text-dim)]"})]})}),e.jsx(F,{className:"p-4 bg-[var(--k1-panel)] border-[var(--k1-border)]",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-[var(--k1-text-dim)]",children:"Frame Time"}),e.jsxs("p",{className:"text-2xl font-bold",style:{color:k(x.frameTime,{good:18,warning:22})},children:[x.frameTime.toFixed(2)," ms"]})]}),e.jsx(Ys,{className:"w-8 h-8 text-[var(--k1-text-dim)]"})]})}),e.jsx(F,{className:"p-4 bg-[var(--k1-panel)] border-[var(--k1-border)]",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-[var(--k1-text-dim)]",children:"Render Time"}),e.jsxs("p",{className:"text-2xl font-bold",style:{color:k(x.renderTime,{good:10,warning:15})},children:[x.renderTime.toFixed(2)," ms"]})]}),e.jsx(Tt,{className:"w-8 h-8 text-[var(--k1-text-dim)]"})]})}),e.jsx(F,{className:"p-4 bg-[var(--k1-panel)] border-[var(--k1-border)]",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-[var(--k1-text-dim)]",children:"CPU Usage"}),e.jsxs("p",{className:"text-2xl font-bold",style:{color:k(x.cpuUsage,{good:50,warning:70})},children:[x.cpuUsage.toFixed(0),"%"]})]}),e.jsx(Js,{className:"w-8 h-8 text-[var(--k1-text-dim)]"})]})})]})]})}const Me={brightness:"#ff6b6b",speed:"#4ecdc4",intensity:"#45b7d1",hue:"#96ceb4",saturation:"#feca57"},Na={brightness:{min:0,max:100},speed:{min:0,max:100},intensity:{min:0,max:100},hue:{min:0,max:360},saturation:{min:0,max:100}};function Ea({isConnected:s,k1Client:t}){const[r,a]=c.useState(!1),[n,o]=c.useState([]),[i,u]=c.useState([]),[l,m]=c.useState(["brightness","speed","intensity"]),[d,v]=c.useState("5m"),[f,C]=c.useState("all"),[h,j]=c.useState(!1),[p,N]=c.useState(0),x=c.useRef(null),k=c.useRef(null),E=()=>{const T=["brightness","speed","intensity","hue","saturation"],y=["Spectrum","Beat Tunnel","Pulse","Sparkle","Bloom"],M=["user","auto","preset"],L=T[Math.floor(Math.random()*T.length)],B=Na[L],q=Math.random()*(B.max-B.min)+B.min,Ve=Math.random()*(B.max-B.min)+B.min;return{timestamp:Date.now(),parameter:L,oldValue:Math.round(q*10)/10,newValue:Math.round(Ve*10)/10,pattern:y[Math.floor(Math.random()*y.length)],source:M[Math.floor(Math.random()*M.length)]}},D=()=>({timestamp:Date.now(),brightness:50+Math.random()*50,speed:30+Math.random()*70,intensity:40+Math.random()*60,hue:Math.random()*360,saturation:70+Math.random()*30,pattern:["Spectrum","Beat Tunnel","Pulse"][Math.floor(Math.random()*3)]}),b=()=>{r?(x.current&&(clearInterval(x.current),x.current=null),a(!1)):(a(!0),x.current=setInterval(()=>{if(Math.random()<.2){const T=E();o(y=>[...y,T].slice(-1e3))}if(Date.now()%5e3<1e3){const T=D();u(y=>[...y,T].slice(-500))}},1e3))},w=()=>{o([]),u([]),N(0)},S=()=>{const T={changes:n,snapshots:i,exportedAt:new Date().toISOString()},y=new Blob([JSON.stringify(T,null,2)],{type:"application/json"}),M=URL.createObjectURL(y),L=document.createElement("a");L.href=M,L.download=`k1-parameter-history-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(L),L.click(),document.body.removeChild(L),URL.revokeObjectURL(M)},I=()=>{i.length!==0&&(j(!0),N(0),k.current=setInterval(()=>{N(T=>{const y=T+1;return y>=i.length?(j(!1),0):y})},200))},g=()=>{j(!1),k.current&&(clearInterval(k.current),k.current=null)};c.useEffect(()=>()=>{x.current&&clearInterval(x.current),k.current&&clearInterval(k.current)},[]);const A=()=>{const M=Date.now()-{"1m":6e4,"5m":3e5,"15m":9e5,"1h":36e5}[d],L=i.filter(q=>q.timestamp>=M),B=n.filter(q=>q.timestamp>=M&&(f==="all"||q.source===f));return{snapshots:L,changes:B}},{snapshots:P,changes:_}=A(),R=P.map(T=>({timestamp:T.timestamp,time:new Date(T.timestamp).toLocaleTimeString(),...Object.fromEntries(l.map(y=>[y,T[y]]))})),Q=T=>{m(y=>y.includes(T)?y.filter(M=>M!==T):[...y,T])};return e.jsx("div",{className:"h-full overflow-auto",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs(F,{className:"p-4 bg-[var(--k1-panel)] border-[var(--k1-border)]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(z,{onClick:b,variant:r?"destructive":"default",className:"flex items-center gap-2",children:[r?e.jsx(et,{className:"w-4 h-4"}):e.jsx(tt,{className:"w-4 h-4"}),r?"Stop Recording":"Start Recording"]}),e.jsxs(z,{onClick:w,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(Ct,{className:"w-4 h-4"}),"Clear"]}),e.jsxs(z,{onClick:S,variant:"outline",className:"flex items-center gap-2",disabled:n.length===0,children:[e.jsx(Te,{className:"w-4 h-4"}),"Export"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${r?"bg-[var(--k1-error)] animate-pulse":"bg-[var(--k1-text-dim)]"}`}),e.jsxs("span",{className:"text-sm text-[var(--k1-text-dim)]",children:[n.length," changes â€¢ ",i.length," snapshots"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-[var(--k1-text-dim)]",children:"Time Range:"}),e.jsxs(ue,{value:d,onValueChange:T=>v(T),children:[e.jsx(he,{className:"w-24",children:e.jsx(me,{})}),e.jsxs(ge,{children:[e.jsx(U,{value:"1m",children:"1m"}),e.jsx(U,{value:"5m",children:"5m"}),e.jsx(U,{value:"15m",children:"15m"}),e.jsx(U,{value:"1h",children:"1h"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-[var(--k1-text-dim)]",children:"Source:"}),e.jsxs(ue,{value:f,onValueChange:T=>C(T),children:[e.jsx(he,{className:"w-24",children:e.jsx(me,{})}),e.jsxs(ge,{children:[e.jsx(U,{value:"all",children:"All"}),e.jsx(U,{value:"user",children:"User"}),e.jsx(U,{value:"auto",children:"Auto"}),e.jsx(U,{value:"preset",children:"Preset"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-[var(--k1-text-dim)]",children:"Parameters:"}),e.jsx("div",{className:"flex gap-1",children:Object.keys(Me).map(T=>e.jsxs(z,{onClick:()=>Q(T),variant:l.includes(T)?"default":"outline",size:"sm",className:"text-xs capitalize",children:[l.includes(T)?e.jsx(_t,{className:"w-3 h-3 mr-1"}):e.jsx(Qs,{className:"w-3 h-3 mr-1"}),T]},T))})]})]})]}),i.length>0&&e.jsxs(F,{className:"p-4 bg-[var(--k1-panel)] border-[var(--k1-border)]",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(z,{onClick:h?g:I,variant:h?"destructive":"default",className:"flex items-center gap-2",children:[h?e.jsx(et,{className:"w-4 h-4"}):e.jsx(tt,{className:"w-4 h-4"}),h?"Stop Playback":"Play History"]}),e.jsx(z,{onClick:()=>N(0),variant:"outline",size:"sm",children:e.jsx(Xs,{className:"w-4 h-4"})}),e.jsx(z,{onClick:()=>N(i.length-1),variant:"outline",size:"sm",children:e.jsx(Zs,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-[var(--k1-text-dim)]",children:["Frame ",p+1," of ",i.length]}),h&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-[var(--k1-success)] animate-pulse"})]})]}),i.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx("input",{type:"range",min:"0",max:i.length-1,value:p,onChange:T=>N(parseInt(T.target.value)),className:"w-full"})})]}),R.length>0&&e.jsxs(F,{className:"p-6 bg-[var(--k1-panel)] border-[var(--k1-border)]",children:[e.jsx("h3",{className:"text-lg font-semibold text-[var(--k1-text)] mb-4",children:"Parameter Timeline"}),e.jsx(ce,{width:"100%",height:400,children:e.jsxs(Ue,{data:R,children:[e.jsx(re,{strokeDasharray:"3 3",stroke:"var(--k1-border)"}),e.jsx(ae,{dataKey:"timestamp",tickFormatter:T=>new Date(T).toLocaleTimeString(),stroke:"var(--k1-text-dim)",tick:{fontSize:10,fill:"var(--k1-text-dim)"}}),e.jsx(ne,{stroke:"var(--k1-text-dim)",tick:{fontSize:10,fill:"var(--k1-text-dim)"}}),e.jsx(ie,{contentStyle:{backgroundColor:"var(--k1-bg-elev)",border:"1px solid var(--k1-border)",borderRadius:"6px",fontSize:"12px"},labelFormatter:T=>new Date(T).toLocaleTimeString()}),e.jsx(It,{}),e.jsx(pr,{dataKey:"timestamp",height:30,stroke:"var(--k1-accent)",tickFormatter:T=>new Date(T).toLocaleTimeString()}),l.map(T=>e.jsx(fe,{type:"monotone",dataKey:T,stroke:Me[T],strokeWidth:2,dot:!1,name:T.charAt(0).toUpperCase()+T.slice(1)},T))]})})]}),_.length>0&&e.jsxs(F,{className:"p-6 bg-[var(--k1-panel)] border-[var(--k1-border)]",children:[e.jsx("h3",{className:"text-lg font-semibold text-[var(--k1-text)] mb-4",children:"Recent Parameter Changes"}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:_.slice(-20).reverse().map((T,y)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-[var(--k1-bg)] rounded border border-[var(--k1-border)]",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:Me[T.parameter]}}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-[var(--k1-text)] capitalize",children:T.parameter}),e.jsxs("span",{className:"text-[var(--k1-text-dim)] ml-2",children:[T.oldValue," â†’ ",T.newValue]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{variant:"outline",className:"text-xs",children:T.pattern}),e.jsx(ve,{variant:T.source==="user"?"default":T.source==="auto"?"secondary":"outline",className:"text-xs",children:T.source}),e.jsx("span",{className:"text-xs text-[var(--k1-text-dim)]",children:new Date(T.timestamp).toLocaleTimeString()})]})]},y))})]}),i.length>0&&e.jsxs(F,{className:"p-6 bg-[var(--k1-panel)] border-[var(--k1-border)]",children:[e.jsxs("h3",{className:"text-lg font-semibold text-[var(--k1-text)] mb-4",children:["Current State ",h&&`(Playback Frame ${p+1})`]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:Object.entries(Me).map(([T,y])=>{const L=(i[p]||i[i.length-1])?.[T];return e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-2 rounded-full border-4 flex items-center justify-center",style:{borderColor:y},children:e.jsx("span",{className:"text-lg font-bold text-[var(--k1-text)]",children:Math.round(L||0)})}),e.jsx("p",{className:"text-sm text-[var(--k1-text-dim)] capitalize",children:T})]},T)})})]})]})})}const Ca=["Sub","60Hz","170Hz","310Hz","600Hz","1kHz","3kHz","6kHz","12kHz","14kHz+"];function Ta({isConnected:s,k1Client:t}){const[r,a]=c.useState(!1),[n,o]=c.useState([]),[i,u]=c.useState([]),[l,m]=c.useState(null),[d,v]=c.useState([75]),[f,C]=c.useState([60]),[h,j]=c.useState("full"),[p,N]=c.useState("spectrum"),[x,k]=c.useState(!1),E=le(),D=c.useMemo(()=>s&&!!t,[s,t]),w=ze({subscribe:D?_=>E.subscribeAudio(R=>{const Q=R?.beat_confidence??R?.beatConfidence??0,T=R?.bands??R?.frequencyBands??[],y={timestamp:Date.now(),rms:typeof R?.rms=="number"?Math.round(R.rms*100)/100:0,peak:typeof R?.peak=="number"?Math.round(R.peak*100)/100:typeof R?.rms=="number"?Math.round(R.rms*100)/100:0,beatDetected:Q>.6,beatConfidence:Math.round(Q*100),bpm:Math.round(R?.bpm??0),spectralCentroid:R?.spectral_centroid??R?.spectralCentroid??0,spectralRolloff:R?.spectral_rolloff??R?.spectralRolloff??0,zeroCrossingRate:R?.zero_crossing_rate??R?.zeroCrossingRate??0,mfcc:R?.mfcc??Array.from({length:13},()=>0),frequencyBands:T.length?T:Array.from({length:10},()=>0)};_(y)}):void 0,onData:_=>{m(_),o(R=>[...R,_].slice(-500)),_.beatDetected&&u(R=>[...R,{timestamp:_.timestamp,confidence:_.beatConfidence,bpm:_.bpm,energy:Math.round(_.peak*100)}].slice(-100))},fallbackTick:()=>{const _=Date.now(),R=Math.random(),Q=Math.max(R,Math.random()),T=Math.random(),y=T>.6,M=60+Math.random()*120,L=Math.random()*8e3,B=L*1.5,q=Math.random(),Ve=Array.from({length:13},()=>Math.random()),es=Array.from({length:10},()=>Math.random());return{timestamp:_,rms:Math.round(R*100)/100,peak:Math.round(Q*100)/100,beatDetected:y,beatConfidence:Math.round(T*100),bpm:Math.round(M),spectralCentroid:L,spectralRolloff:B,zeroCrossingRate:q,mfcc:Ve,frequencyBands:es}},intervalMs:300,autoStart:!1,metricType:"audio"}),S=()=>{w.running?(w.stop(),a(!1)):(w.start(),a(!0))},I=()=>{o([]),u([]),m(null)};c.useEffect(()=>()=>{},[]);const g=l?.frequencyBands.map((_,R)=>({frequency:Ca[R],amplitude:_,index:R}))||[],A=n.slice(-100).map((_,R)=>({time:R,rms:_.rms,peak:_.peak,timestamp:_.timestamp})),P=i.slice(-20).map((_,R)=>({beat:R+1,confidence:_.confidence,bpm:_.bpm,energy:_.energy,timestamp:_.timestamp}));return l?.mfcc.map((_,R)=>({coefficient:`C${R}`,value:Math.round(_*100)/100,index:R})),e.jsx("div",{className:"h-full overflow-auto",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs(F,{className:"p-4 bg-[var(--k1-panel)] border-[var(--k1-border)]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(z,{onClick:S,variant:w.running?"destructive":"default",className:"flex items-center gap-2",children:[w.running?e.jsx(er,{className:"w-4 h-4"}):e.jsx(tr,{className:"w-4 h-4"}),w.running?"Stop Listening":"Start Listening"]}),e.jsxs(z,{onClick:I,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(sr,{className:"w-4 h-4"}),"Clear"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-[var(--k1-text-dim)]",children:"Mode:"}),e.jsxs(ue,{value:p,onValueChange:_=>N(_),children:[e.jsx(he,{className:"w-32",children:e.jsx(me,{})}),e.jsxs(ge,{children:[e.jsx(U,{value:"spectrum",children:"Spectrum"}),e.jsx(U,{value:"waveform",children:"Waveform"}),e.jsx(U,{value:"beats",children:"Beat Analysis"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${w.running?"bg-[var(--k1-success)] animate-pulse":"bg-[var(--k1-text-dim)]"}`}),e.jsxs("span",{className:"text-sm text-[var(--k1-text-dim)]",children:[n.length," samples â€¢ ",i.length," beats"]}),e.jsxs("div",{className:"text-xs border rounded px-2 py-1 border-[var(--k1-border)] text-[var(--k1-text-dim)] ml-2",children:["Source: ",e.jsx("span",{className:w.live?"text-[var(--k1-success)]":"text-[var(--k1-warning)]",children:w.live?"LIVE":"SIM"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm text-[var(--k1-text-dim)]",children:["Sensitivity: ",d[0],"%"]}),e.jsx(Z,{value:d,onValueChange:v,max:100,step:1,className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm text-[var(--k1-text-dim)]",children:["Beat Threshold: ",f[0],"%"]}),e.jsx(Z,{value:f,onValueChange:C,max:100,step:1,className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-[var(--k1-text-dim)]",children:"Frequency Range"}),e.jsxs(ue,{value:h,onValueChange:_=>j(_),children:[e.jsx(he,{children:e.jsx(me,{})}),e.jsxs(ge,{children:[e.jsx(U,{value:"full",children:"Full Range"}),e.jsx(U,{value:"bass",children:"Bass (20-250Hz)"}),e.jsx(U,{value:"mid",children:"Mid (250-4kHz)"}),e.jsx(U,{value:"treble",children:"Treble (4-20kHz)"})]})]})]})]})]}),l&&e.jsxs(F,{className:"p-6 bg-[var(--k1-panel)] border-[var(--k1-border)]",children:[e.jsxs("h3",{className:"text-lg font-semibold text-[var(--k1-text)] mb-4 flex items-center gap-2",children:[e.jsx(Ce,{className:"w-5 h-5"}),"Live Audio Metrics"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-[var(--k1-accent)]",children:l.rms}),e.jsx("div",{className:"text-sm text-[var(--k1-text-dim)]",children:"RMS Level"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-[var(--k1-warning)]",children:l.peak}),e.jsx("div",{className:"text-sm text-[var(--k1-text-dim)]",children:"Peak Level"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-[var(--k1-success)]",children:l.bpm}),e.jsx("div",{className:"text-sm text-[var(--k1-text-dim)]",children:"BPM"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-[var(--k1-error)]",children:l.beatConfidence}),e.jsx("div",{className:"text-sm text-[var(--k1-text-dim)]",children:"Beat Confidence"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-[var(--k1-text)]",children:Math.round(l.spectralCentroid)}),e.jsx("div",{className:"text-sm text-[var(--k1-text-dim)]",children:"Spectral Centroid"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-[var(--k1-text)]",children:Math.round(l.spectralRolloff)}),e.jsx("div",{className:"text-sm text-[var(--k1-text-dim)]",children:"Spectral Rolloff"})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Et,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm text-[var(--k1-text-dim)]",children:"Visualization"})]}),p==="spectrum"&&e.jsxs(z,{onClick:()=>k(!x),variant:"outline",size:"sm",className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"w-4 h-4"}),x?"Hide MFCC":"Show MFCC"]})]}),e.jsxs(ce,{width:"100%",height:300,children:[p==="spectrum"&&e.jsxs(it,{data:g,children:[e.jsx(re,{strokeDasharray:"3 3",stroke:"var(--k1-border)"}),e.jsx(ae,{dataKey:"frequency",stroke:"var(--k1-text-dim)",tick:{fontSize:10,fill:"var(--k1-text-dim)"}}),e.jsx(ne,{stroke:"var(--k1-text-dim)",tick:{fontSize:10,fill:"var(--k1-text-dim)"}}),e.jsx(ie,{contentStyle:{backgroundColor:"var(--k1-bg-elev)",border:"1px solid var(--k1-border)",borderRadius:"6px",fontSize:"12px"}}),e.jsx($e,{dataKey:"amplitude",fill:"var(--k1-accent)",radius:[2,2,0,0]})]}),p==="waveform"&&e.jsxs(st,{data:A,children:[e.jsx(re,{strokeDasharray:"3 3",stroke:"var(--k1-border)"}),e.jsx(ae,{dataKey:"time",stroke:"var(--k1-text-dim)",tick:{fontSize:10,fill:"var(--k1-text-dim)"}}),e.jsx(ne,{stroke:"var(--k1-text-dim)",tick:{fontSize:10,fill:"var(--k1-text-dim)"}}),e.jsx(ie,{contentStyle:{backgroundColor:"var(--k1-bg-elev)",border:"1px solid var(--k1-border)",borderRadius:"6px",fontSize:"12px"}}),e.jsx(de,{type:"monotone",dataKey:"rms",stroke:"var(--k1-accent)",fill:"var(--k1-accent)",fillOpacity:.3}),e.jsx(de,{type:"monotone",dataKey:"peak",stroke:"var(--k1-warning)",fill:"var(--k1-warning)",fillOpacity:.3})]}),p==="beats"&&e.jsxs(Ue,{data:P,children:[e.jsx(re,{strokeDasharray:"3 3",stroke:"var(--k1-border)"}),e.jsx(ae,{dataKey:"beat",stroke:"var(--k1-text-dim)",tick:{fontSize:10,fill:"var(--k1-text-dim)"}}),e.jsx(ne,{stroke:"var(--k1-text-dim)",tick:{fontSize:10,fill:"var(--k1-text-dim)"}}),e.jsx(ie,{contentStyle:{backgroundColor:"var(--k1-bg-elev)",border:"1px solid var(--k1-border)",borderRadius:"6px",fontSize:"12px"}}),e.jsx(fe,{type:"monotone",dataKey:"confidence",stroke:"var(--k1-success)",strokeWidth:2}),e.jsx(fe,{type:"monotone",dataKey:"bpm",stroke:"var(--k1-accent)",strokeWidth:2})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-md font-semibold text-[var(--k1-text)] mb-2",children:"Recent Beat Events"}),e.jsx("div",{className:"space-y-2",children:i.slice(-10).map(_=>e.jsxs("div",{className:"flex items-center justify-between bg-[var(--k1-panel)] border border-[var(--k1-border)] rounded p-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(kt,{className:"w-4 h-4 text-[var(--k1-success)]"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:"Beat detected"}),e.jsxs("span",{className:"text-[var(--k1-text-dim)] ml-2",children:[_.confidence,"% confidence"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(ve,{variant:"outline",className:"text-xs",children:[_.bpm," BPM"]}),e.jsxs(ve,{variant:"outline",className:"text-xs",children:[_.energy," Energy"]}),e.jsx("span",{className:"text-xs text-[var(--k1-text-dim)]",children:new Date(_.timestamp).toLocaleTimeString()})]})]},_.timestamp))})]})]})]})})}class Sa{state;MAX_SNAPSHOTS=100;snapshotIntervalMs=5e3;lastSnapshotAt=Date.now();constructor(){this.state={snapshots:[],methodMetrics:new Map,cacheMetrics:{totalHits:0,totalMisses:0,totalEvictions:0,currentSize:0,maxSize:1e3,hitRate:0,lastUpdatedAt:Date.now()},pendingAttempts:new Map,totalDiscoveries:0,totalDevicesFound:0}}startDiscovery(t){const r=`${t}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,a={id:r,method:t,startedAt:Date.now(),completedAt:null,durationMs:null,success:null,devicesFound:null,error:null};return this.state.pendingAttempts.set(r,a),r}completeDiscovery(t,r){const a=this.state.pendingAttempts.get(t);if(!a){console.warn(`[DiscoveryMetrics] Attempt ${t} not found`);return}a.completedAt=Date.now(),a.durationMs=r.durationMs,a.success=r.success,a.devicesFound=r.devicesFound,a.error=r.error||null;const n=a.method;let o=this.state.methodMetrics.get(n);o||(o={name:n,attemptCount:0,successCount:0,failureCount:0,totalDurationMs:0,minDurationMs:1/0,maxDurationMs:0,avgDurationMs:0,successRate:0,lastAttemptAt:Date.now(),lastSuccessAt:null},this.state.methodMetrics.set(n,o)),o.attemptCount++,o.lastAttemptAt=Date.now(),o.totalDurationMs+=r.durationMs,o.minDurationMs=Math.min(o.minDurationMs,r.durationMs),o.maxDurationMs=Math.max(o.maxDurationMs,r.durationMs),o.avgDurationMs=o.totalDurationMs/o.attemptCount,r.success?(o.successCount++,o.lastSuccessAt=Date.now()):o.failureCount++,o.successRate=o.successCount/o.attemptCount,this.state.totalDiscoveries++,this.state.totalDevicesFound+=r.devicesFound,this.state.pendingAttempts.delete(t),this.maybeSnapshot()}recordCacheHit(){this.state.cacheMetrics.totalHits++,this.updateCacheHitRate()}recordCacheMiss(){this.state.cacheMetrics.totalMisses++,this.updateCacheHitRate()}recordCacheEviction(t){this.state.cacheMetrics.totalEvictions++,this.state.cacheMetrics.lastUpdatedAt=Date.now()}updateCacheMetrics(t,r){this.state.cacheMetrics.currentSize=t,r!==void 0&&(this.state.cacheMetrics.maxSize=r),this.state.cacheMetrics.lastUpdatedAt=Date.now()}getRecommendedMethod(){if(this.state.methodMetrics.size===0)return null;let t=null,r=-1/0;for(const[a,n]of this.state.methodMetrics.entries()){if(n.attemptCount===0)continue;const o=Math.max(0,1-n.avgDurationMs/1e4),i=n.successRate*.7+o*.3;i>r&&(r=i,t=a)}return t}exportMetrics(){return{snapshots:[...this.state.snapshots],methodMetrics:new Map(this.state.methodMetrics),cacheMetrics:{...this.state.cacheMetrics},pendingAttempts:new Map(this.state.pendingAttempts),totalDiscoveries:this.state.totalDiscoveries,totalDevicesFound:this.state.totalDevicesFound}}getMethodMetrics(){return new Map(this.state.methodMetrics)}getCacheMetrics(){return{...this.state.cacheMetrics}}getTotalStats(){const t=this.state.totalDiscoveries>0?this.state.totalDevicesFound/this.state.totalDiscoveries:0;return{totalDiscoveries:this.state.totalDiscoveries,totalDevicesFound:this.state.totalDevicesFound,avgDevicesPerDiscovery:t}}getSnapshots(){return[...this.state.snapshots]}reset(){this.state={snapshots:[],methodMetrics:new Map,cacheMetrics:{totalHits:0,totalMisses:0,totalEvictions:0,currentSize:0,maxSize:1e3,hitRate:0,lastUpdatedAt:Date.now()},pendingAttempts:new Map,totalDiscoveries:0,totalDevicesFound:0},this.lastSnapshotAt=Date.now()}maybeSnapshot(){const t=Date.now();if(t-this.lastSnapshotAt<this.snapshotIntervalMs)return;this.lastSnapshotAt=t;const r={timestamp:t,methodMetrics:new Map(this.state.methodMetrics),cacheMetrics:{...this.state.cacheMetrics},totalDiscoveries:this.state.totalDiscoveries,totalDevicesFound:this.state.totalDevicesFound,avgDevicesPerDiscovery:this.state.totalDiscoveries>0?this.state.totalDevicesFound/this.state.totalDiscoveries:0};this.state.snapshots.push(r),this.state.snapshots.length>this.MAX_SNAPSHOTS&&this.state.snapshots.shift()}updateCacheHitRate(){const t=this.state.cacheMetrics.totalHits+this.state.cacheMetrics.totalMisses;this.state.cacheMetrics.hitRate=t>0?this.state.cacheMetrics.totalHits/t:0,this.state.cacheMetrics.lastUpdatedAt=Date.now()}}const se=new Sa;function _a(s=1e3){const t=Math.max(100,s),[r,a]=c.useState({methodMetrics:new Map,history:[],snapshot:null,aggregate:{totalDiscoveries:0,totalDevicesFound:0,avgDevicesPerDiscovery:0},loading:!0,error:null});return c.useEffect(()=>{let n;const o=()=>{try{const i=se.getMethodMetrics(),u=se.getSnapshots(),l=se.getTotalStats(),m=u.length>0?u[u.length-1]:null;a({methodMetrics:i,history:u,snapshot:m,aggregate:{totalDiscoveries:l.totalDiscoveries,totalDevicesFound:l.totalDevicesFound,avgDevicesPerDiscovery:l.avgDevicesPerDiscovery},loading:!1,error:null})}catch(i){console.error("[useDiscoveryMetrics] Error updating metrics:",i),a(u=>({...u,loading:!1,error:i instanceof Error?i.message:"Unknown error"}))}};return o(),n=setInterval(o,t),()=>{n&&clearInterval(n)}},[t]),r}class Gt{_isDiscovering=!1;_discoveredDevices=new Map;_abortController=null;_debounceTimer=null;_refreshInterval=null;_wasCancelled=!1;_callbacks={};constructor(){}on(t,r){t==="devices-found"?this._callbacks.onDevicesFound=r:t==="discovery-started"?this._callbacks.onDiscoveryStarted=r:t==="discovery-completed"?this._callbacks.onDiscoveryCompleted=r:t==="discovery-error"?this._callbacks.onDiscoveryError=r:t==="device-updated"&&(this._callbacks.onDeviceUpdated=r)}off(t,r){t==="devices-found"?this._callbacks.onDevicesFound=void 0:t==="discovery-started"?this._callbacks.onDiscoveryStarted=void 0:t==="discovery-completed"?this._callbacks.onDiscoveryCompleted=void 0:t==="discovery-error"?this._callbacks.onDiscoveryError=void 0:t==="device-updated"&&(this._callbacks.onDeviceUpdated=void 0)}_emit(t,r){t==="devices-found"&&this._callbacks.onDevicesFound?this._callbacks.onDevicesFound(r):t==="discovery-started"&&this._callbacks.onDiscoveryStarted?this._callbacks.onDiscoveryStarted():t==="discovery-completed"&&this._callbacks.onDiscoveryCompleted?this._callbacks.onDiscoveryCompleted(r):t==="discovery-error"&&this._callbacks.onDiscoveryError?this._callbacks.onDiscoveryError(r):t==="device-updated"&&this._callbacks.onDeviceUpdated&&this._callbacks.onDeviceUpdated(r)}async discoverDevices(t={}){const{timeout:r=5e3,includeOffline:a=!1,preferredMethods:n=["mdns","scan"]}=t;this.cancelDiscovery(!0),this._isDiscovering=!0,this._abortController=new AbortController;const o=Date.now(),i=[];let u="hybrid",l;this._emit("discovery-started");try{const m=[];if(!this._wasCancelled&&n.includes("mdns"))try{console.log("[DiscoveryService] Attempting K1Client.discover...");const f=await this._discoverViaMDNS(r/2);m.push(...f),u="mdns",console.log(`[DiscoveryService] Found ${f.length} devices via mDNS`)}catch(f){console.warn("[DiscoveryService] mDNS discovery failed:",f),i.push(`mDNS discovery failed: ${f}`),l=f}if(this._wasCancelled=!1,m.length===0&&!n.includes("scan")){if(l){const C=l instanceof Error?l:new Error(String(l));this._emit("discovery-error",C)}const f={devices:[],method:"mdns",duration:Date.now()-o,errors:i.length>0?i:void 0};return this._updateDeviceCache([]),this._emit("devices-found",[]),this._emit("discovery-completed",f),f}if(this._abortController?.signal.aborted)throw new Error("Discovery cancelled");if(n.includes("scan"))try{console.log("[DiscoveryService] Attempting network scan fallback...");const f=await this._discoverViaScan(r/2);for(const C of f)m.find(h=>h.ip===C.ip||h.mac===C.mac)||m.push(C);u=m.length>f.length?"hybrid":"scan",console.log(`[DiscoveryService] Found ${f.length} additional devices via scan`)}catch(f){console.warn("[DiscoveryService] Network scan failed:",f),i.push(`Network scan failed: ${f}`)}const d=a?m:m.filter(f=>Date.now()-f.lastSeen.getTime()<3e5);this._updateDeviceCache(d);const v={devices:d,method:u,duration:Date.now()-o,errors:i.length>0?i:void 0};return this._emit("devices-found",d),this._emit("discovery-completed",v),v}catch(m){const d=m instanceof Error?m:new Error(String(m));throw this._emit("discovery-error",d),d}finally{this._isDiscovering=!1,this._abortController=null}}cancelDiscovery(t=!1){this._abortController&&(this._abortController.abort(),this._abortController=null),t||(this._wasCancelled=!0)}startContinuousDiscovery(t=3e4,r={}){this.stopContinuousDiscovery(),this.discoverDevices(r).catch(a=>{console.warn("[DiscoveryService] Initial continuous discovery failed:",a)}),this._refreshInterval=setInterval(()=>{this._isDiscovering||this.discoverDevices(r).catch(a=>{console.warn("[DiscoveryService] Continuous discovery refresh failed:",a)})},t)}stopContinuousDiscovery(){this._refreshInterval&&(clearInterval(this._refreshInterval),this._refreshInterval=null),this.cancelDiscovery(!0)}getDiscoveredDevices(){return Array.from(this._discoveredDevices.values()).sort((t,r)=>r.lastSeen.getTime()-t.lastSeen.getTime())}getDevice(t){const r=this._discoveredDevices.get(t);return r||Array.from(this._discoveredDevices.values()).find(a=>a.ip===t)}addManualDevice(t,r=80){const a={id:`manual-${t}`,name:`K1 Device (${t})`,ip:t,port:r,mac:"unknown",firmware:"unknown",lastSeen:new Date,discoveryMethod:"manual"};return this._discoveredDevices.set(a.id,a),this._emit("device-updated",a),a}isDiscovering(){return this._isDiscovering}listenerCount(t){return t==="devices-found"?this._callbacks.onDevicesFound?1:0:t==="discovery-started"?this._callbacks.onDiscoveryStarted?1:0:t==="discovery-completed"?this._callbacks.onDiscoveryCompleted?1:0:t==="discovery-error"?this._callbacks.onDiscoveryError?1:0:t==="device-updated"&&this._callbacks.onDeviceUpdated?1:0}cleanup(){this.stopContinuousDiscovery(),this.cancelDiscovery(!0),this._discoveredDevices.clear(),this._callbacks={}}async _discoverViaMDNS(t){if(this._abortController?.signal.aborted)throw new Error("Discovery cancelled");try{const r=Ee.discover(t);if(this._abortController){const n=this._abortController.signal,o=new Promise((u,l)=>{const m=()=>{n.removeEventListener("abort",m),l(new Error("Discovery cancelled"))};n.addEventListener("abort",m)});return(await Promise.race([r,o])).map(u=>({...u,discoveryMethod:"mdns"}))}return(await r).map(n=>({...n,discoveryMethod:"mdns"}))}catch(r){throw console.warn("[DiscoveryService] mDNS discovery failed:",r),r instanceof Error?r:new Error(String(r))}}async _discoverViaScan(t){if(this._abortController?.signal.aborted)throw new Error("Discovery cancelled");return[{id:"k1-scan",name:"K1.scan",ip:"192.168.1.200",port:80,mac:"00:11:22:33:44:77",firmware:"1.0.0",lastSeen:new Date,discoveryMethod:"scan"}]}_updateDeviceCache(t){for(const r of t){const a=this._discoveredDevices.get(r.id);if(a){const n={...a,...r,lastSeen:new Date(Math.max(a.lastSeen.getTime(),r.lastSeen.getTime()))};this._discoveredDevices.set(r.id,n),this._emit("device-updated",n)}else this._discoveredDevices.set(r.id,r),this._emit("device-updated",r)}}}const ee=new Gt;function Yt(){return{discoverDevices:s=>ee.discoverDevices(s),getDiscoveredDevices:()=>ee.getDiscoveredDevices(),getDevice:s=>ee.getDevice(s),addManualDevice:(s,t)=>ee.addManualDevice(s,t),isDiscovering:()=>ee.isDiscovering(),startContinuous:(s,t)=>ee.startContinuousDiscovery(s,t),stopContinuous:()=>ee.stopContinuousDiscovery(),cancelDiscovery:()=>ee.cancelDiscovery(),on:(s,t)=>ee.on(s,t),off:(s,t)=>ee.off(s,t)}}class Da{deviceHistory=new Map;confidenceScores=new Map;invalidationLog=[];minTtlMs=3e5;maxTtlMs=72e5;confidenceThreshold=.8;maxHistoryPerDevice=20;maxInvalidationLog=100;recordDeviceState(t){if(!t.id){console.warn("[CacheInvalidation] Device ID is empty, skipping state recording");return}const r={timestamp:Date.now(),mac:t.mac||"",ip:t.ip,discoveryCount:t.discoveryCount,discoveryMethod:t.discoveryMethod,rssi:t.rssi};let a=this.deviceHistory.get(t.id);a||(a=[],this.deviceHistory.set(t.id,a)),a.push(r),a.length>this.maxHistoryPerDevice&&a.shift(),this.confidenceScores.set(t.id,this.computeConfidence(t.id))}detectChanges(t){if(!t.id)return console.error("[CacheInvalidation] Device ID is empty for change detection"),null;const r=this.deviceHistory.get(t.id),a={timestamp:Date.now(),mac:t.mac||"",ip:t.ip,discoveryCount:t.discoveryCount,discoveryMethod:t.discoveryMethod,rssi:t.rssi};if(!r||r.length===0)return{changeType:"new_device",confidence:.5,oldState:null,newState:a,details:"First time seeing this device"};if(r.length===1)return{changeType:"stable",confidence:.6,oldState:r[0],newState:a,details:"Building device history baseline"};const n=r.slice(-3),o=n[n.length-1];return t.mac&&o.mac&&t.mac!==o.mac?{changeType:"mac_change",confidence:.95,oldState:o,newState:a,details:`MAC changed from ${o.mac} to ${t.mac}`}:t.ip!==o.ip?{changeType:"ip_change",confidence:.9,oldState:o,newState:a,details:`IP changed from ${o.ip} to ${t.ip}`}:{changeType:"stable",confidence:.99,oldState:o,newState:a,details:"Device state is stable"}}computeConfidence(t){const r=this.deviceHistory.get(t);if(!r||r.length===0)return .5;const a=r[r.length-1],n=Date.now(),o=Math.min(a.discoveryCount/10,1),u=(n-a.timestamp)/(1440*60*1e3),l=Math.max(.5,1-u);let m=0;for(let C=1;C<r.length;C++){const h=r[C-1],j=r[C];(h.ip!==j.ip||h.mac!==j.mac)&&m++}const v=1-(r.length>1?m/(r.length-1):0),f=o*.5+l*.3+v*.2;return Math.max(0,Math.min(1,f))}computeAdaptiveTTL(t){const r=this.confidenceScores.get(t)||.5;return r>=.9?this.maxTtlMs:r>=.75?36e5:r>=.6?18e5:this.minTtlMs}shouldInvalidate(t){const r=this.detectChanges(t);if(!r)return!1;if((r.changeType==="ip_change"||r.changeType==="mac_change")&&r.confidence>this.confidenceThreshold)return!0;const a=this.computeAdaptiveTTL(t.id);return Date.now()-t.lastSeen.getTime()>a}markAsStale(t,r){const a=this.confidenceScores.get(t)||0,n={deviceId:t,timestamp:Date.now(),reason:r,confidence:a,details:this.getInvalidationDetails(r,a)};this.invalidationLog.push(n),this.invalidationLog.length>this.maxInvalidationLog&&this.invalidationLog.shift(),console.log(`[CacheInvalidation] Device ${t} marked as stale: ${r} (confidence: ${a.toFixed(2)})`)}getInvalidationHistory(t=50){return this.invalidationLog.slice(-t).sort((r,a)=>a.timestamp-r.timestamp)}getDeviceConfidence(t){return this.confidenceScores.get(t)||.5}getDeviceHistory(t){return this.deviceHistory.get(t)||[]}reset(){this.deviceHistory.clear(),this.confidenceScores.clear(),this.invalidationLog.length=0}getStats(){return{trackedDevices:this.deviceHistory.size,totalInvalidations:this.invalidationLog.length,avgConfidence:this.getAverageConfidence()}}getInvalidationDetails(t,r){switch(t){case"disappeared":return`Device not seen in recent discoveries (confidence: ${r.toFixed(2)})`;case"changed":return`Device state changed significantly (confidence: ${r.toFixed(2)})`;case"ttl_expired":return`Adaptive TTL expired (confidence: ${r.toFixed(2)})`;default:return`Unknown invalidation reason: ${t}`}}getAverageConfidence(){return this.confidenceScores.size===0?0:Array.from(this.confidenceScores.values()).reduce((r,a)=>r+a,0)/this.confidenceScores.size}}const Re=new Da;class Ma{methods=new Map;config;metrics;executor;strategy;constructor(t,r,a){this.config=t,this.metrics=r,this.executor=a,this.strategy=t.strategy||"sequential",t.methods.forEach(n=>{this.methods.set(n.name,{...n})})}async execute(t={}){const r=performance.now(),a=t.strategy||this.strategy||"sequential",n=t.timeout||this.config.defaultTimeout||5e3;let o=this.getEnabledMethods();if(t.preferredMethods&&t.preferredMethods.length>0&&(o=o.filter(i=>t.preferredMethods.includes(i.name))),o.length===0)return{devices:[],method:"none",duration:performance.now()-r,errors:["No enabled discovery methods available"],hasErrors:!0,cancelled:!1};o.sort((i,u)=>u.priority-i.priority);try{let i;switch(a){case"race":i=await this.executeRace(o,n);break;case"hybrid":i=await this.executeHybrid(o,n);break;case"sequential":default:i=await this.executeSequential(o,n);break}return this.config.learningEnabled&&!i.hasErrors&&this.adjustPriorities(),i}catch(i){return{devices:[],method:"error",duration:performance.now()-r,errors:[i instanceof Error?i.message:String(i)],hasErrors:!0,cancelled:!1}}}async executeSequential(t,r){const a=[],n=performance.now();for(const o of t){const i=o.timeout||r;let u=0;const l=o.retries+1;for(;u<l;){try{const m=await this.executor(o.name,i);if(!m.hasErrors&&m.devices.length>0)return{...m,duration:performance.now()-n};m.errors&&a.push(...m.errors)}catch(m){const d=`${o.name} failed: ${m instanceof Error?m.message:String(m)}`;a.push(d)}u++,u<l&&await this.delay(500)}}return{devices:[],method:"sequential_failed",duration:performance.now()-n,errors:a,hasErrors:!0,cancelled:!1}}async executeRace(t,r){const a=performance.now(),n=t.map(async m=>{const d=m.timeout||r,v=performance.now();try{const f=await this.executor(m.name,d);return{success:!f.hasErrors&&f.devices.length>0,result:f,method:m.name,duration:performance.now()-v}}catch(f){return{success:!1,error:f instanceof Error?f:new Error(String(f)),method:m.name,duration:performance.now()-v}}}),o=[],i=[];(await Promise.allSettled(n)).forEach((m,d)=>{m.status==="fulfilled"?i.push(m.value):o.push(`${t[d].name} promise rejected: ${m.reason}`)});const l=i.filter(m=>m.success&&m.result);if(l.length>0)for(const m of t){const d=l.find(v=>v.method===m.name);if(d&&d.result)return{...d.result,duration:performance.now()-a}}return i.forEach(m=>{m.success||(m.error?o.push(`${m.method}: ${m.error.message}`):m.result?.errors&&o.push(...m.result.errors.map(d=>`${m.method}: ${d}`)))}),{devices:[],method:"race_failed",duration:performance.now()-a,errors:o,hasErrors:!0,cancelled:!1}}async executeHybrid(t,r){const a=performance.now(),n=t.filter(i=>i.priority>=7),o=t.filter(i=>i.priority<7);if(n.length>0){const i=await this.executeSequential(n,r);if(!i.hasErrors&&i.devices.length>0)return{...i,duration:performance.now()-a}}return o.length>0?{...await this.executeRace(o,r),duration:performance.now()-a}:{devices:[],method:"hybrid_failed",duration:performance.now()-a,errors:["No methods succeeded in hybrid strategy"],hasErrors:!0,cancelled:!1}}adjustPriorities(){if(!this.config.learningEnabled)return;const t=this.metrics.getMethodMetrics();this.methods.forEach((r,a)=>{const n=t.get(a);if(!n||n.attemptCount<10)return;const o=n.successRate,i=Math.max(0,1-n.avgDurationMs/1e4),u=o*.7+i*.3;let l;u>=.9?l=Math.floor(9+u*10)%10+1:u>=.7?l=Math.floor(7+(u-.7)*10):u>=.5?l=Math.floor(5+(u-.5)*10):l=Math.floor(1+u*8);const m=r.priority;Math.abs(l-m)>1&&(l=m+(l>m?1:-1)),l=Math.max(1,Math.min(10,l)),r.priority=l,console.log(`[DiscoveryQueue] Adjusted ${a} priority: ${m} â†’ ${l} (score: ${u.toFixed(3)})`)})}getConfig(){return{...this.config,methods:Array.from(this.methods.values())}}setConfig(t){t.strategy&&(this.strategy=t.strategy,this.config.strategy=t.strategy),t.defaultTimeout&&(this.config.defaultTimeout=t.defaultTimeout),t.learningEnabled!==void 0&&(this.config.learningEnabled=t.learningEnabled),t.methods&&(this.methods.clear(),t.methods.forEach(r=>{this.methods.set(r.name,{...r})}),this.config.methods=[...t.methods])}getEnabledMethods(){return Array.from(this.methods.values()).filter(t=>t.enabled)}delay(t){return new Promise(r=>setTimeout(r,t))}getMethodStats(){const t={},r=this.metrics.getMethodMetrics();return this.methods.forEach((a,n)=>{const o=r.get(n);t[n]={priority:a.priority,enabled:a.enabled,timeout:a.timeout,retries:a.retries,successRate:o?.successRate||0,avgDuration:o?.avgDurationMs||0,attemptCount:o?.attemptCount||0}}),t}resetPriorities(){const t={mdns:8,scan:6,manual:4};this.methods.forEach((r,a)=>{r.priority=t[a]||5}),console.log("[DiscoveryQueue] Reset all method priorities to defaults")}}class Ra{_discoveryService;_debounceTimer=null;_debounceMs=300;_abortController=null;_discoveryCache=new Map;_lastDiscovery=null;_isDiscoveryInProgress=!1;_pendingResolvers=[];_maxCacheSize=100;_cacheTtlMs=36e5;_queue;constructor(){this._discoveryService=new Gt;const t={strategy:"hybrid",defaultTimeout:5e3,learningEnabled:!0,methods:[{name:"mdns",priority:8,timeout:3e3,retries:1,enabled:!0},{name:"scan",priority:6,timeout:5e3,retries:0,enabled:!0},{name:"manual",priority:4,timeout:2e3,retries:0,enabled:!1}]};this._queue=new Ma(t,se,this._executeDiscoveryMethod.bind(this))}_evictExpiredDevices(){const t=[];this._discoveryCache.forEach((r,a)=>{if(Re.shouldInvalidate(r)){t.push(a);const n=Re.computeAdaptiveTTL(a),i=Date.now()-r.lastSeen.getTime()>n?"ttl_expired":"changed";Re.markAsStale(a,i)}}),t.forEach(r=>this._discoveryCache.delete(r))}_evictLRUDevice(){if(this._discoveryCache.size<=this._maxCacheSize)return;let t="",r=Date.now();this._discoveryCache.forEach((a,n)=>{const o=a.lastSeen.getTime();o<r&&(r=o,t=n)}),t&&(se.recordCacheEviction(t),this._discoveryCache.delete(t))}_enforceMaxCacheSize(){for(;this._discoveryCache.size>this._maxCacheSize;)this._evictLRUDevice()}async discover(t={}){return new Promise(r=>{if(this._isDiscoveryInProgress&&this._lastDiscovery){const a={...this._lastDiscovery};return a.hasErrors=(a.errors?.length??0)>0,r(a)}this._pendingResolvers.push(r),this._debounceTimer&&clearTimeout(this._debounceTimer),this._debounceTimer=setTimeout(async()=>{const a=[...this._pendingResolvers];if(this._pendingResolvers=[],this._isDiscoveryInProgress){if(this._lastDiscovery)a.forEach(n=>n(this._lastDiscovery));else{const n={devices:[],method:"hybrid",duration:0,errors:["Discovery already in progress"],hasErrors:!0,cancelled:!0};a.forEach(o=>o(n))}return}this._isDiscoveryInProgress=!0;try{const n=performance.now(),o=se.startDiscovery("hybrid");this._evictExpiredDevices();const i=await this._queue.execute({timeout:t.timeout||5e3});i.devices.forEach(l=>{const m=this._discoveryCache.get(l.id);m&&(l.discoveryCount=m.discoveryCount+1),this._discoveryCache.set(l.id,l),Re.recordDeviceState(l)}),this._enforceMaxCacheSize(),se.updateCacheMetrics(this._discoveryCache.size,this._maxCacheSize);const u={devices:i.devices,method:i.method,duration:i.duration,errors:i.errors,hasErrors:i.hasErrors||!1,cancelled:i.cancelled};this._lastDiscovery=u,se.completeDiscovery(o,{success:!u.hasErrors,durationMs:u.duration,devicesFound:u.devices.length,error:u.errors?.[0],method:u.method}),a.forEach(l=>l(u))}catch(n){const o=n instanceof Error?n.message:String(n),i={devices:[],method:"hybrid",duration:0,errors:[o],hasErrors:!0,cancelled:!1};se.completeDiscovery(attemptId,{success:!1,durationMs:0,devicesFound:0,error:o,method:"hybrid"}),a.forEach(u=>u(i))}finally{this._isDiscoveryInProgress=!1}},this._debounceMs)})}cancel(){this._isDiscoveryInProgress=!1;const t={devices:[],method:"hybrid",duration:0,errors:["Discovery cancelled by user"],hasErrors:!0,cancelled:!0};this._pendingResolvers.forEach(r=>r(t)),this._pendingResolvers=[],this._abortController&&this._abortController.abort(),this._debounceTimer&&(clearTimeout(this._debounceTimer),this._debounceTimer=null)}isDiscoveryInProgress(){return this._isDiscoveryInProgress}getLastDiscovery(){return this._lastDiscovery}getCachedDevices(t=!0){const r=Array.from(this._discoveryCache.values());return t&&r.sort((a,n)=>n.lastSeen.getTime()-a.lastSeen.getTime()),r}clearCache(){this._discoveryCache.clear()}setDebounceDelay(t){this._debounceMs=Math.max(0,t)}setMaxCacheSize(t){this._maxCacheSize=Math.max(1,t),this._enforceMaxCacheSize()}setCacheTtl(t){this._cacheTtlMs=Math.max(6e4,t)}getCacheConfig(){return{maxSize:this._maxCacheSize,ttlMs:this._cacheTtlMs,currentSize:this._discoveryCache.size}}async _executeDiscoveryMethod(t,r){const a=performance.now();let n=null;try{switch(t){case"mdns":n=await this._discoverViaK1Client({timeout:r});break;case"scan":n=await this._discoveryService.discoverDevices({timeout:r});break;case"manual":n={devices:[],method:"manual",duration:0};break;default:throw new Error(`Unknown discovery method: ${t}`)}if(!n)throw new Error(`${t} discovery returned null`);return{devices:this._normalizeDevices(n.devices),method:t,duration:performance.now()-a,errors:n.errors,hasErrors:(n.errors?.length||0)>0,cancelled:!1}}catch(o){const i=o instanceof Error?o.message:String(o);return{devices:[],method:t,duration:performance.now()-a,errors:[i],hasErrors:!0,cancelled:!1}}}async _discoverViaK1Client(t){return{devices:await Ee.discover(t.timeout||5e3),method:"mdns",duration:t.timeout||5e3}}_normalizeDevices(t){return t.map(r=>{const a=r.mac||r.id,n=r.mac?r.id:void 0;let o=this._discoveryCache.get(a);return!o&&n&&(o=this._discoveryCache.get(n)),{id:a,alternateId:n,name:r.name,ip:r.ip,port:r.port,mac:r.mac,firmware:r.firmware,lastSeen:new Date(r.lastSeen),discoveryMethod:r.discoveryMethod,rssi:r.rssi,discoveryCount:o?.discoveryCount||1}})}getQueueConfig(){return this._queue.getConfig()}setQueueConfig(t){this._queue.setConfig(t)}getMethodStats(){return this._queue.getMethodStats()}resetMethodPriorities(){this._queue.resetPriorities()}}let Qe=null;function Jt(){return Qe||(Qe=new Ra),Qe}function Aa(s=1e3){const t=Math.max(100,s),[r,a]=c.useState({size:0,maxSize:0,ttlMs:0,devices:[],hitRate:0,totalHits:0,totalMisses:0,totalEvictions:0,loading:!0,error:null});return c.useEffect(()=>{let n;const o=()=>{try{const i=Jt(),u=i.getCacheConfig(),l=i.getCachedDevices(),m=se.getCacheMetrics();a({size:Math.max(0,u.currentSize),maxSize:Math.max(1,u.maxSize),ttlMs:Math.max(0,u.ttlMs),devices:l,hitRate:Math.max(0,Math.min(1,m.hitRate)),totalHits:Math.max(0,m.totalHits),totalMisses:Math.max(0,m.totalMisses),totalEvictions:Math.max(0,m.totalEvictions),loading:!1,error:null})}catch(i){console.error("[useCacheStats] Error updating cache stats:",i),a(u=>({...u,loading:!1,error:i instanceof Error?i.message:"Unknown error"}))}};return o(),n=setInterval(o,t),()=>{n&&clearInterval(n)}},[t]),r}function Ia(s=5e3){const t=Math.max(1e3,s),[r,a]=c.useState({config:null,methodStats:null,loading:!0,error:null});return c.useEffect(()=>{let n;const o=()=>{try{const i=Jt(),u=i.getQueueConfig(),l=i.getMethodStats();a({config:u,methodStats:l,loading:!1,error:null})}catch(i){console.error("[useDiscoveryQueueConfigLive] Error updating config:",i),a(u=>({...u,loading:!1,error:i instanceof Error?i.message:"Unknown error"}))}};return o(),n=setInterval(o,t),()=>{n&&clearInterval(n)}},[t]),r}const Pa=({refreshIntervalMs:s=1e3,className:t=""})=>{const r=_a(s),a=Aa(s),n=Ia(5e3);return r.loading||a.loading||n.loading?e.jsx("div",{className:`discovery-monitoring-dashboard ${t}`,children:e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading discovery metrics..."})]})}):r.error||a.error||n.error?e.jsx("div",{className:`discovery-monitoring-dashboard ${t}`,children:e.jsxs("div",{className:"error-state",children:[e.jsx("p",{children:"Error loading metrics:"}),e.jsxs("ul",{children:[r.error&&e.jsxs("li",{children:["Metrics: ",r.error]}),a.error&&e.jsxs("li",{children:["Cache: ",a.error]}),n.error&&e.jsxs("li",{children:["Queue: ",n.error]})]})]})}):e.jsxs("div",{className:`discovery-monitoring-dashboard ${t}`,role:"main","aria-label":"Discovery Monitoring Dashboard",children:[e.jsx(Oa,{metrics:r,cacheStats:a}),e.jsx(La,{methodMetrics:r.methodMetrics}),e.jsx(Fa,{history:r.history}),e.jsx($a,{cacheStats:a}),e.jsx(za,{config:n.config,methodStats:n.methodStats})]})},Oa=({metrics:s,cacheStats:t})=>e.jsxs("section",{className:"panel live-statistics-panel","aria-labelledby":"live-stats-heading",children:[e.jsx("h3",{id:"live-stats-heading",children:"Live Statistics"}),e.jsxs("div",{className:"stats-grid",role:"group","aria-label":"Live statistics cards",children:[e.jsxs("div",{className:"stat-card",role:"img","aria-label":`Total discoveries: ${s.aggregate.totalDiscoveries.toLocaleString()}`,children:[e.jsx("div",{className:"stat-value","aria-live":"polite","aria-atomic":"true",children:s.aggregate.totalDiscoveries.toLocaleString()}),e.jsx("div",{className:"stat-label",children:"Total Discoveries"})]}),e.jsxs("div",{className:"stat-card",role:"img","aria-label":`Devices found: ${s.aggregate.totalDevicesFound.toLocaleString()}`,children:[e.jsx("div",{className:"stat-value","aria-live":"polite","aria-atomic":"true",children:s.aggregate.totalDevicesFound.toLocaleString()}),e.jsx("div",{className:"stat-label",children:"Devices Found"})]}),e.jsxs("div",{className:"stat-card",role:"img","aria-label":`Cache size: ${t.size} of ${t.maxSize} maximum`,children:[e.jsxs("div",{className:"stat-value","aria-live":"polite","aria-atomic":"true",children:[t.size,"/",t.maxSize]}),e.jsx("div",{className:"stat-label",children:"Cache Size"}),e.jsx("div",{className:"progress-bar",role:"progressbar","aria-valuenow":t.size,"aria-valuemin":0,"aria-valuemax":t.maxSize,"aria-label":`Cache usage: ${t.size} of ${t.maxSize}`,children:e.jsx("div",{className:"progress-fill",style:{width:`${t.size/t.maxSize*100}%`}})})]}),e.jsxs("div",{className:"stat-card",role:"img","aria-label":`Cache hit rate: ${(t.hitRate*100).toFixed(1)} percent`,children:[e.jsxs("div",{className:"stat-value","aria-live":"polite","aria-atomic":"true",children:[(t.hitRate*100).toFixed(1),"%"]}),e.jsxs("div",{className:"stat-label",children:["Cache Hit Rate (",t.totalHits,"/",t.totalHits+t.totalMisses,")"]})]})]})]}),La=({methodMetrics:s})=>{const t=Array.from(s.entries()).map(([r,a])=>({method:r,successRate:(a.successRate*100).toFixed(1),avgDuration:a.avgDurationMs,attempts:a.attemptCount}));return e.jsxs("section",{className:"panel method-performance-panel","aria-labelledby":"method-performance-heading",children:[e.jsx("h3",{id:"method-performance-heading",children:"Method Performance"}),t.length>0?e.jsx("div",{role:"img","aria-label":"Bar chart showing discovery method performance by success rate",children:e.jsx(ce,{width:"100%",height:300,children:e.jsxs(it,{data:t,children:[e.jsx(re,{strokeDasharray:"3 3"}),e.jsx(ae,{dataKey:"method"}),e.jsx(ne,{}),e.jsx(ie,{formatter:(r,a)=>a==="successRate"?[`${r}%`,"Success Rate"]:a==="avgDuration"?[`${r}ms`,"Avg Duration"]:[r,a]}),e.jsx($e,{dataKey:"successRate",fill:"#4CAF50",name:"Success Rate (%)"}),e.jsx($e,{dataKey:"avgDuration",fill:"#2196F3",name:"Avg Duration (ms)"})]})})}):e.jsx("div",{className:"no-data",children:"No method performance data available"})]})},Fa=({history:s})=>{const t=s.slice(-20).map((r,a)=>({time:new Date(r.timestamp).toLocaleTimeString(),discoveries:r.totalDiscoveries,devices:r.totalDevicesFound,avgDevices:r.avgDevicesPerDiscovery}));return e.jsxs("div",{className:"panel discovery-timeline-panel",children:[e.jsx("h3",{children:"Discovery Timeline"}),t.length>0?e.jsx(ce,{width:"100%",height:300,children:e.jsxs(Ue,{data:t,children:[e.jsx(re,{strokeDasharray:"3 3"}),e.jsx(ae,{dataKey:"time"}),e.jsx(ne,{}),e.jsx(ie,{}),e.jsx(fe,{type:"monotone",dataKey:"discoveries",stroke:"#4CAF50",name:"Total Discoveries",strokeWidth:2}),e.jsx(fe,{type:"monotone",dataKey:"devices",stroke:"#2196F3",name:"Total Devices",strokeWidth:2})]})}):e.jsx("div",{className:"no-data",children:"No timeline data available"})]})},$a=({cacheStats:s})=>{const t=(s.size/s.maxSize*100).toFixed(1),r=(s.ttlMs/(1e3*60*60)).toFixed(1);return e.jsxs("div",{className:"panel cache-health-panel",children:[e.jsx("h3",{children:"Cache Health"}),e.jsxs("div",{className:"cache-metrics",children:[e.jsxs("div",{className:"metric-row",children:[e.jsx("span",{className:"metric-label",children:"Utilization:"}),e.jsxs("span",{className:"metric-value",children:[t,"% (",s.size,"/",s.maxSize,")"]})]}),e.jsxs("div",{className:"metric-row",children:[e.jsx("span",{className:"metric-label",children:"TTL:"}),e.jsxs("span",{className:"metric-value",children:[r,"h"]})]}),e.jsxs("div",{className:"metric-row",children:[e.jsx("span",{className:"metric-label",children:"Hit Rate:"}),e.jsxs("span",{className:"metric-value",children:[(s.hitRate*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"metric-row",children:[e.jsx("span",{className:"metric-label",children:"Total Hits:"}),e.jsx("span",{className:"metric-value",children:s.totalHits})]}),e.jsxs("div",{className:"metric-row",children:[e.jsx("span",{className:"metric-label",children:"Total Misses:"}),e.jsx("span",{className:"metric-value",children:s.totalMisses})]}),e.jsxs("div",{className:"metric-row",children:[e.jsx("span",{className:"metric-label",children:"Evictions:"}),e.jsx("span",{className:"metric-value",children:s.totalEvictions})]})]})]})},za=({config:s,methodStats:t})=>s?e.jsxs("div",{className:"panel queue-config-panel",children:[e.jsx("h3",{children:"Queue Configuration"}),e.jsxs("div",{className:"config-section",children:[e.jsxs("div",{className:"config-row",children:[e.jsx("span",{className:"config-label",children:"Strategy:"}),e.jsx("span",{className:"config-value strategy-{config.strategy}",children:s.strategy})]}),e.jsxs("div",{className:"config-row",children:[e.jsx("span",{className:"config-label",children:"Default Timeout:"}),e.jsxs("span",{className:"config-value",children:[s.defaultTimeout,"ms"]})]}),e.jsxs("div",{className:"config-row",children:[e.jsx("span",{className:"config-label",children:"Learning:"}),e.jsx("span",{className:"config-value",children:s.learningEnabled?"Enabled":"Disabled"})]})]}),e.jsxs("div",{className:"methods-section",children:[e.jsx("h4",{children:"Method Configuration"}),s.methods?.map(r=>e.jsxs("div",{className:`method-config ${r.enabled?"enabled":"disabled"}`,children:[e.jsxs("div",{className:"method-header",children:[e.jsx("span",{className:"method-name",children:r.name}),e.jsxs("span",{className:"method-priority",children:["Priority: ",r.priority]})]}),e.jsxs("div",{className:"method-details",children:[e.jsxs("span",{children:["Timeout: ",r.timeout,"ms"]}),e.jsxs("span",{children:["Retries: ",r.retries]}),e.jsxs("span",{children:["Status: ",r.enabled?"Enabled":"Disabled"]})]}),t?.[r.name]&&e.jsxs("div",{className:"method-stats",children:[e.jsxs("span",{children:["Success Rate: ",(t[r.name].successRate*100).toFixed(1),"%"]}),e.jsxs("span",{children:["Avg Duration: ",t[r.name].avgDuration.toFixed(0),"ms"]}),e.jsxs("span",{children:["Attempts: ",t[r.name].attemptCount]})]})]},r.name))]})]}):e.jsxs("div",{className:"panel queue-config-panel",children:[e.jsx("h3",{children:"Queue Configuration"}),e.jsx("div",{className:"no-data",children:"Configuration not available"})]});function Ua({isConnected:s,k1Client:t,initialTab:r}){const[a,n]=c.useState("performance"),o=le(),i=xe();return c.useEffect(()=>{if(!r)return;n(r==="parameters"?"history":r)},[r]),s?e.jsxs("div",{className:"flex-1 flex flex-col h-full",children:[e.jsx(F,{className:"mx-4 my-4 p-3 bg-[var(--k1-panel)] border-[var(--k1-border)]",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(z,{variant:i.recording?"destructive":"default",size:"sm",onClick:()=>{i.recording?o.stopSessionRecording():o.startSessionRecording()},className:"flex items-center gap-1",title:i.recording?"Stop Recording":"Start Recording",children:[i.recording?e.jsx(et,{className:"w-4 h-4"}):e.jsx(tt,{className:"w-4 h-4"}),i.recording?"Stop":"Record"]}),e.jsxs(z,{variant:"outline",size:"sm",onClick:()=>{const u=o.exportSessionRecording();if(u.success&&u.data){const l=JSON.stringify(u.data,null,2),m=new Blob([l],{type:"application/json"}),d=URL.createObjectURL(m),v=document.createElement("a"),f=new Date().toISOString().replace(/[:.]/g,"-");v.href=d,v.download=`k1-session-${f}.json`,v.click(),URL.revokeObjectURL(d)}else console.warn("[K1] No session to export")},disabled:i.recording,className:"flex items-center gap-1",title:"Export Session",children:[e.jsx(Te,{className:"w-4 h-4"}),"Export"]}),i.recording&&e.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-[var(--k1-error)] animate-pulse"}),e.jsx("span",{className:"text-[10px] text-[var(--k1-text-dim)]",children:"REC"})]})]}),e.jsx("div",{className:"text-[10px] text-[var(--k1-text-dim)]",children:"Recording captures realtime performance & audio metrics globally"})]})}),e.jsxs(ja,{value:a,onValueChange:n,className:"flex-1 flex flex-col",children:[e.jsxs(wa,{className:"grid w-full grid-cols-4 bg-[var(--k1-panel)] border-b border-[var(--k1-border)]",children:[e.jsxs(_e,{value:"performance",className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4"}),"Performance Monitor"]}),e.jsxs(_e,{value:"history",className:"flex items-center gap-2",children:[e.jsx(rr,{className:"w-4 h-4"}),"Parameter History"]}),e.jsxs(_e,{value:"audio",className:"flex items-center gap-2",children:[e.jsx(ar,{className:"w-4 h-4"}),"Audio Debug"]}),e.jsxs(_e,{value:"discovery",className:"flex items-center gap-2",children:[e.jsx(nr,{className:"w-4 h-4"}),"Discovery"]})]}),e.jsx(De,{value:"performance",className:"flex-1 mt-0",children:e.jsx(ka,{isConnected:s,k1Client:t})}),e.jsx(De,{value:"history",className:"flex-1 mt-0",children:e.jsx(Ea,{isConnected:s,k1Client:t})}),e.jsx(De,{value:"audio",className:"flex-1 mt-0",children:e.jsx(Ta,{isConnected:s,k1Client:t})}),e.jsx(De,{value:"discovery",className:"flex-1 mt-0",children:e.jsx(Pa,{refreshIntervalMs:1e3})})]})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs(F,{className:"p-8 text-center bg-[var(--k1-panel)] border-[var(--k1-border)]",children:[e.jsx(ke,{className:"w-12 h-12 mx-auto mb-4 text-[var(--k1-text-dim)]"}),e.jsx("h3",{className:"text-lg font-semibold text-[var(--k1-text)] mb-2",children:"Device Not Connected"}),e.jsx("p",{className:"text-[var(--k1-text-dim)]",children:"Connect to a K1 device to access debugging features"})]})})}class Ba extends c.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorId:null}}static getDerivedStateFromError(t){const r=J.fromUnknown(t),a=`err_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return G.recordError(r,{errorId:a,boundary:!0}),{hasError:!0,error:r,errorId:a}}componentDidCatch(t,r){console.error("ErrorBoundary caught error:",t,r),this.state.error&&this.props.onError&&this.props.onError(this.state.error,r)}render(){if(this.state.hasError&&this.state.error){const t=this.props.fallback||Ha;return e.jsx(t,{error:this.state.error,retry:()=>{this.setState({hasError:!1,error:null,errorId:null})}})}return this.props.children}}function Ha({error:s,retry:t}){const r=a=>{switch(a){case H.CONNECTION_FAILED:case H.CONNECTION_TIMEOUT:return"ðŸ”Œ";case H.DEVICE_NOT_FOUND:return"ðŸ“¡";case H.PERMISSION_DENIED:return"ðŸ”’";case H.NETWORK_ERROR:return"ðŸŒ";case H.WEBSOCKET_ERROR:return"âš¡";default:return"âš ï¸"}};return e.jsx("div",{className:"min-h-[400px] flex items-center justify-center p-8",children:e.jsxs("div",{className:"max-w-md text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:r(s.code)}),e.jsx("h2",{className:"text-xl font-semibold text-[var(--k1-text)] mb-2",children:"Something went wrong"}),e.jsx("p",{className:"text-[var(--k1-text-dim)] mb-6",children:s.userMessage}),e.jsxs("div",{className:"space-y-3",children:[s.recoverable&&e.jsx("button",{onClick:t,className:"w-full px-4 py-2 bg-[var(--k1-primary)] text-white rounded-md hover:bg-[var(--k1-primary-hover)] transition-colors",children:"Try Again"}),e.jsxs("details",{className:"text-left",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-[var(--k1-text-dim)] hover:text-[var(--k1-text)]",children:"Technical Details"}),e.jsx("pre",{className:"mt-2 p-3 bg-[var(--k1-bg)] rounded text-xs overflow-auto border border-[var(--k1-border)] font-mono",children:JSON.stringify({code:s.code,message:s.message,context:s.context},null,2)})]})]})]})})}function Va({error:s,onDismiss:t,onRetry:r}){const[a,n]=c.useState(!0);c.useEffect(()=>{if(s.recoverable){const u=setTimeout(()=>{n(!1),setTimeout(t,300)},5e3);return()=>clearTimeout(u)}},[s.recoverable,t]);const o=u=>{switch(u){case H.CONNECTION_FAILED:case H.CONNECTION_TIMEOUT:return"ðŸ”Œ";case H.DEVICE_NOT_FOUND:return"ðŸ“¡";case H.PERMISSION_DENIED:return"ðŸ”’";case H.NETWORK_ERROR:return"ðŸŒ";case H.WEBSOCKET_ERROR:return"âš¡";case H.DISCOVERY_FAILED:return"ðŸ”";default:return"âš ï¸"}},i=u=>{switch(u){case H.CONNECTION_FAILED:case H.DEVICE_NOT_FOUND:return"border-red-500 bg-red-50";case H.CONNECTION_TIMEOUT:case H.NETWORK_ERROR:return"border-yellow-500 bg-yellow-50";case H.WEBSOCKET_ERROR:return"border-blue-500 bg-blue-50";default:return"border-red-500 bg-red-50"}};return e.jsx("div",{className:`fixed top-4 right-4 max-w-sm border-l-4 rounded-lg shadow-lg transition-all duration-300 z-50 ${i(s.code)} ${a?"translate-x-0 opacity-100":"translate-x-full opacity-0"}`,children:e.jsx("div",{className:"p-4 bg-white",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"text-2xl mr-3",children:o(s.code)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Error"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.userMessage}),s.recoverable&&r&&e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx("button",{onClick:r,className:"px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700 transition-colors",children:"Retry"}),e.jsx("button",{onClick:t,className:"px-3 py-1 bg-gray-200 text-gray-700 text-sm rounded hover:bg-gray-300 transition-colors",children:"Dismiss"})]})]}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 ml-2",children:"âœ•"})]})})})}function Ka({children:s}){const[t,r]=c.useState([]),a=c.useCallback((l,m)=>{const d=J.fromUnknown(l,m);G&&typeof G.recordError=="function"&&G.recordError(d,m),r(v=>v.some(C=>C.code===d.code&&C.message===d.message)?v:[...v,d])},[]),n=c.useCallback(()=>{r([])},[]),o=c.useCallback(l=>{r(m=>m.filter((d,v)=>v!==l))},[]),i=c.useCallback(l=>{const m=t[l];m&&m.recoverable&&(o(l),m.context?.retryCallback&&m.context.retryCallback())},[t,o]),u={showError:a,clearErrors:n,errors:t};return e.jsxs(Ft.Provider,{value:u,children:[s,e.jsx("div",{className:"fixed top-4 right-4 space-y-2 z-50",children:t.map((l,m)=>e.jsx(Va,{error:l,onDismiss:()=>o(m),onRetry:l.recoverable?()=>i(m):void 0},`${l.code}-${m}`))})]})}function Wa({...s}){return e.jsx(cr,{"data-slot":"dialog",...s})}function qa({...s}){return e.jsx(or,{"data-slot":"dialog-portal",...s})}const Qt=c.forwardRef(({className:s,...t},r)=>e.jsx(Dt,{ref:r,"data-slot":"dialog-overlay",className:O("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",s),...t}));Qt.displayName=Dt.displayName;const Xt=c.forwardRef(({className:s,children:t,...r},a)=>e.jsxs(qa,{"data-slot":"dialog-portal",children:[e.jsx(Qt,{}),e.jsxs(Mt,{ref:a,"data-slot":"dialog-content",className:O("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",s),...r,children:[t,e.jsxs(ir,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[e.jsx(Rt,{}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Xt.displayName=Mt.displayName;function Ga({className:s,...t}){return e.jsx("div",{"data-slot":"dialog-header",className:O("flex flex-col gap-2 text-center sm:text-left",s),...t})}function Ya({className:s,...t}){return e.jsx(lr,{"data-slot":"dialog-title",className:O("text-lg leading-none font-semibold",s),...t})}function Ja({className:s,...t}){return e.jsx(dr,{"data-slot":"dialog-description",className:O("text-muted-foreground text-sm",s),...t})}function Qa(){const[s,t]=c.useState({isAutoDiscovering:!1,discoveredDevices:[],lastDiscovery:null,autoConnectSuggestion:null}),r=Yt(),{showError:a}=$t();c.useEffect(()=>{n()},[]);const n=async()=>{t(u=>({...u,isAutoDiscovering:!0}));try{console.log("[AutoDiscovery] Starting automatic device discovery...");const u=await r.discoverDevices({timeout:3e3,preferredMethods:["mdns","scan"]});console.log(`[AutoDiscovery] Found ${u.devices.length} devices`),t(m=>({...m,discoveredDevices:u.devices,lastDiscovery:new Date}));const l=Xa();if(l&&u.devices.length>0){const m=u.devices.find(d=>d.ip===l.ip||d.mac===l.mac);m&&(t(d=>({...d,autoConnectSuggestion:m})),console.log("[AutoDiscovery] Found previously connected device:",m.name))}}catch(u){console.warn("[AutoDiscovery] Auto-discovery failed:",u),a(u,{context:"auto-discovery"})}finally{t(u=>({...u,isAutoDiscovering:!1}))}};return{...s,refreshDiscovery:()=>{n()},dismissAutoConnectSuggestion:()=>{t(u=>({...u,autoConnectSuggestion:null}))}}}function Xa(){try{const s=localStorage.getItem("k1.lastConnectedDevice");return s?JSON.parse(s):null}catch{return null}}function Za(s){try{localStorage.setItem("k1.lastConnectedDevice",JSON.stringify({ip:s.ip,mac:s.mac,name:s.name}))}catch(t){console.warn("Failed to save last connected device:",t)}}function en({isOpen:s,isConnected:t,onDiscoveryComplete:r,onClose:a}){const n=Yt(),o=Qa(),u=xe().connection==="connected",[l,m]=c.useState([]),[d,v]=c.useState(!1),[f,C]=c.useState(null),[h,j]=c.useState(!1),[p,N]=c.useState("192.168.1.103"),[x,k]=c.useState("80"),[E,D]=c.useState(!1),[b,w]=c.useState(null),[S,I]=c.useState(null),[g,A]=c.useState(!1);c.useEffect(()=>{if(u&&g){const y=setTimeout(()=>{a?.()},1500);return()=>clearTimeout(y)}},[u,g,a]),c.useEffect(()=>{s&&!u&&P()},[s,u]);const P=async()=>{v(!0),w(null),I(null);try{console.log("[DeviceDiscoveryModal] Starting auto-discovery...");const y=await n.discoverDevices({timeout:3e3,preferredMethods:["mdns","scan"]});if(console.log(`[DeviceDiscoveryModal] Found ${y.devices.length} devices`),m(y.devices),y.devices.length>0&&C(y.devices[0]),y.devices.length>0&&o.autoConnectSuggestion){const M=y.devices.find(L=>L.ip===o.autoConnectSuggestion?.ip||L.mac===o.autoConnectSuggestion?.mac);M&&(console.log("[DeviceDiscoveryModal] Found previously connected device:",M.name),C(M))}}catch(y){console.error("[DeviceDiscoveryModal] Discovery failed:",y),w(y instanceof Error?y.message:"Failed to discover devices. Try manual entry.")}finally{v(!1)}},_=async y=>{j(!0),I(null),A(!1);try{console.log("[DeviceDiscoveryModal] Connecting to device:",y.name),Za(y),await r(y),console.log("[DeviceDiscoveryModal] Successfully connected to device"),A(!0)}catch(M){console.error("[DeviceDiscoveryModal] Connection failed:",M),I(M instanceof Error?M.message:"Failed to connect to device. Check network and device availability.")}finally{j(!1)}},R=async y=>{if(y.preventDefault(),!p.trim()){I("Please enter a device IP address");return}const M=parseInt(x)||80,L=n.addManualDevice(p.trim(),M);await _(L)},Q=()=>{m([]),C(null),D(!1),I(null),P()},T=()=>{h||a?.()};return e.jsx(Wa,{open:s&&!u,onOpenChange:T,children:e.jsxs(Xt,{className:"max-w-2xl bg-[var(--k1-panel)] border-[var(--k1-border)]",children:[e.jsxs(Ga,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Ya,{className:"text-[var(--k1-text)] flex items-center gap-2",children:[e.jsx(Ae,{className:"w-5 h-5 text-[var(--k1-accent)]"}),"Connect to K1 Device"]}),!h&&e.jsx(z,{variant:"ghost",size:"sm",onClick:T,className:"h-6 w-6 p-0 text-[var(--k1-text-dim)] hover:text-[var(--k1-text)]",children:e.jsx(Rt,{className:"h-4 w-4"})})]}),e.jsx(Ja,{className:"text-[var(--k1-text-dim)]",children:g?"âœ… Successfully connected! This dialog will close automatically.":d?"Searching for K1 devices on your network...":l.length>0?"Select a device to connect or enter IP manually":"No devices found. Enter your device IP address below."})]}),e.jsxs("div",{className:"space-y-4",children:[g&&e.jsxs(F,{className:"p-6 text-center bg-green-900/20 border-green-600/30",children:[e.jsx(we,{className:"w-8 h-8 mx-auto text-green-400 mb-3"}),e.jsx("p",{className:"text-green-300 font-medium",children:"Connection Successful!"}),e.jsx("p",{className:"text-sm text-green-200 mt-1",children:"You're now connected to your K1 device"})]}),d&&!g&&e.jsxs(F,{className:"p-6 text-center bg-[var(--k1-bg)] border-[var(--k1-border)]",children:[e.jsx(ye,{className:"w-8 h-8 animate-spin mx-auto text-[var(--k1-accent)] mb-3"}),e.jsx("p",{className:"text-[var(--k1-text-dim)]",children:"Discovering devices (mDNS + network scan)..."}),e.jsx("p",{className:"text-xs text-[var(--k1-text-dim)] mt-2",children:"This may take a few seconds"})]}),b&&!g&&e.jsx(F,{className:"p-4 bg-red-900/20 border-red-600/30",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(ke,{className:"w-5 h-5 text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-300",children:b}),e.jsx("p",{className:"text-sm text-red-200 mt-1",children:"Enter your device IP below to continue"})]})]})}),S&&!g&&e.jsx(F,{className:"p-4 bg-red-900/20 border-red-600/30",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(ke,{className:"w-5 h-5 text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-300",children:"Connection Failed"}),e.jsx("p",{className:"text-sm text-red-200 mt-1",children:S}),e.jsx("p",{className:"text-xs text-red-200 mt-2",children:"ðŸ’¡ Make sure your K1 device is powered on and on the same network"})]})]})}),!d&&l.length>0&&!E&&!g&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(V,{className:"text-[var(--k1-text-dim)]",children:["Available Devices (",l.length," found)"]}),e.jsx("div",{className:"space-y-2 max-h-[200px] overflow-y-auto",children:l.map(y=>e.jsx("button",{onClick:()=>C(y),disabled:h,className:`w-full p-3 rounded-lg border-2 transition-colors text-left disabled:opacity-50 ${f?.id===y.id?"bg-[var(--k1-accent)]/20 border-[var(--k1-accent)]":"bg-[var(--k1-bg)] border-[var(--k1-border)] hover:border-[var(--k1-accent)]"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-[var(--k1-text)]",children:y.name}),e.jsxs("p",{className:"text-sm text-[var(--k1-text-dim)]",children:[y.ip,":",y.port]}),o.autoConnectSuggestion&&(y.ip===o.autoConnectSuggestion.ip||y.mac===o.autoConnectSuggestion.mac)&&e.jsx("p",{className:"text-xs text-[var(--k1-accent)] mt-1",children:"â­ Previously connected"})]}),f?.id===y.id&&e.jsx(we,{className:"w-5 h-5 text-[var(--k1-accent)]"})]})},y.id))})]}),!d&&l.length>0&&!E&&!g&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{variant:"outline",size:"sm",onClick:()=>D(!0),disabled:h,className:"flex-1",children:"Enter IP Manually"}),e.jsxs(z,{variant:"outline",size:"sm",onClick:Q,disabled:h,className:"flex-1",children:[e.jsx(wt,{className:"w-4 h-4 mr-2"}),"Retry Discovery"]})]}),(E||l.length===0&&!d)&&!g&&e.jsxs("form",{onSubmit:R,className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(V,{htmlFor:"manual-ip",className:"text-[var(--k1-text-dim)]",children:"Device IP Address or Hostname"}),e.jsx(Ne,{id:"manual-ip",type:"text",placeholder:"k1-reinvented.local or 192.168.1.103",value:p,onChange:y=>N(y.target.value),disabled:h,className:"mt-1.5"}),e.jsx("p",{className:"text-xs text-[var(--k1-text-dim)] mt-1",children:'ðŸ’¡ Try "k1-reinvented.local" first, or check your router for the device IP'})]}),e.jsxs("div",{children:[e.jsx(V,{htmlFor:"manual-port",className:"text-[var(--k1-text-dim)]",children:"Port (optional)"}),e.jsx(Ne,{id:"manual-port",type:"text",placeholder:"80",value:x,onChange:y=>k(y.target.value),disabled:h,className:"mt-1.5"})]}),e.jsx(z,{type:"submit",disabled:h||!p.trim(),className:"w-full",size:"lg",children:h?e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"w-4 h-4 mr-2 animate-spin"}),"Connecting to ",p,"..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Connect to Device"]})}),E&&l.length>0&&e.jsx(z,{type:"button",variant:"outline",onClick:()=>D(!1),disabled:h,className:"w-full",children:"â† Back to Discovered Devices"})]}),f&&!E&&l.length>0&&!g&&e.jsx(z,{onClick:()=>_(f),disabled:h,className:"w-full",size:"lg",children:h?e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"w-4 h-4 mr-2 animate-spin"}),"Connecting to ",f.name,"..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Connect to ",f.name]})}),e.jsx("div",{className:"rounded-lg bg-blue-900/20 border border-blue-600/30 p-3",children:e.jsxs("p",{className:"text-sm text-blue-300",children:["ðŸ’¡ ",e.jsx("strong",{children:"Tip:"})," Make sure your K1 device is powered on and connected to the same WiFi network."]})})]})]})})}const tn=({...s})=>{const{theme:t="system"}=fr();return e.jsx(vr,{theme:t,className:"toaster group",style:{"--normal-bg":"var(--popover)","--normal-text":"var(--popover-foreground)","--normal-border":"var(--border)"},...s})};function Zt(s){const t=$.RECONNECT.BASE_DELAY,r=$.RECONNECT.MAX_DELAY,a=$.RECONNECT.JITTER_PERCENT,n=Math.min(t*Math.pow(2,s),r),o=n*(a/100),i=(Math.random()*2-1)*o,u=Math.max(0,n+i);return Math.round(u)}function sn(){console.log("ðŸ§ª Testing Exponential Backoff Sequence (Subtask 2.4)"),console.log("Expected sequence: 500ms â†’ 1s â†’ 2s â†’ 4s â†’ 8s â†’ 16s â†’ 30s (capped)"),console.log("");const s=[500,1e3,2e3,4e3,8e3,16e3,3e4,3e4,3e4],t=.2;for(let r=1;r<=9;r++){const a=s[r-1],n=a*(1-t),o=a*(1+t),i=[];for(let f=0;f<10;f++)i.push(Zt(r));const u=i.reduce((f,C)=>f+C,0)/i.length,l=Math.min(...i),m=Math.max(...i),v=l>=n&&m<=o?"âœ…":"âŒ";console.log(`${v} Attempt ${r}: Expected ${a}ms (Â±20%), Got ${u.toFixed(0)}ms avg, Range: ${l}-${m}ms`)}console.log(""),console.log("âœ… Backoff sequence test completed")}function rn(){console.log("ðŸ§ª Testing Jitter Distribution");const s=3,t=[];for(let l=0;l<1e3;l++)t.push(Zt(s));const r=2e3,a=r*.8,n=r*1.2,o=t.filter(l=>l>=a&&l<=n),i=o.length/t.length*100;console.log(`Expected range: ${a}-${n}ms`),console.log(`Samples within range: ${o.length}/1000 (${i.toFixed(1)}%)`),console.log(`Min sample: ${Math.min(...t)}ms`),console.log(`Max sample: ${Math.max(...t)}ms`),console.log(`Average: ${(t.reduce((l,m)=>l+m,0)/t.length).toFixed(0)}ms`);const u=i>95;return console.log(u?"âœ… Jitter distribution test passed":"âŒ Jitter distribution test failed"),u}typeof window<"u"&&window.runBackoffTests&&(sn(),rn());function an(){console.log("ðŸš€ Testing Transport Routing (Subtask 2.5)"),console.log("");const s=window.k1Actions;if(!s){console.error("âŒ k1Actions not available. Make sure the app is running and K1StatusTest is mounted.");return}console.log("ðŸ“Š Current Transport Status:");const t=s.getTransportStatus();console.log(`  - WebSocket Available: ${t.wsAvailable?"âœ…":"âŒ"}`),console.log(`  - WebSocket Enabled: ${t.wsEnabled?"âœ…":"âŒ"}`),console.log(`  - REST Available: ${t.restAvailable?"âœ…":"âŒ"}`),console.log(`  - Active Transport: ${t.activeTransport.toUpperCase()}`),t.lastWSError&&console.log(`  - Last WS Error: ${t.lastWSError.message}`),console.log(""),console.log("ðŸ§ª Test Scenarios:"),console.log(""),console.log("1. Test with current transport settings:"),console.log("   k1Actions.testTransportRouting()"),console.log(""),console.log("2. Disable WebSocket and test REST-only:"),console.log("   k1Actions.setWebSocketEnabled(false)"),console.log("   k1Actions.testTransportRouting()"),console.log(""),console.log("3. Re-enable WebSocket:"),console.log("   k1Actions.setWebSocketEnabled(true)"),console.log("   k1Actions.testTransportRouting()"),console.log(""),console.log("4. Check transport status after changes:"),console.log("   k1Actions.getTransportStatus()"),console.log(""),console.log("ðŸ’¡ Expected Behavior:"),console.log("  - When WebSocket is available and enabled: Commands sent via WS + REST"),console.log("  - When WebSocket is disabled: Commands sent via REST only"),console.log("  - When WebSocket fails: Automatic fallback to REST"),console.log("  - Transport status updates reflect current availability"),console.log(""),console.log("âœ… Transport routing test setup complete"),console.log("Run the commands above to test different scenarios")}async function nn(){console.log("ðŸ¤– Running Automated Transport Tests"),console.log("");const s=window.k1Actions;if(!s){console.error("âŒ k1Actions not available");return}try{console.log("Test 1: Testing current transport state...");const t=s.getTransportStatus();console.log(`Initial transport: ${t.activeTransport}`),await s.testTransportRouting(),console.log("âœ… Test 1 passed"),console.log(""),console.log("Test 2: Testing with WebSocket disabled..."),s.setWebSocketEnabled(!1);const r=s.getTransportStatus();console.log(`Transport after disable: ${r.activeTransport}`),await s.testTransportRouting(),console.log("âœ… Test 2 passed"),console.log(""),console.log("Test 3: Testing with WebSocket re-enabled..."),s.setWebSocketEnabled(!0);const a=s.getTransportStatus();console.log(`Transport after enable: ${a.activeTransport}`),await s.testTransportRouting(),console.log("âœ… Test 3 passed"),console.log(""),console.log("ðŸŽ‰ All transport routing tests passed!")}catch(t){console.error("âŒ Transport test failed:",t)}}typeof window<"u"&&(window.testTransportRouting=an,window.runTransportTests=nn);function on(){console.log("ðŸ“Š Testing Enhanced Telemetry & Error Surfaces (Subtask 2.7)"),console.log("");const s=window.k1Actions;if(!s){console.error("âŒ k1Actions not available. Make sure the app is running and K1StatusTest is mounted.");return}console.log("ðŸ“ˆ Current Telemetry State:");const t=s.getTelemetryState();console.log(`  - Connection Attempts: ${t.connectionAttempts}`),console.log(`  - Successful Connections: ${t.successfulConnections}`),console.log(`  - Total Errors: ${Object.values(t.errorCounts).reduce((a,n)=>a+n,0)}`),console.log(`  - Average Latency: ${Math.round(t.averageLatency)}ms`),console.log(`  - Session Uptime: ${Math.round((Date.now()-t.sessionStartTime)/1e3)}s`),console.log(""),console.log("ðŸŽ›ï¸ Error Surface Configuration:");const r=s.getErrorSurfaceConfig();console.log(`  - Show Toasts: ${r.showToasts}`),console.log(`  - Log to Console: ${r.logToConsole}`),console.log(`  - Report to Telemetry: ${r.reportToTelemetry}`),console.log(`  - Max Error History: ${r.maxErrorHistory}`),console.log(`  - Error Display Duration: ${r.errorDisplayDuration}ms`),console.log(""),console.log("ðŸ§ª Test Commands:"),console.log(""),console.log("1. View detailed telemetry: k1Actions.getTelemetryState()"),console.log("2. Test error toast: testErrorToast()"),console.log("3. Test telemetry hook: testTelemetryHook()"),console.log("4. Configure error surfaces: testErrorSurfaceConfig()"),console.log("5. Reset telemetry: k1Actions.resetTelemetry()"),console.log("6. Run comprehensive tests: runTelemetryTests()"),console.log(""),console.log("ðŸ’¡ Expected Features:"),console.log("  - Categorized error tracking by type"),console.log("  - Toast notifications for errors"),console.log("  - Telemetry hooks for external integrations"),console.log("  - Performance metrics with latency tracking"),console.log("  - Feature usage analytics"),console.log("  - Configurable error surfaces"),console.log(""),console.log("âœ… Telemetry system test setup complete")}function cn(){console.log("ðŸž Testing Error Toast Notification"),console.log("");try{const s={type:"rest_error",message:"This is a test error notification",details:"Testing the toast notification system",timestamp:new Date};console.log("1. Triggering test error toast..."),K.handleError(s,{test:!0}),console.log("âœ… Test error toast triggered"),console.log("ðŸ’¡ You should see a red toast notification in the top-right corner"),console.log("ðŸ’¡ Click the toast to dismiss it manually")}catch(s){console.error("âŒ Error toast test failed:",s)}console.log(""),console.log("âœ… Error toast test completed")}function ln(){console.log("ðŸ”— Testing Telemetry Hook Integration"),console.log("");try{const s=window.k1Actions;if(!s){console.log("âŒ k1Actions not available");return}console.log("1. Registering test telemetry hook...");const t={onEvent:n=>{console.log(`[TestHook] Event: ${n.type}:${n.category}:${n.action}`,n)},onError:(n,o)=>{console.log(`[TestHook] Error: ${n.type} - ${n.message}`,{error:n,context:o})},onMetric:(n,o,i)=>{console.log(`[TestHook] Metric: ${n} = ${o}`,i)}},r=s.registerTelemetryHook(t);console.log("âœ… Test hook registered"),console.log(""),console.log("2. Testing hook with sample events..."),K.recordEvent({type:"feature_usage",category:"test",action:"hook_test",label:"Testing telemetry hook",timestamp:Date.now()}),K.recordMetric("test_metric",42,{source:"test"});const a={type:"validation_error",message:"Test error for hook validation",timestamp:new Date};K.handleError(a,{hookTest:!0}),console.log("âœ… Sample events sent to hook"),console.log(""),console.log("3. Unregistering test hook..."),r(),console.log("âœ… Test hook unregistered")}catch(s){console.error("âŒ Telemetry hook test failed:",s)}console.log(""),console.log("âœ… Telemetry hook test completed")}function dn(){console.log("âš™ï¸ Testing Error Surface Configuration"),console.log("");try{const s=window.k1Actions;if(!s){console.log("âŒ k1Actions not available");return}console.log("1. Getting current configuration...");const t=s.getErrorSurfaceConfig();console.log("Current config:",t),console.log(""),console.log("2. Testing configuration changes..."),s.setErrorSurfaceConfig({showToasts:!1}),console.log("âœ… Disabled toast notifications");const r={type:"network_error",message:"Test error with toasts disabled",timestamp:new Date};K.handleError(r),console.log("ðŸ’¡ Error triggered with toasts disabled (no toast should appear)"),console.log(""),s.setErrorSurfaceConfig({showToasts:!0}),console.log("âœ… Re-enabled toast notifications");const a={type:"connect_error",message:"Test error with toasts enabled",timestamp:new Date};K.handleError(a),console.log("ðŸ’¡ Error triggered with toasts enabled (toast should appear)"),console.log(""),console.log("3. Testing custom display duration..."),s.setErrorSurfaceConfig({errorDisplayDuration:2e3});const n={type:"timeout_error",message:"Test error with short duration",timestamp:new Date};K.handleError(n),console.log("ðŸ’¡ Error with 2-second duration triggered"),setTimeout(()=>{s.setErrorSurfaceConfig(t),console.log("âœ… Restored original configuration")},3e3)}catch(s){console.error("âŒ Error surface config test failed:",s)}console.log(""),console.log("âœ… Error surface configuration test completed")}async function un(){console.log("ðŸ¤– Running Comprehensive Telemetry Tests"),console.log("");try{const s=window.k1Actions;if(!s){console.log("âŒ k1Actions not available");return}console.log("Test 1: Telemetry state access...");const t=s.getTelemetryState();console.log(`Session uptime: ${Math.round((Date.now()-t.sessionStartTime)/1e3)}s`),console.log("âœ… Test 1 passed"),console.log(""),console.log("Test 2: Error surface configuration...");const r=s.getErrorSurfaceConfig();s.setErrorSurfaceConfig({maxErrorHistory:5});const a=s.getErrorSurfaceConfig();console.log(`Max error history updated: ${r.maxErrorHistory} â†’ ${a.maxErrorHistory}`),s.setErrorSurfaceConfig(r),console.log("âœ… Test 2 passed"),console.log(""),console.log("Test 3: Hook registration and events...");let n=0;const o={onEvent:()=>n++,onError:()=>n++,onMetric:()=>n++},i=s.registerTelemetryHook(o);K.recordEvent({type:"performance",category:"test",action:"comprehensive_test",timestamp:Date.now()}),K.recordMetric("test_comprehensive",100),await new Promise(h=>setTimeout(h,100)),console.log(`Hook received ${n} events`),i(),console.log("âœ… Test 3 passed"),console.log(""),console.log("Test 4: Error categorization...");const u={...t.errorCounts},l={type:"ws_send_error",message:"Comprehensive test error",timestamp:new Date};K.handleError(l);const d=s.getTelemetryState().errorCounts.ws_send_error>u.ws_send_error;console.log(`WebSocket error count increased: ${d}`),console.log("âœ… Test 4 passed"),console.log(""),console.log("Test 5: Telemetry reset...");const v=s.getTelemetryState();s.resetTelemetry();const C=s.getTelemetryState().sessionStartTime>v.sessionStartTime;console.log(`Telemetry was reset: ${C}`),console.log("âœ… Test 5 passed"),console.log(""),console.log("ðŸŽ‰ All telemetry tests completed successfully!")}catch(s){console.error("âŒ Comprehensive telemetry tests failed:",s)}}typeof window<"u"&&(window.testTelemetry=on,window.testErrorToast=cn,window.testTelemetryHook=ln,window.testErrorSurfaceConfig=dn,window.runTelemetryTests=un);const ft={ENTER:"Enter",SPACE:" "};function vt(s){return s.key===ft.ENTER||s.key===ft.SPACE}function mn({k1Client:s,isConnected:t,onClose:r}){const[a,n]=c.useState(null),[o,i]=c.useState(null),[u,l]=c.useState(()=>{try{const y=typeof localStorage<"u"?localStorage.getItem("k1.debugHUDVisible"):null;if(y===null)return!0;const M=y.toLowerCase();return M==="1"||M==="true"}catch{return!0}}),[m,d]=c.useState(gt()),[v,f]=c.useState(()=>{try{const y=typeof localStorage<"u"?localStorage.getItem("k1.hmrOverlay"):null;return y==="1"||y==="true"}catch{return!0}}),[C,h]=c.useState(null),j=c.useMemo(()=>t&&!!s,[t,s]),p=le(),N=()=>{const y=55+Math.random()*5,M=1e3/y+Math.random()*2,L=20+Math.random()*30;return{fps:y,frameTimeMs:M,cpuPercent:L}},x=()=>{const y=Math.round(Math.random()*100)/100,M=Math.round(Math.random()*100)/100,L=Math.round(60+Math.random()*80);return{rms:y,beatConfidence:M,bpm:L}},k=ze({subscribe:j?y=>p.subscribePerformance(M=>{y({fps:M.fps,frameTimeMs:M.frame_time_us/1e3,cpuPercent:M.cpu_percent})}):void 0,onData:y=>n(y),fallbackTick:N,intervalMs:800,autoStart:!0,metricType:"performance"}),E=ze({subscribe:j?y=>p.subscribeAudio(M=>{const L=typeof M?.bpm=="number"?M.bpm:M?.tempo_confidence?Math.round(M.tempo_confidence*120):0;y({bpm:L,beatConfidence:M?.beat_confidence??M?.tempo_confidence??0,rms:M?.vu_level??M?.rms??0})}):void 0,onData:y=>i(y),fallbackTick:x,intervalMs:500,autoStart:!0,metricType:"audio"});if(!u)return null;const b=a&&a.fps<60,w=a&&a.frameTimeMs>20,{transport:S}=xe(),[I,g]=c.useState(null),[A,P]=c.useState(null),_=S.activeTransport==="ws"&&S.wsAvailable?80:140;c.useEffect(()=>{const y=setInterval(()=>{g(s?.getReconnectInfo?s.getReconnectInfo():null),P(s?.getRateLimiterInfo?s.getRateLimiterInfo():null)},500);return()=>clearInterval(y)},[s,S]),c.useEffect(()=>{const y=M=>{try{const L=M,B=L.detail?.preferredTransport==="ws"||L.detail?.preferredTransport==="rest"?L.detail.preferredTransport:void 0;B&&h({preferredTransport:B,wsEnabled:!!L.detail?.wsEnabled,ts:Date.now()})}catch{}};return window.addEventListener("k1:transportChange",y),()=>{window.removeEventListener("k1:transportChange",y)}},[]),c.useEffect(()=>{const y=B=>{try{const q=B;typeof q.detail?.enabled=="boolean"&&f(!!q.detail.enabled)}catch{}},M=B=>{try{B.key==="k1.hmrOverlay"&&f(B.newValue==="1"||B.newValue==="true"),B.key==="k1.debugAborts"&&d(B.newValue==="1"||B.newValue==="true"),B.key==="k1.debugHUDVisible"&&l(B.newValue==="1"||B.newValue==="true")}catch{}},L=B=>{try{const q=B;q.detail?.key==="k1.debugAborts"&&d(q.detail.newValue==="1"||q.detail.newValue==="true"),q.detail?.key==="k1.debugHUDVisible"&&l(q.detail.newValue==="1"||q.detail.newValue==="true")}catch{}};return window.addEventListener("k1:hmrOverlayChange",y),window.addEventListener("storage",M),window.addEventListener("k1:storageChange",L),()=>{window.removeEventListener("k1:hmrOverlayChange",y),window.removeEventListener("storage",M),window.removeEventListener("k1:storageChange",L)}},[]);const R=()=>{const y=S.activeTransport==="ws"&&S.wsAvailable;p.setWebSocketEnabled(!y)},Q=()=>{const y=!gt();Wt(y),d(y)},T=()=>{try{const y=localStorage.getItem("k1.hmrOverlay"),M=y==="1"||y==="true"?"0":"1";localStorage.setItem("k1.hmrOverlay",M),f(M==="1"),We("k1.hmrOverlay",M,y)}catch{f(!0),We("k1.hmrOverlay","1",null)}};return e.jsx("div",{className:"fixed top-4 right-4 z-50",children:e.jsxs("div",{className:"rounded-lg shadow-lg border border-gray-700 bg-black/80 backdrop-blur-sm text-white w-72",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-gray-700",children:[e.jsx("span",{className:"text-sm font-semibold",children:"Debug HUD"}),e.jsxs("div",{className:"flex items-center gap-2",children:[!j&&e.jsx("span",{className:"text-[11px] text-yellow-300",children:"Disconnected"}),e.jsxs("span",{className:"text-[11px] text-gray-300",children:["Perf: ",e.jsx("span",{className:k.live?"text-green-300":"text-yellow-300",children:k.live?"LIVE":"SIM"})]}),e.jsxs("span",{className:"text-[11px] text-gray-300",children:["Audio: ",e.jsx("span",{className:E.live?"text-green-300":"text-yellow-300",children:E.live?"LIVE":"SIM"})]}),e.jsx("button",{className:"text-gray-300 hover:text-white text-xs",onClick:()=>{try{const y=typeof localStorage<"u"?localStorage.getItem("k1.debugHUDVisible"):null;localStorage.setItem("k1.debugHUDVisible","0"),We("k1.debugHUDVisible","0",y)}catch{}l(!1),r?.()},"aria-label":"Close HUD",children:"âœ•"})]})]}),e.jsxs("div",{className:"px-3 py-2 text-xs",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-300",children:"FPS"}),e.jsx("div",{className:`text-sm font-mono ${b?"text-red-400":"text-green-300"}`,children:a?.fps??"â€”"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-300",children:"Frame Time"}),e.jsx("div",{className:`text-sm font-mono ${w?"text-red-400":"text-green-300"}`,children:a?`${a.frameTimeMs.toFixed(1)} ms`:"â€”"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-300",children:"CPU"}),e.jsx("div",{className:"text-sm font-mono",children:a?`${a.cpuPercent.toFixed(0)}%`:"â€”"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-300",children:"BPM"}),e.jsx("div",{className:"text-sm font-mono",children:o?.bpm?`${o.bpm.toFixed(0)} (${Math.round((o?.beatConfidence??0)*100)}%)`:"â€”"})]})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[b&&e.jsx("span",{className:"px-2 py-0.5 rounded bg-red-600/30 text-red-300",children:"Under target 60 FPS"}),w&&e.jsxs("span",{className:"px-2 py-0.5 rounded bg-orange-600/30 text-orange-300",children:["Frame ",">"," 20 ms"]})]})]}),e.jsxs("div",{className:"px-3 py-2 border-t border-gray-700 text-xs",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-300 font-medium",children:"Transport & Timing"}),e.jsx("button",{onClick:R,className:`px-2 py-1 rounded text-[10px] font-medium transition-colors ${S.activeTransport==="ws"&&S.wsAvailable?"bg-green-600/30 text-green-300 hover:bg-green-600/40":"bg-orange-600/30 text-orange-300 hover:bg-orange-600/40"}`,title:"Toggle between WebSocket and REST transport",children:S.activeTransport==="ws"&&S.wsAvailable?"WS":"REST"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-300",children:"Active Transport"}),e.jsx("div",{className:"text-sm font-mono",children:S.activeTransport})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-300",children:"WS Available"}),e.jsx("div",{className:"text-sm font-mono",children:S.wsAvailable?"Yes":"No"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-300",children:"Next Reconnect"}),e.jsx("div",{className:"text-sm font-mono",children:I?.nextDelayMs?`${Math.round(I.nextDelayMs)} ms`:"â€”"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-300",children:"Coalescing Window"}),e.jsx("div",{className:"text-sm font-mono",children:`${_} ms (estimated)`})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-300",children:"Update Rate Limit"}),e.jsx("div",{className:"text-sm font-mono",children:A?.minIntervalMs?`â‰¥ ${A.minIntervalMs} ms`:"â€”"})]})]}),C&&e.jsxs("div",{className:"mt-2 text-[11px] text-gray-300",children:[e.jsx("span",{className:"opacity-80",children:"Last Transport Change:"})," ",e.jsx("span",{className:"font-mono",children:C.preferredTransport})," ",e.jsxs("span",{className:"opacity-70",children:["(ws ",C.wsEnabled?"enabled":"disabled",")"]})," ",e.jsxs("span",{className:"opacity-60",children:["@ ",new Date(C.ts).toLocaleTimeString()]})]})]}),e.jsx("div",{className:"px-3 py-2 border-t border-gray-700 text-[11px] text-gray-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Tips: Alt+D toggles HUD"}),e.jsx("span",{children:"Alt+Shift+P opens Performance"})]})}),e.jsxs("div",{className:"mt-3 pt-2 border-t border-white/10",children:[e.jsx("div",{className:"font-semibold text-[12px] opacity-80 mb-1.5",children:"Dev Toggles"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx("button",{onClick:Q,onKeyDown:y=>{vt(y)&&(y.preventDefault(),Q())},"aria-pressed":m,className:"px-2.5 py-1 rounded border border-gray-700 bg-[var(--k1-surface)] text-[var(--k1-text-dim)] hover:bg-[var(--k1-panel)] hover:text-[var(--k1-text)] transition-colors text-[11px]",children:m?"Abort Logging: On":"Abort Logging: Off"}),e.jsx("button",{onClick:T,onKeyDown:y=>{vt(y)&&(y.preventDefault(),T())},"aria-pressed":v,className:"px-2.5 py-1 rounded border border-gray-700 bg-[var(--k1-surface)] text-[var(--k1-text-dim)] hover:bg-[var(--k1-panel)] hover:text-[var(--k1-text)] transition-colors text-[11px]",children:v?"HMR Overlay: On":"HMR Overlay: Off"})]})]})]})})}const oe="/artifacts";async function pe(s){try{const t=await fetch(`${oe}/${s}`);return t.ok?await t.json():null}catch{return null}}function hn(){const[s,t]=c.useState(null),[r,a]=c.useState(null),[n,o]=c.useState(null),[i,u]=c.useState(null),[l,m]=c.useState(null),[d,v]=c.useState(null),[f,C]=c.useState(!1),[h,j]=c.useState(0),p=c.useCallback(async()=>{C(!0);try{t(await pe("graph.metrics.json")),a(await pe("bench.topo.json")),o(await pe("graph.estimate.json")),u(await pe("graph.impact.json")),m(await pe("graph.validation.json")),v(await pe("gates.status.json"))}finally{C(!1);try{window.dispatchEvent(new CustomEvent("k1:qa-refreshed",{detail:{ts:Date.now()}}))}catch{}}},[]);c.useEffect(()=>{p()},[p]),c.useEffect(()=>{if(h>0){const E=setInterval(()=>{p()},h*1e3);return()=>clearInterval(E)}},[h,p]);const N=n?.est?.ms??n?.ms??null,x=n?.est?.cpuPct??n?.cpu_pct??null,k=l?.counts?.errors??l?.violations?.filter(E=>E.severity==="error").length??null;return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[e.jsx("button",{className:"px-3 py-1 rounded bg-[var(--k1-btn)] text-[var(--k1-text)]",onClick:p,disabled:f,children:f?"Refreshingâ€¦":"Refresh"}),e.jsxs("label",{className:"text-[var(--k1-text-dim)] text-sm",children:["Auto-reload:",e.jsxs("select",{className:"ml-2 bg-transparent border border-[var(--k1-border)] rounded text-[var(--k1-text-dim)] text-sm",value:h,onChange:E=>j(Number(E.target.value)),children:[e.jsx("option",{value:0,children:"Off"}),e.jsx("option",{value:15,children:"15s"}),e.jsx("option",{value:30,children:"30s"}),e.jsx("option",{value:60,children:"60s"})]})]}),e.jsxs("span",{className:"ml-auto text-[var(--k1-text-dim)] text-xs",children:["Source: ",oe]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-[var(--k1-panel)]",children:[e.jsxs("h3",{className:"text-[var(--k1-text)] mb-2 flex items-center justify-between",children:[e.jsx("span",{children:"Graph Health"}),e.jsx("a",{className:"text-[var(--k1-text-dim)] text-xs underline",href:`${oe}/graph.metrics.json`,target:"_blank",rel:"noreferrer",children:"raw"})]}),s?e.jsxs("ul",{className:"text-[var(--k1-text-dim)] text-sm space-y-1",children:[e.jsxs("li",{children:["N: ",s.N," â€¢ M: ",s.M]}),e.jsxs("li",{children:["Outdegree min/max/avg: ",s.minOut,"/",s.maxOut,"/",s.avgOut.toFixed(2)]}),e.jsxs("li",{children:["DAG: ",s.isDag?"âœ…":"âŒ"]})]}):e.jsx("div",{className:"text-[var(--k1-text-dim)] text-sm",children:"Missing metrics (graph.metrics.json)"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-[var(--k1-panel)]",children:[e.jsxs("h3",{className:"text-[var(--k1-text)] mb-2 flex items-center justify-between",children:[e.jsx("span",{children:"Perf Budget"}),e.jsx("a",{className:"text-[var(--k1-text-dim)] text-xs underline",href:`${oe}/graph.estimate.json`,target:"_blank",rel:"noreferrer",children:"raw"})]}),e.jsxs("ul",{className:"text-[var(--k1-text-dim)] text-sm space-y-1",children:[e.jsxs("li",{children:["Predicted: ",N!=null?`${N.toFixed(2)} ms`:"â€”"]}),e.jsxs("li",{children:["CPU: ",x!=null?`${x}%`:"â€”"]}),e.jsxs("li",{children:[e.jsxs("span",{children:["Topo time: ",r?.topo_sort_ms!=null?`${r.topo_sort_ms.toFixed(2)} ms`:"â€”"]}),e.jsx("a",{className:"ml-2 text-[var(--k1-text-dim)] text-xs underline",href:`${oe}/bench.topo.json`,target:"_blank",rel:"noreferrer",children:"raw"})]})]})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-[var(--k1-panel)]",children:[e.jsxs("h3",{className:"text-[var(--k1-text)] mb-2 flex items-center justify-between",children:[e.jsx("span",{children:"Risk Preview"}),e.jsx("a",{className:"text-[var(--k1-text-dim)] text-xs underline",href:`${oe}/graph.impact.json`,target:"_blank",rel:"noreferrer",children:"raw"})]}),i?e.jsxs("div",{className:"text-[var(--k1-text-dim)] text-sm",children:[e.jsxs("div",{children:["Changed: ",i.changed.join(", ")||"â€”"]}),e.jsxs("div",{className:"mt-1",children:["Top impacted: ",i.impacted.slice(0,10).join(", ")||"â€”"]})]}):e.jsx("div",{className:"text-[var(--k1-text-dim)] text-sm",children:"Missing impact (graph.impact.json)"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-[var(--k1-panel)]",children:[e.jsxs("h3",{className:"text-[var(--k1-text)] mb-2 flex items-center justify-between",children:[e.jsx("span",{children:"Semantics"}),e.jsx("a",{className:"text-[var(--k1-text-dim)] text-xs underline",href:`${oe}/graph.validation.json`,target:"_blank",rel:"noreferrer",children:"raw"})]}),e.jsxs("div",{className:"text-[var(--k1-text-dim)] text-sm",children:["Errors: ",k??"â€”"]}),!l&&e.jsx("div",{className:"text-[var(--k1-text-dim)] text-sm mt-1",children:"Missing semantics (graph.validation.json)"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-[var(--k1-panel)]",children:[e.jsxs("h3",{className:"text-[var(--k1-text)] mb-2 flex items-center justify-between",children:[e.jsx("span",{children:"Gates"}),e.jsx("a",{className:"text-[var(--k1-text-dim)] text-xs underline",href:`${oe}/gates.status.json`,target:"_blank",rel:"noreferrer",children:"raw"})]}),d?e.jsxs("div",{className:"text-[var(--k1-text-dim)] text-sm space-y-1",children:[e.jsxs("div",{children:["Status: ",d.passed?"âœ… Passed":"âŒ Failed"]}),e.jsxs("div",{children:["Failures: ",d.failures?.length??0," â€¢ Notes: ",d.notes?.length??0]}),d.metrics&&e.jsxs("div",{className:"text-xs",children:[e.jsxs("span",{children:["ms: ",d.metrics.ms??"â€”"]}),e.jsxs("span",{className:"ml-2",children:["CPU: ",d.metrics.cpuPct??"â€”","%"]}),e.jsxs("span",{className:"ml-2",children:["DAG: ",d.metrics.isDag==null?"â€”":d.metrics.isDag?"âœ…":"âŒ"]}),e.jsxs("span",{className:"ml-2",children:["Cycles: ",d.metrics.cyclesDetected==null?"â€”":d.metrics.cyclesDetected?"âŒ":"âœ…"]}),e.jsxs("span",{className:"ml-2",children:["Validation errors: ",d.metrics.validationErrors??"â€”"]})]}),!d.passed&&d.failures&&d.failures.length>0&&e.jsx("ul",{className:"text-xs list-disc ml-5",children:d.failures.slice(0,3).map((E,D)=>e.jsx("li",{children:E},D))})]}):e.jsx("div",{className:"text-[var(--k1-text-dim)] text-sm",children:"Missing gates (gates.status.json)"})]})]})]})}const Xe={COMPONENTS:{TOUCH_TARGET_MIN:44}},gn=c.createContext(null),xn={enabled:!1,strictMode:!1,showViolationIndicators:!0,logViolations:!0,auditOnMount:!0,maxViolations:100,excludeComponents:[]},pn=({children:s,initialConfig:t={}})=>{const[r,a]=c.useState({...xn,...t}),[n,o]=c.useState([]),i=c.useCallback(p=>{a(N=>({...N,...p}))},[]),u=c.useCallback(p=>{if(!r.enabled||r.excludeComponents.includes(p.componentName))return;const N={...p,id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now()};if(o(x=>{const k=[...x,N];return k.length>r.maxViolations?k.slice(-r.maxViolations):k}),r.logViolations){const x=p.severity==="error"?"ðŸš¨":p.severity==="warning"?"âš ï¸":"â„¹ï¸";console.warn(`${x} UI Guard [${p.type}]:`,p.message),p.element&&console.warn("Element:",p.element)}if(r.strictMode&&p.severity==="error")throw new Error(`UI Guard Violation: ${p.message}`)},[r]),l=c.useCallback(()=>{o([])},[]),m=c.useCallback(p=>n.filter(N=>N.componentName===p),[n]),d=c.useCallback(p=>n.filter(N=>N.type===p),[n]),v=c.useCallback(p=>r.excludeComponents.includes(p),[r.excludeComponents]);c.useEffect(()=>{r.enabled&&r.auditOnMount&&setTimeout(()=>{},1e3)},[r.enabled,r.auditOnMount]),c.useEffect(()=>{if(!r.enabled)return;const p=new MutationObserver(N=>{N.forEach(x=>{if(x.type==="childList"&&x.addedNodes.forEach(k=>{k.nodeType===Node.ELEMENT_NODE&&f(k)}),x.type==="attributes"&&x.attributeName==="class"){const k=x.target;C(k)}})});return p.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","style"]}),()=>{p.disconnect()}},[r.enabled,u]);const f=p=>{const N=p.getBoundingClientRect();if(window.getComputedStyle(p),p.matches('button, a, input, select, textarea, [role="button"]')&&(N.width<Xe.COMPONENTS.TOUCH_TARGET_MIN||N.height<Xe.COMPONENTS.TOUCH_TARGET_MIN)&&u({componentName:p.tagName.toLowerCase(),type:"accessibility",severity:"warning",message:`Interactive element has insufficient touch target size: ${N.width}x${N.height}px (minimum: ${Xe.COMPONENTS.TOUCH_TARGET_MIN}px)`,element:p}),p.matches("button, a, input, select, textarea, [tabindex]")){const k=window.getComputedStyle(p,":focus"),E=k.outline!=="none"&&k.outline!=="",D=k.boxShadow!=="none";!E&&!D&&u({componentName:p.tagName.toLowerCase(),type:"accessibility",severity:"error",message:"Interactive element lacks focus indicator",element:p})}const x=h(p);x>10&&u({componentName:p.tagName.toLowerCase(),type:"performance",severity:"warning",message:`Element has excessive nesting depth: ${x} levels`,element:p})},C=p=>{const N=p.className.split(" ").filter(Boolean);p.style.length>0&&u({componentName:p.tagName.toLowerCase(),type:"layout",severity:"info",message:"Element uses inline styles instead of classes",element:p});const x=["float-left","float-right","clearfix"],k=N.filter(E=>x.includes(E));k.length>0&&u({componentName:p.tagName.toLowerCase(),type:"layout",severity:"warning",message:`Element uses deprecated classes: ${k.join(", ")}`,element:p})},h=p=>{let N=0,x=p.parentElement;for(;x&&x!==document.body;)N++,x=x.parentElement;return N},j={config:r,violations:n,updateConfig:i,reportViolation:u,clearViolations:l,getViolationsByComponent:m,getViolationsByType:d,isComponentExcluded:v};return e.jsxs(gn.Provider,{value:j,children:[s,r.enabled&&r.showViolationIndicators&&e.jsx(fn,{violations:n})]})},fn=({violations:s})=>{const[t,r]=c.useState(!1);if(s.length===0)return null;const a=s.filter(i=>i.severity==="error").length,n=s.filter(i=>i.severity==="warning").length,o=s.filter(i=>i.severity==="info").length;return e.jsx("div",{className:"fixed bottom-4 right-4 z-50",children:e.jsxs("div",{className:"bg-red-500 text-white rounded-lg shadow-lg",children:[e.jsxs("button",{onClick:()=>r(!t),className:"flex items-center gap-2 px-4 py-2 w-full text-left",children:[e.jsx("span",{className:"text-lg",children:"ðŸš¨"}),e.jsxs("span",{className:"font-medium",children:[a>0&&`${a} errors`,n>0&&`${a>0?", ":""}${n} warnings`,o>0&&`${a>0||n>0?", ":""}${o} info`]}),e.jsx("span",{className:"ml-auto",children:t?"â–¼":"â–¶"})]}),t&&e.jsxs("div",{className:"border-t border-red-400 max-h-60 overflow-y-auto",children:[s.slice(-10).map(i=>e.jsxs("div",{className:"px-4 py-2 border-b border-red-400 last:border-b-0 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:i.severity==="error"?"ðŸš¨":i.severity==="warning"?"âš ï¸":"â„¹ï¸"}),e.jsx("span",{className:"font-medium",children:i.componentName}),e.jsx("span",{className:"text-red-200 text-xs",children:i.type})]}),e.jsx("div",{className:"text-red-100 mt-1",children:i.message})]},i.id)),s.length>10&&e.jsxs("div",{className:"px-4 py-2 text-center text-red-200 text-xs",children:["... and ",s.length-10," more violations"]})]})]})})},te=[{id:"elegant-light",name:"Elegant Light",blur:8,opacity:.15,edgeLighting:.3,gradientStart:"rgba(255, 255, 255, 0.2)",gradientEnd:"rgba(255, 255, 255, 0.05)",borderThickness:1,borderRadius:16,shadowIntensity:.2,reflectionIntensity:.4},{id:"elegant-medium",name:"Elegant Medium",blur:12,opacity:.25,edgeLighting:.4,gradientStart:"rgba(255, 255, 255, 0.3)",gradientEnd:"rgba(255, 255, 255, 0.1)",borderThickness:1.5,borderRadius:16,shadowIntensity:.3,reflectionIntensity:.5},{id:"elegant-heavy",name:"Elegant Heavy",blur:20,opacity:.35,edgeLighting:.5,gradientStart:"rgba(255, 255, 255, 0.4)",gradientEnd:"rgba(255, 255, 255, 0.15)",borderThickness:2,borderRadius:16,shadowIntensity:.4,reflectionIntensity:.6},{id:"frosted-light",name:"Frosted Light",blur:6,opacity:.2,edgeLighting:.6,gradientStart:"rgba(200, 220, 255, 0.25)",gradientEnd:"rgba(150, 180, 255, 0.1)",borderThickness:1,borderRadius:20,shadowIntensity:.25,reflectionIntensity:.3},{id:"frosted-medium",name:"Frosted Medium",blur:15,opacity:.3,edgeLighting:.7,gradientStart:"rgba(180, 200, 255, 0.35)",gradientEnd:"rgba(120, 150, 255, 0.15)",borderThickness:1.5,borderRadius:20,shadowIntensity:.35,reflectionIntensity:.4},{id:"frosted-heavy",name:"Frosted Heavy",blur:25,opacity:.45,edgeLighting:.8,gradientStart:"rgba(160, 180, 255, 0.45)",gradientEnd:"rgba(100, 130, 255, 0.2)",borderThickness:2,borderRadius:20,shadowIntensity:.45,reflectionIntensity:.5},{id:"neon-cyan",name:"Neon Cyan",blur:10,opacity:.2,edgeLighting:.9,gradientStart:"rgba(0, 255, 255, 0.3)",gradientEnd:"rgba(0, 200, 255, 0.1)",borderThickness:1,borderRadius:12,shadowIntensity:.6,reflectionIntensity:.8},{id:"neon-purple",name:"Neon Purple",blur:12,opacity:.25,edgeLighting:.85,gradientStart:"rgba(200, 100, 255, 0.35)",gradientEnd:"rgba(150, 50, 255, 0.15)",borderThickness:1.5,borderRadius:12,shadowIntensity:.5,reflectionIntensity:.7},{id:"warm-amber",name:"Warm Amber",blur:14,opacity:.3,edgeLighting:.6,gradientStart:"rgba(255, 200, 100, 0.4)",gradientEnd:"rgba(255, 150, 50, 0.2)",borderThickness:2,borderRadius:18,shadowIntensity:.4,reflectionIntensity:.5},{id:"cool-mint",name:"Cool Mint",blur:16,opacity:.28,edgeLighting:.55,gradientStart:"rgba(100, 255, 200, 0.35)",gradientEnd:"rgba(50, 255, 150, 0.15)",borderThickness:1.5,borderRadius:14,shadowIntensity:.35,reflectionIntensity:.45},{id:"deep-ocean",name:"Deep Ocean",blur:18,opacity:.4,edgeLighting:.7,gradientStart:"rgba(50, 150, 255, 0.45)",gradientEnd:"rgba(20, 100, 200, 0.25)",borderThickness:2,borderRadius:16,shadowIntensity:.5,reflectionIntensity:.6},{id:"sunset-glow",name:"Sunset Glow",blur:22,opacity:.35,edgeLighting:.8,gradientStart:"rgba(255, 150, 100, 0.4)",gradientEnd:"rgba(255, 100, 150, 0.2)",borderThickness:1.5,borderRadius:20,shadowIntensity:.45,reflectionIntensity:.55},{id:"crystal-clear",name:"Crystal Clear",blur:5,opacity:.1,edgeLighting:.4,gradientStart:"rgba(255, 255, 255, 0.15)",gradientEnd:"rgba(240, 240, 255, 0.05)",borderThickness:.5,borderRadius:8,shadowIntensity:.15,reflectionIntensity:.25},{id:"ultra-frosted",name:"Ultra Frosted",blur:30,opacity:.6,edgeLighting:.9,gradientStart:"rgba(220, 220, 255, 0.6)",gradientEnd:"rgba(180, 180, 255, 0.4)",borderThickness:3,borderRadius:24,shadowIntensity:.6,reflectionIntensity:.8},{id:"minimal-ghost",name:"Minimal Ghost",blur:4,opacity:.08,edgeLighting:.2,gradientStart:"rgba(255, 255, 255, 0.1)",gradientEnd:"rgba(250, 250, 255, 0.03)",borderThickness:.5,borderRadius:6,shadowIntensity:.1,reflectionIntensity:.15}],vn=()=>{const[s,t]=c.useState(te[0]),[r,a]=c.useState(te[0]),[n,o]=c.useState("grid"),[i,u]=c.useState([]),[l,m]=c.useState([te[0],te[1],te[2]]),d=c.useCallback(h=>{a(j=>({...j,...h}))},[]),v=c.useCallback(()=>{const h=prompt("Enter preset name:");if(h){const j={...r,id:`custom-${Date.now()}`,name:h};u(p=>[...p,j])}},[r]),f=c.useCallback(h=>({"--tile-blur":`${h.blur}px`,"--tile-opacity":h.opacity,"--tile-edge-lighting":h.edgeLighting,"--tile-gradient-start":h.gradientStart,"--tile-gradient-end":h.gradientEnd,"--tile-border-thickness":`${h.borderThickness}px`,"--tile-border-radius":`${h.borderRadius}px`,"--tile-shadow-intensity":h.shadowIntensity,"--tile-reflection-intensity":h.reflectionIntensity}),[]),C=({config:h,size:j="medium"})=>e.jsx("div",{className:`glassmorphic-tile ${j}`,style:f(h),children:e.jsxs("div",{className:"tile-content",children:[e.jsx("h3",{children:h.name}),e.jsxs("div",{className:"tile-specs",children:[e.jsxs("span",{children:["Blur: ",h.blur,"px"]}),e.jsxs("span",{children:["Opacity: ",(h.opacity*100).toFixed(0),"%"]}),e.jsxs("span",{children:["Edge: ",(h.edgeLighting*100).toFixed(0),"%"]})]})]})});return e.jsxs("div",{className:"glassmorphic-prototype",children:[e.jsxs("div",{className:"prototype-header",children:[e.jsx("h1",{children:"K1 Glassmorphic Tile Laboratory"}),e.jsxs("div",{className:"view-controls",children:[e.jsx("button",{className:n==="grid"?"active":"",onClick:()=>o("grid"),children:"Grid View"}),e.jsx("button",{className:n==="single"?"active":"",onClick:()=>o("single"),children:"Single View"}),e.jsx("button",{className:n==="comparison"?"active":"",onClick:()=>o("comparison"),children:"Comparison"})]})]}),n==="grid"&&e.jsx("div",{className:"variations-grid",children:te.map(h=>e.jsx("div",{className:"variation-item",onClick:()=>t(h),children:e.jsx(C,{config:h,size:"small"})},h.id))}),n==="single"&&e.jsxs("div",{className:"single-view",children:[e.jsxs("div",{className:"controls-panel",children:[e.jsx("h3",{children:"Tile Configuration"}),e.jsxs("div",{className:"control-group",children:[e.jsxs("label",{children:["Blur Intensity: ",r.blur,"px"]}),e.jsx("input",{type:"range",min:"0",max:"40",value:r.blur,onChange:h=>d({blur:Number(h.target.value)})})]}),e.jsxs("div",{className:"control-group",children:[e.jsxs("label",{children:["Opacity: ",(r.opacity*100).toFixed(0),"%"]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:r.opacity,onChange:h=>d({opacity:Number(h.target.value)})})]}),e.jsxs("div",{className:"control-group",children:[e.jsxs("label",{children:["Edge Lighting: ",(r.edgeLighting*100).toFixed(0),"%"]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:r.edgeLighting,onChange:h=>d({edgeLighting:Number(h.target.value)})})]}),e.jsxs("div",{className:"control-group",children:[e.jsxs("label",{children:["Border Thickness: ",r.borderThickness,"px"]}),e.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:r.borderThickness,onChange:h=>d({borderThickness:Number(h.target.value)})})]}),e.jsxs("div",{className:"control-group",children:[e.jsxs("label",{children:["Border Radius: ",r.borderRadius,"px"]}),e.jsx("input",{type:"range",min:"0",max:"40",value:r.borderRadius,onChange:h=>d({borderRadius:Number(h.target.value)})})]}),e.jsxs("div",{className:"control-group",children:[e.jsxs("label",{children:["Shadow Intensity: ",(r.shadowIntensity*100).toFixed(0),"%"]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:r.shadowIntensity,onChange:h=>d({shadowIntensity:Number(h.target.value)})})]}),e.jsxs("div",{className:"control-group",children:[e.jsxs("label",{children:["Reflection Intensity: ",(r.reflectionIntensity*100).toFixed(0),"%"]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:r.reflectionIntensity,onChange:h=>d({reflectionIntensity:Number(h.target.value)})})]}),e.jsxs("div",{className:"preset-controls",children:[e.jsx("button",{onClick:v,children:"Save Preset"}),e.jsxs("select",{onChange:h=>{const j=[...te,...i].find(p=>p.id===h.target.value);j&&a(j)},children:[e.jsx("option",{value:"",children:"Load Preset..."}),te.map(h=>e.jsx("option",{value:h.id,children:h.name},h.id)),i.map(h=>e.jsxs("option",{value:h.id,children:[h.name," (Custom)"]},h.id))]})]})]}),e.jsx("div",{className:"preview-panel",children:e.jsx(C,{config:r,size:"large"})})]}),n==="comparison"&&e.jsx("div",{className:"comparison-view",children:e.jsx("div",{className:"comparison-grid",children:l.map((h,j)=>e.jsxs("div",{className:"comparison-item",children:[e.jsx(C,{config:h,size:"medium"}),e.jsx("select",{value:h.id,onChange:p=>{const N=te.find(x=>x.id===p.target.value);if(N){const x=[...l];x[j]=N,m(x)}},children:te.map(p=>e.jsx("option",{value:p.id,children:p.name},p.id))})]},j))})})]})},bt={id:"custom",name:"Custom",blur:12,opacity:.25,surfaceOpacity:.15,edgeLighting:.4,glowIntensity:0,glowColor:"#00ffff",gradientStart:"rgba(255, 255, 255, 0.3)",gradientEnd:"rgba(255, 255, 255, 0.1)",backgroundTint:"rgba(255, 255, 255, 0.05)",borderThickness:1.5,borderRadius:16,borderOpacity:.3,shadowIntensity:.3,shadowBlur:20,shadowColor:"rgba(0, 0, 0, 0.3)",reflectionIntensity:.5,surfaceTexture:0,noiseIntensity:0,distortionAmount:0,lightSourceAngle:45},be=[{id:"elegant-light",name:"Elegant Light",blur:8,opacity:.15,surfaceOpacity:.1,edgeLighting:.3,glowIntensity:0,glowColor:"#ffffff",gradientStart:"rgba(255, 255, 255, 0.2)",gradientEnd:"rgba(255, 255, 255, 0.05)",backgroundTint:"rgba(255, 255, 255, 0.03)",borderThickness:1,borderRadius:16,borderOpacity:.25,shadowIntensity:.2,shadowBlur:15,shadowColor:"rgba(0, 0, 0, 0.2)",reflectionIntensity:.4,surfaceTexture:0,noiseIntensity:0,distortionAmount:0,lightSourceAngle:45},{id:"crystal-clear",name:"Crystal Clear",blur:5,opacity:.1,surfaceOpacity:.08,edgeLighting:.4,glowIntensity:0,glowColor:"#ffffff",gradientStart:"rgba(255, 255, 255, 0.15)",gradientEnd:"rgba(240, 240, 255, 0.05)",backgroundTint:"rgba(250, 250, 255, 0.02)",borderThickness:.5,borderRadius:8,borderOpacity:.2,shadowIntensity:.15,shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.15)",reflectionIntensity:.25,surfaceTexture:0,noiseIntensity:0,distortionAmount:0,lightSourceAngle:45},{id:"minimal-ghost",name:"Minimal Ghost",blur:4,opacity:.08,surfaceOpacity:.05,edgeLighting:.2,glowIntensity:0,glowColor:"#ffffff",gradientStart:"rgba(255, 255, 255, 0.1)",gradientEnd:"rgba(250, 250, 255, 0.03)",backgroundTint:"rgba(255, 255, 255, 0.01)",borderThickness:.5,borderRadius:6,borderOpacity:.15,shadowIntensity:.1,shadowBlur:8,shadowColor:"rgba(0, 0, 0, 0.1)",reflectionIntensity:.15,surfaceTexture:0,noiseIntensity:0,distortionAmount:0,lightSourceAngle:45},{id:"frosted-light",name:"Frosted Light",blur:6,opacity:.2,surfaceOpacity:.12,edgeLighting:.6,glowIntensity:0,glowColor:"#ffffff",gradientStart:"rgba(200, 220, 255, 0.25)",gradientEnd:"rgba(150, 180, 255, 0.1)",backgroundTint:"rgba(180, 200, 255, 0.05)",borderThickness:1,borderRadius:20,borderOpacity:.3,shadowIntensity:.25,shadowBlur:18,shadowColor:"rgba(0, 0, 0, 0.25)",reflectionIntensity:.3,surfaceTexture:.1,noiseIntensity:0,distortionAmount:0,lightSourceAngle:45},{id:"warm-subtle",name:"Warm Subtle",blur:10,opacity:.18,surfaceOpacity:.12,edgeLighting:.35,glowIntensity:.1,glowColor:"#ffaa66",gradientStart:"rgba(255, 220, 180, 0.22)",gradientEnd:"rgba(255, 200, 150, 0.08)",backgroundTint:"rgba(255, 210, 170, 0.04)",borderThickness:1,borderRadius:14,borderOpacity:.25,shadowIntensity:.22,shadowBlur:16,shadowColor:"rgba(0, 0, 0, 0.22)",reflectionIntensity:.35,surfaceTexture:0,noiseIntensity:0,distortionAmount:0,lightSourceAngle:45},{id:"elegant-medium",name:"Elegant Medium",blur:12,opacity:.25,surfaceOpacity:.18,edgeLighting:.4,glowIntensity:0,glowColor:"#ffffff",gradientStart:"rgba(255, 255, 255, 0.3)",gradientEnd:"rgba(255, 255, 255, 0.1)",backgroundTint:"rgba(255, 255, 255, 0.06)",borderThickness:1.5,borderRadius:16,borderOpacity:.35,shadowIntensity:.3,shadowBlur:22,shadowColor:"rgba(0, 0, 0, 0.3)",reflectionIntensity:.5,surfaceTexture:0,noiseIntensity:0,distortionAmount:0,lightSourceAngle:45},{id:"frosted-medium",name:"Frosted Medium",blur:15,opacity:.3,surfaceOpacity:.22,edgeLighting:.7,glowIntensity:0,glowColor:"#ffffff",gradientStart:"rgba(180, 200, 255, 0.35)",gradientEnd:"rgba(120, 150, 255, 0.15)",backgroundTint:"rgba(150, 175, 255, 0.08)",borderThickness:1.5,borderRadius:20,borderOpacity:.4,shadowIntensity:.35,shadowBlur:25,shadowColor:"rgba(0, 0, 0, 0.35)",reflectionIntensity:.4,surfaceTexture:.15,noiseIntensity:0,distortionAmount:0,lightSourceAngle:45},{id:"neon-cyan",name:"Neon Cyan",blur:10,opacity:.2,surfaceOpacity:.15,edgeLighting:.9,glowIntensity:.6,glowColor:"#00ffff",gradientStart:"rgba(0, 255, 255, 0.3)",gradientEnd:"rgba(0, 200, 255, 0.1)",backgroundTint:"rgba(0, 220, 255, 0.05)",borderThickness:1,borderRadius:12,borderOpacity:.6,shadowIntensity:.6,shadowBlur:30,shadowColor:"rgba(0, 255, 255, 0.4)",reflectionIntensity:.8,surfaceTexture:0,noiseIntensity:0,distortionAmount:0,lightSourceAngle:45},{id:"warm-amber",name:"Warm Amber",blur:14,opacity:.3,surfaceOpacity:.2,edgeLighting:.6,glowIntensity:.3,glowColor:"#ffaa00",gradientStart:"rgba(255, 200, 100, 0.4)",gradientEnd:"rgba(255, 150, 50, 0.2)",backgroundTint:"rgba(255, 175, 75, 0.08)",borderThickness:2,borderRadius:18,borderOpacity:.4,shadowIntensity:.4,shadowBlur:28,shadowColor:"rgba(255, 150, 0, 0.3)",reflectionIntensity:.5,surfaceTexture:0,noiseIntensity:0,distortionAmount:0,lightSourceAngle:45},{id:"cool-mint",name:"Cool Mint",blur:16,opacity:.28,surfaceOpacity:.19,edgeLighting:.55,glowIntensity:.2,glowColor:"#66ffcc",gradientStart:"rgba(100, 255, 200, 0.35)",gradientEnd:"rgba(50, 255, 150, 0.15)",backgroundTint:"rgba(75, 255, 175, 0.07)",borderThickness:1.5,borderRadius:14,borderOpacity:.35,shadowIntensity:.35,shadowBlur:24,shadowColor:"rgba(0, 200, 150, 0.25)",reflectionIntensity:.45,surfaceTexture:0,noiseIntensity:0,distortionAmount:0,lightSourceAngle:45},{id:"elegant-heavy",name:"Elegant Heavy",blur:20,opacity:.35,surfaceOpacity:.28,edgeLighting:.5,glowIntensity:0,glowColor:"#ffffff",gradientStart:"rgba(255, 255, 255, 0.4)",gradientEnd:"rgba(255, 255, 255, 0.15)",backgroundTint:"rgba(255, 255, 255, 0.1)",borderThickness:2,borderRadius:16,borderOpacity:.45,shadowIntensity:.4,shadowBlur:30,shadowColor:"rgba(0, 0, 0, 0.4)",reflectionIntensity:.6,surfaceTexture:0,noiseIntensity:0,distortionAmount:0,lightSourceAngle:45},{id:"frosted-heavy",name:"Frosted Heavy",blur:25,opacity:.45,surfaceOpacity:.35,edgeLighting:.8,glowIntensity:0,glowColor:"#ffffff",gradientStart:"rgba(160, 180, 255, 0.45)",gradientEnd:"rgba(100, 130, 255, 0.2)",backgroundTint:"rgba(130, 155, 255, 0.12)",borderThickness:2,borderRadius:20,borderOpacity:.5,shadowIntensity:.45,shadowBlur:35,shadowColor:"rgba(0, 0, 0, 0.45)",reflectionIntensity:.5,surfaceTexture:.2,noiseIntensity:0,distortionAmount:0,lightSourceAngle:45},{id:"ultra-frosted",name:"Ultra Frosted",blur:30,opacity:.6,surfaceOpacity:.45,edgeLighting:.9,glowIntensity:0,glowColor:"#ffffff",gradientStart:"rgba(220, 220, 255, 0.6)",gradientEnd:"rgba(180, 180, 255, 0.4)",backgroundTint:"rgba(200, 200, 255, 0.15)",borderThickness:3,borderRadius:24,borderOpacity:.6,shadowIntensity:.6,shadowBlur:40,shadowColor:"rgba(0, 0, 0, 0.6)",reflectionIntensity:.8,surfaceTexture:.3,noiseIntensity:0,distortionAmount:0,lightSourceAngle:45},{id:"deep-ocean",name:"Deep Ocean",blur:18,opacity:.4,surfaceOpacity:.3,edgeLighting:.7,glowIntensity:.4,glowColor:"#0088ff",gradientStart:"rgba(50, 150, 255, 0.45)",gradientEnd:"rgba(20, 100, 200, 0.25)",backgroundTint:"rgba(35, 125, 225, 0.1)",borderThickness:2,borderRadius:16,borderOpacity:.5,shadowIntensity:.5,shadowBlur:32,shadowColor:"rgba(0, 100, 200, 0.4)",reflectionIntensity:.6,surfaceTexture:.1,noiseIntensity:0,distortionAmount:0,lightSourceAngle:45},{id:"sunset-glow",name:"Sunset Glow",blur:22,opacity:.35,surfaceOpacity:.25,edgeLighting:.8,glowIntensity:.5,glowColor:"#ff6600",gradientStart:"rgba(255, 150, 100, 0.4)",gradientEnd:"rgba(255, 100, 150, 0.2)",backgroundTint:"rgba(255, 125, 125, 0.08)",borderThickness:1.5,borderRadius:20,borderOpacity:.45,shadowIntensity:.45,shadowBlur:35,shadowColor:"rgba(255, 100, 0, 0.35)",reflectionIntensity:.55,surfaceTexture:0,noiseIntensity:0,distortionAmount:0,lightSourceAngle:45}],bn=()=>{const[s,t]=c.useState(bt),[r,a]=c.useState("explorer"),[n,o]=c.useState(null),[i,u]=c.useState(null),[l,m]=c.useState([]),[d,v]=c.useState(!0),[f,C]=c.useState(!1);c.useEffect(()=>{const g=localStorage.getItem("tile-discoveries");if(g)try{m(JSON.parse(g))}catch(A){console.error("Failed to load saved discoveries:",A)}},[]),c.useEffect(()=>{localStorage.setItem("tile-discoveries",JSON.stringify(l))},[l]);const h=c.useCallback((g,A)=>{t(P=>({...P,[g]:A,id:"custom",name:"Custom"})),o(null)},[]),j=c.useCallback(g=>{t(g),o(g.id)},[]),p=c.useCallback(()=>{const g={...bt,id:"random",name:"Random Discovery",blur:Math.random()*35+3,opacity:Math.random()*.6+.05,surfaceOpacity:Math.random()*.4+.03,edgeLighting:Math.random()*.9+.1,glowIntensity:Math.random()*.8,borderThickness:Math.random()*3+.5,borderRadius:Math.random()*30+4,borderOpacity:Math.random()*.7+.1,shadowIntensity:Math.random()*.7+.1,shadowBlur:Math.random()*40+8,reflectionIntensity:Math.random()*.9+.1,surfaceTexture:Math.random()*.4,noiseIntensity:Math.random()*.3,distortionAmount:Math.random()*.2,lightSourceAngle:Math.random()*90+15};t(g),o(null)},[]),N=c.useCallback(()=>{const g=prompt("Name your discovery:");if(!g)return;const A={id:Date.now().toString(),name:g,parameters:{...s},createdAt:new Date().toISOString(),tags:[]};m(P=>[A,...P])},[s]),x=c.useCallback(g=>{m(A=>A.filter(P=>P.id!==g))},[]),k=c.useCallback(g=>{const A=`
/* ${g.name} Glassmorphic Tile */
.glassmorphic-tile {
  backdrop-filter: blur(${g.blur}px);
  -webkit-backdrop-filter: blur(${g.blur}px);
  background: linear-gradient(135deg, ${g.gradientStart}, ${g.gradientEnd});
  border: ${g.borderThickness}px solid rgba(255, 255, 255, ${g.borderOpacity});
  border-radius: ${g.borderRadius}px;
  box-shadow: 
    0 ${g.shadowBlur/2}px ${g.shadowBlur}px ${g.shadowColor},
    inset 0 1px 0 rgba(255, 255, 255, ${g.edgeLighting});
  ${g.glowIntensity>0?`filter: drop-shadow(0 0 ${g.glowIntensity*20}px ${g.glowColor});`:""}
  position: relative;
  overflow: hidden;
}

.glassmorphic-tile::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: ${g.backgroundTint};
  opacity: ${g.surfaceOpacity};
  pointer-events: none;
}

.glassmorphic-tile::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 50%;
  background: linear-gradient(180deg, rgba(255,255,255,${g.reflectionIntensity*.3}) 0%, transparent 100%);
  pointer-events: none;
}
    `.trim();navigator.clipboard.writeText(A),alert("CSS copied to clipboard!")},[]),E=c.useCallback((g,A="medium")=>({...{small:{width:"120px",height:"80px",padding:"12px"},medium:{width:"200px",height:"140px",padding:"20px"},large:{width:"300px",height:"200px",padding:"30px"}}[A],backdropFilter:`blur(${g.blur}px)`,WebkitBackdropFilter:`blur(${g.blur}px)`,background:`linear-gradient(135deg, ${g.gradientStart}, ${g.gradientEnd})`,border:`${g.borderThickness}px solid rgba(255, 255, 255, ${g.borderOpacity})`,borderRadius:`${g.borderRadius}px`,boxShadow:`
        0 ${g.shadowBlur/2}px ${g.shadowBlur}px ${g.shadowColor},
        inset 0 1px 0 rgba(255, 255, 255, ${g.edgeLighting})
      `,filter:g.glowIntensity>0?`drop-shadow(0 0 ${g.glowIntensity*20}px ${g.glowColor})`:"none",position:"relative",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",color:"rgba(255, 255, 255, 0.9)",fontWeight:"500",fontSize:A==="small"?"12px":A==="medium"?"14px":"16px"}),[]),D=()=>e.jsxs("div",{className:"parameter-controls",children:[e.jsxs("div",{className:"control-section",children:[e.jsx("h3",{children:"Core Glass Properties"}),e.jsxs("div",{className:"control-grid",children:[e.jsxs("div",{className:"control-item",children:[e.jsx("label",{children:"Blur Radius"}),e.jsx("input",{type:"range",min:"1",max:"40",step:"0.5",value:s.blur,onChange:g=>h("blur",parseFloat(g.target.value))}),e.jsxs("span",{children:[s.blur.toFixed(1),"px"]})]}),e.jsxs("div",{className:"control-item",children:[e.jsx("label",{children:"Background Opacity"}),e.jsx("input",{type:"range",min:"0.01",max:"0.8",step:"0.01",value:s.opacity,onChange:g=>h("opacity",parseFloat(g.target.value))}),e.jsxs("span",{children:[(s.opacity*100).toFixed(0),"%"]})]}),e.jsxs("div",{className:"control-item",children:[e.jsx("label",{children:"Surface Opacity"}),e.jsx("input",{type:"range",min:"0.01",max:"0.6",step:"0.01",value:s.surfaceOpacity,onChange:g=>h("surfaceOpacity",parseFloat(g.target.value))}),e.jsxs("span",{children:[(s.surfaceOpacity*100).toFixed(0),"%"]})]})]})]}),e.jsxs("div",{className:"control-section",children:[e.jsx("h3",{children:"Lighting & Effects"}),e.jsxs("div",{className:"control-grid",children:[e.jsxs("div",{className:"control-item",children:[e.jsx("label",{children:"Edge Lighting"}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:s.edgeLighting,onChange:g=>h("edgeLighting",parseFloat(g.target.value))}),e.jsxs("span",{children:[(s.edgeLighting*100).toFixed(0),"%"]})]}),e.jsxs("div",{className:"control-item",children:[e.jsx("label",{children:"Glow Intensity"}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:s.glowIntensity,onChange:g=>h("glowIntensity",parseFloat(g.target.value))}),e.jsxs("span",{children:[(s.glowIntensity*100).toFixed(0),"%"]})]}),e.jsxs("div",{className:"control-item",children:[e.jsx("label",{children:"Glow Color"}),e.jsx("input",{type:"color",value:s.glowColor,onChange:g=>h("glowColor",g.target.value)})]}),e.jsxs("div",{className:"control-item",children:[e.jsx("label",{children:"Light Source Angle"}),e.jsx("input",{type:"range",min:"0",max:"90",step:"1",value:s.lightSourceAngle,onChange:g=>h("lightSourceAngle",parseFloat(g.target.value))}),e.jsxs("span",{children:[s.lightSourceAngle,"Â°"]})]})]})]}),e.jsxs("div",{className:"control-section",children:[e.jsx("h3",{children:"Borders & Shape"}),e.jsxs("div",{className:"control-grid",children:[e.jsxs("div",{className:"control-item",children:[e.jsx("label",{children:"Border Thickness"}),e.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:s.borderThickness,onChange:g=>h("borderThickness",parseFloat(g.target.value))}),e.jsxs("span",{children:[s.borderThickness.toFixed(1),"px"]})]}),e.jsxs("div",{className:"control-item",children:[e.jsx("label",{children:"Border Radius"}),e.jsx("input",{type:"range",min:"0",max:"40",step:"1",value:s.borderRadius,onChange:g=>h("borderRadius",parseFloat(g.target.value))}),e.jsxs("span",{children:[s.borderRadius,"px"]})]}),e.jsxs("div",{className:"control-item",children:[e.jsx("label",{children:"Border Opacity"}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:s.borderOpacity,onChange:g=>h("borderOpacity",parseFloat(g.target.value))}),e.jsxs("span",{children:[(s.borderOpacity*100).toFixed(0),"%"]})]})]})]}),e.jsxs("div",{className:"control-section",children:[e.jsx("h3",{children:"Shadows & Depth"}),e.jsxs("div",{className:"control-grid",children:[e.jsxs("div",{className:"control-item",children:[e.jsx("label",{children:"Shadow Intensity"}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:s.shadowIntensity,onChange:g=>h("shadowIntensity",parseFloat(g.target.value))}),e.jsxs("span",{children:[(s.shadowIntensity*100).toFixed(0),"%"]})]}),e.jsxs("div",{className:"control-item",children:[e.jsx("label",{children:"Shadow Blur"}),e.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:s.shadowBlur,onChange:g=>h("shadowBlur",parseFloat(g.target.value))}),e.jsxs("span",{children:[s.shadowBlur,"px"]})]})]})]}),e.jsxs("div",{className:"control-section",children:[e.jsx("h3",{children:"Surface & Texture"}),e.jsxs("div",{className:"control-grid",children:[e.jsxs("div",{className:"control-item",children:[e.jsx("label",{children:"Reflection Intensity"}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:s.reflectionIntensity,onChange:g=>h("reflectionIntensity",parseFloat(g.target.value))}),e.jsxs("span",{children:[(s.reflectionIntensity*100).toFixed(0),"%"]})]}),e.jsxs("div",{className:"control-item",children:[e.jsx("label",{children:"Surface Texture"}),e.jsx("input",{type:"range",min:"0",max:"0.5",step:"0.01",value:s.surfaceTexture,onChange:g=>h("surfaceTexture",parseFloat(g.target.value))}),e.jsxs("span",{children:[(s.surfaceTexture*100).toFixed(0),"%"]})]}),e.jsxs("div",{className:"control-item",children:[e.jsx("label",{children:"Noise Intensity"}),e.jsx("input",{type:"range",min:"0",max:"0.4",step:"0.01",value:s.noiseIntensity,onChange:g=>h("noiseIntensity",parseFloat(g.target.value))}),e.jsxs("span",{children:[(s.noiseIntensity*100).toFixed(0),"%"]})]})]})]})]}),b=()=>e.jsxs("div",{className:"preset-library",children:[e.jsx("h3",{children:"Curated Starting Points"}),e.jsxs("div",{className:"preset-categories",children:[e.jsxs("div",{className:"preset-category",children:[e.jsx("h4",{children:"Light Intensity"}),e.jsx("div",{className:"preset-grid",children:be.slice(0,5).map(g=>e.jsx("div",{className:`preset-tile ${n===g.id?"selected":""}`,style:E(g,"small"),onClick:()=>j(g),children:e.jsx("span",{children:g.name})},g.id))})]}),e.jsxs("div",{className:"preset-category",children:[e.jsx("h4",{children:"Medium Intensity"}),e.jsx("div",{className:"preset-grid",children:be.slice(5,10).map(g=>e.jsx("div",{className:`preset-tile ${n===g.id?"selected":""}`,style:E(g,"small"),onClick:()=>j(g),children:e.jsx("span",{children:g.name})},g.id))})]}),e.jsxs("div",{className:"preset-category",children:[e.jsx("h4",{children:"Heavy Intensity"}),e.jsx("div",{className:"preset-grid",children:be.slice(10,15).map(g=>e.jsx("div",{className:`preset-tile ${n===g.id?"selected":""}`,style:E(g,"small"),onClick:()=>j(g),children:e.jsx("span",{children:g.name})},g.id))})]})]})]}),w=()=>e.jsxs("div",{className:"live-preview",children:[e.jsxs("div",{className:"preview-header",children:[e.jsx("h3",{children:"Live Preview"}),e.jsxs("div",{className:"preview-controls",children:[e.jsxs("button",{className:`toggle-btn ${d?"active":""}`,onClick:()=>v(!d),children:[e.jsx(_t,{size:16}),"Size Variants"]}),e.jsxs("button",{onClick:()=>k(s),className:"export-btn",children:[e.jsx(Ze,{size:16}),"Export CSS"]}),e.jsxs("button",{onClick:N,className:"save-btn",children:[e.jsx(ur,{size:16}),"Save Discovery"]}),e.jsxs("button",{onClick:p,className:"randomize-btn",children:[e.jsx(mr,{size:16}),"Randomize"]})]})]}),e.jsx("div",{className:"preview-area",children:d?e.jsxs("div",{className:"size-variants",children:[e.jsxs("div",{className:"variant-group",children:[e.jsx("label",{children:"Small"}),e.jsx("div",{style:E(s,"small"),children:e.jsx("span",{children:"Small Tile"})})]}),e.jsxs("div",{className:"variant-group",children:[e.jsx("label",{children:"Medium"}),e.jsx("div",{style:E(s,"medium"),children:e.jsx("span",{children:"Medium Tile"})})]}),e.jsxs("div",{className:"variant-group",children:[e.jsx("label",{children:"Large"}),e.jsx("div",{style:E(s,"large"),children:e.jsx("span",{children:"Large Tile"})})]})]}):e.jsx("div",{className:"single-preview",children:e.jsx("div",{style:E(s,"large"),children:e.jsx("span",{children:s.name})})})})]}),S=()=>e.jsxs("div",{className:"comparison-view",children:[e.jsxs("div",{className:"comparison-header",children:[e.jsx("h3",{children:"Side-by-Side Comparison"}),e.jsxs("div",{className:"comparison-controls",children:[e.jsxs("select",{value:i?.id||"",onChange:g=>{const A=be.find(P=>P.id===g.target.value)||l.find(P=>P.id===g.target.value)?.parameters;u(A||null)},children:[e.jsx("option",{value:"",children:"Select comparison target..."}),e.jsx("optgroup",{label:"Presets",children:be.map(g=>e.jsx("option",{value:g.id,children:g.name},g.id))}),e.jsx("optgroup",{label:"Your Discoveries",children:l.map(g=>e.jsx("option",{value:g.id,children:g.name},g.id))})]}),e.jsx("button",{className:`toggle-btn ${f?"active":""}`,onClick:()=>C(!f),children:"Parameter Diff"})]})]}),i&&e.jsxs("div",{className:"comparison-content",children:[e.jsxs("div",{className:"comparison-tiles",children:[e.jsxs("div",{className:"comparison-item",children:[e.jsxs("h4",{children:["Current (",s.name,")"]}),e.jsx("div",{style:E(s,"large"),children:e.jsx("span",{children:s.name})})]}),e.jsxs("div",{className:"comparison-item",children:[e.jsxs("h4",{children:["Target (",i.name,")"]}),e.jsx("div",{style:E(i,"large"),children:e.jsx("span",{children:i.name})})]})]}),f&&e.jsxs("div",{className:"parameter-diff",children:[e.jsx("h4",{children:"Parameter Differences"}),e.jsx("div",{className:"diff-grid",children:Object.entries(s).map(([g,A])=>{if(g==="id"||g==="name")return null;const P=i[g],_=A!==P;return e.jsxs("div",{className:`diff-item ${_?"different":"same"}`,children:[e.jsx("span",{className:"param-name",children:g}),e.jsx("span",{className:"current-value",children:String(A)}),e.jsx("span",{className:"target-value",children:String(P)})]},g)})})]})]})]}),I=()=>e.jsxs("div",{className:"discovery-library",children:[e.jsxs("div",{className:"library-header",children:[e.jsxs("h3",{children:["Your Discoveries (",l.length,")"]}),e.jsx("div",{className:"library-controls",children:e.jsxs("button",{onClick:()=>{const g=JSON.stringify(l,null,2),A=new Blob([g],{type:"application/json"}),P=URL.createObjectURL(A),_=document.createElement("a");_.href=P,_.download="tile-discoveries.json",_.click(),URL.revokeObjectURL(P)},children:[e.jsx(Te,{size:16}),"Export Library"]})})]}),e.jsx("div",{className:"discovery-grid",children:l.map(g=>e.jsxs("div",{className:"discovery-item",children:[e.jsx("div",{className:"discovery-preview",children:e.jsx("div",{style:E(g.parameters,"medium"),onClick:()=>j(g.parameters),children:e.jsx("span",{children:g.name})})}),e.jsxs("div",{className:"discovery-info",children:[e.jsx("h4",{children:g.name}),e.jsxs("p",{children:["Created: ",new Date(g.createdAt).toLocaleDateString()]}),e.jsxs("div",{className:"discovery-actions",children:[e.jsx("button",{onClick:()=>j(g.parameters),children:"Load"}),e.jsx("button",{onClick:()=>u(g.parameters),children:"Compare"}),e.jsx("button",{onClick:()=>k(g.parameters),children:e.jsx(Ze,{size:14})}),e.jsx("button",{onClick:()=>x(g.id),className:"delete-btn",children:e.jsx(St,{size:14})})]})]})]},g.id))}),l.length===0&&e.jsx("div",{className:"empty-library",children:e.jsx("p",{children:"No discoveries yet. Start experimenting with parameters and save your findings!"})})]});return e.jsxs("div",{className:"tile-parameter-explorer",children:[e.jsxs("div",{className:"explorer-header",children:[e.jsx("h1",{children:"Tile Parameter Space Explorer"}),e.jsx("p",{children:"Discover emergent styles through systematic parameter manipulation"}),e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:r==="explorer"?"active":"",onClick:()=>a("explorer"),children:"Explorer"}),e.jsx("button",{className:r==="comparison"?"active":"",onClick:()=>a("comparison"),children:"Comparison"}),e.jsxs("button",{className:r==="library"?"active":"",onClick:()=>a("library"),children:["Library (",l.length,")"]})]})]}),e.jsxs("div",{className:"explorer-content",children:[r==="explorer"&&e.jsxs("div",{className:"explorer-layout",children:[e.jsxs("div",{className:"controls-panel",children:[D(),b()]}),e.jsx("div",{className:"preview-panel",children:w()})]}),r==="comparison"&&S(),r==="library"&&I()]})]})},yn={};function jn(){const[s,t]=c.useState("control"),[r,a]=c.useState("disconnected"),[n,o]=c.useState("192.168.1.103"),[i,u]=c.useState(null),[l,m]=c.useState(!1),[d,v]=c.useState("performance"),[f,C]=c.useState(!0);c.useEffect(()=>{const D=n.startsWith("http")?n:`http://${n}`,b=new Ee(D);u(b)},[n]),c.useEffect(()=>{i&&h()},[i]),c.useEffect(()=>{const D=b=>{b.altKey&&!b.shiftKey&&b.code==="KeyD"&&m(w=>!w),b.altKey&&b.shiftKey&&b.code==="KeyP"&&(v("performance"),t("debug"))};return window.addEventListener("keydown",D),()=>window.removeEventListener("keydown",D)},[]);const h=async()=>{if(i){a("connecting");try{const D=await i.testConnection();a(D?"connected":"disconnected")}catch(D){console.error("Connection test failed:",D),a("error")}}},j=async()=>{await h()},p=async D=>{o(D.ip)},N=r==="connected",x=!!yn?.VITE_DISABLE_DISCOVERY_MODAL,k=(()=>{try{const b=new URLSearchParams(window.location.search).get("disableDiscoveryModal");if(!b)return!1;const w=b.toLowerCase();return w==="true"||w==="1"}catch{return!1}})(),E=x||k;return e.jsx(Ba,{children:e.jsx(Ka,{children:e.jsx(pn,{initialConfig:{enabled:!0,strictMode:!1,showViolationIndicators:!0,logViolations:!0,auditOnMount:!0},children:e.jsx(Hr,{initialEndpoint:n,children:e.jsxs("div",{className:"h-screen w-screen flex flex-col bg-[var(--k1-bg)] text-[var(--k1-text)] overflow-hidden",children:[!1,e.jsx(yr,{activeView:s,onViewChange:t,isConnected:N,connectionIP:n}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx(Kr,{isConnected:N,connectionStatus:r,onConnect:j,connectionIP:n,onIPChange:o}),e.jsxs("main",{className:"flex-1 overflow-hidden",children:[s==="control"&&e.jsx(aa,{}),s==="profiling"&&e.jsx(fa,{isConnected:N,k1Client:i}),s==="terminal"&&e.jsx(ya,{isConnected:N,k1Client:i}),s==="debug"&&e.jsx(Ua,{isConnected:N,k1Client:i}),s==="qa"&&e.jsx(hn,{}),s==="glassmorphic"&&e.jsx(vn,{}),s==="tile-explorer"&&e.jsx(bn,{})]})]}),l&&e.jsx(mn,{k1Client:i,isConnected:N,onClose:()=>m(!1)}),e.jsx(en,{isOpen:E?!1:f&&!N,isConnected:N,onDiscoveryComplete:p,onClose:()=>C(!1)}),e.jsx(tn,{}),!1]})})})})})}hr.createRoot(document.getElementById("root")).render(e.jsx(jn,{}));
