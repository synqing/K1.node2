[env:esp32-s3-devkitc-1]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino

; Serial/USB settings
upload_port = /dev/tty.usbmodem212401
monitor_speed = 2000000
upload_speed = 2000000
monitor_filters = esp32_exception_decoder

; Build settings
build_flags =
    -Os                           ; Optimize for size
    -DARDUINO_USB_CDC_ON_BOOT=1  ; Enable USB CDC
    -DCORE_DEBUG_LEVEL=1          ; Minimal debug output

; Libraries
lib_deps =
    ; OTA updates
    ArduinoOTA
    ; Async Web Server for REST API (pinned to v3.5.1 - stable, no breaking API changes)
    https://github.com/me-no-dev/ESPAsyncWebServer.git#23ae702d01c5144fc3764af5cdb9ca00470c3fc8
    ; Async TCP library (pinned to v3.3.2 - stable for ESP32-S3)
    https://github.com/me-no-dev/AsyncTCP.git#c3584edf815eec8101ddc23413164992e5220868
    ; JSON parsing for web API
    bblanchon/ArduinoJson@^6.21.4

; Partition table and filesystem
board_build.partitions = partitions.csv
board_build.filesystem = spiffs  ; Use SPIFFS for static file serving

; Unit Testing Configuration
test_framework = unity
test_speed = 2000000
test_port = /dev/tty.usbmodem212401
test_build_src = yes
test_ignore = test_hardware_stress  ; Exclude stress tests by default (run manually)
; Test environment override - adds UNIT_TEST flag only during testing
[env:esp32-s3-devkitc-1-test]
extends = esp32-s3-devkitc-1
build_flags = 
    ${env:esp32-s3-devkitc-1.build_flags}
    -DUNIT_TEST
